var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},BABYLON;!function(e){var t;!function(e){!function(e){e[e.SCENE_EVENT=0]="SCENE_EVENT",e[e.GUI_EVENT=1]="GUI_EVENT",e[e.KEY_EVENT=2]="KEY_EVENT",e[e.UNKNOWN=3]="UNKNOWN"}(e.EventType||(e.EventType={}));var t=e.EventType;!function(e){e[e.FORM_CHANGED=0]="FORM_CHANGED",e[e.FORM_TOOLBAR_CLICKED=1]="FORM_TOOLBAR_CLICKED",e[e.LAYOUT_CHANGED=2]="LAYOUT_CHANGED",e[e.PANEL_CHANGED=3]="PANEL_CHANGED",e[e.GRAPH_SELECTED=4]="GRAPH_SELECTED",e[e.GRAPH_DOUBLE_SELECTED=5]="GRAPH_DOUBLE_SELECTED",e[e.TAB_CHANGED=6]="TAB_CHANGED",e[e.TAB_CLOSED=7]="TAB_CLOSED",e[e.TOOLBAR_MENU_SELECTED=8]="TOOLBAR_MENU_SELECTED",e[e.GRAPH_MENU_SELECTED=9]="GRAPH_MENU_SELECTED",e[e.GRID_SELECTED=10]="GRID_SELECTED",e[e.GRID_ROW_REMOVED=11]="GRID_ROW_REMOVED",e[e.GRID_ROW_ADDED=12]="GRID_ROW_ADDED",e[e.GRID_ROW_EDITED=13]="GRID_ROW_EDITED",e[e.GRID_ROW_CHANGED=14]="GRID_ROW_CHANGED",e[e.GRID_MENU_SELECTED=15]="GRID_MENU_SELECTED",e[e.GRID_RELOADED=16]="GRID_RELOADED",e[e.WINDOW_BUTTON_CLICKED=17]="WINDOW_BUTTON_CLICKED",e[e.OBJECT_PICKED=18]="OBJECT_PICKED",e[e.DOCUMENT_CLICK=19]="DOCUMENT_CLICK",e[e.DOCUMENT_UNCLICK=20]="DOCUMENT_UNCLICK",e[e.DOCUMENT_KEY_DOWN=21]="DOCUMENT_KEY_DOWN",e[e.DOCUMENT_KEY_UP=22]="DOCUMENT_KEY_UP",e[e.UNKNOWN=23]="UNKNOWN"}(e.GUIEventType||(e.GUIEventType={}));e.GUIEventType;!function(e){e[e.OBJECT_PICKED=0]="OBJECT_PICKED",e[e.OBJECT_ADDED=1]="OBJECT_ADDED",e[e.OBJECT_REMOVED=2]="OBJECT_REMOVED",e[e.OBJECT_CHANGED=3]="OBJECT_CHANGED",e[e.NEW_SCENE_CREATED=4]="NEW_SCENE_CREATED",e[e.UNKNOWN=4]="UNKNOWN"}(e.SceneEventType||(e.SceneEventType={}));var n=(e.SceneEventType,function(){function e(e){this.data=e}return e}());e.BaseEvent=n;var i=function(e){function t(t,n,i){e.call(this,i),this.object=t,this.eventType=n}return __extends(t,e),t}(n);e.SceneEvent=i;var r=function(e){function t(t,n,i){e.call(this,i),this.caller=t,this.eventType=n}return __extends(t,e),t}(n);e.GUIEvent=r;var a=function(e){function t(t,n,i,r,a){e.call(this,a),this.key=t,this.control=n,this.shift=i,this.isDown=r}return __extends(t,e),t}(n);e.KeyEvent=a;var o=function(){function e(){this.eventType=t.UNKNOWN,this.sceneEvent=null,this.guiEvent=null,this.keyEvent=null}return e.sendSceneEvent=function(n,r,a){var o=new e;o.eventType=t.SCENE_EVENT,o.sceneEvent=new i(n,r),a.sendEvent(o)},e.sendGUIEvent=function(n,i,a,o){var s=new e;s.eventType=t.GUI_EVENT,s.guiEvent=new r(n,i,o),a.sendEvent(s)},e.sendKeyEvent=function(n,i,r,o,s,l){var c=new e;c.eventType=t.KEY_EVENT,c.keyEvent=new a(n,i,r,o,l),s.sendEvent(c)},e}();e.Event=o}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(){}return n.GetStringFromVector3=function(e){return""+e.x+", "+e.y+", "+e.z},n.GetVector3FromString=function(t){var n=t.split(",");return e.Vector3.FromArray([parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2])])},n.OpenWindowPopup=function(e,t,i){var r=null;n.CheckIfElectron()&&(e="file://"+__dirname+"/"+e);var a=["width="+t,"height="+i,"top="+window.screenY+Math.max(window.outerHeight-i,0)/2,"left="+window.screenX+Math.max(window.outerWidth-t,0)/2,"status=no","resizable=yes","toolbar=no","menubar=no","scrollbars=yes"];return r=window.open(e,"Dumped Frame Buffer",a.join(",")),r.focus(),r},n.OpenFileBrowser=function(e,n,i,r){if(void 0===r&&(r=!1),this.CheckIfElectron()){var a=require("electron").remote.dialog;a.showOpenDialog({properties:["openFile","multiSelections"]},function(e){t.ElectronHelper.CreateFilesFromFileNames(e,r,function(e){i({target:{files:e}})})})}else{var o=$(n);o.change(function(e){i(e)}).click()}},n.NormalizeUri=function(e){for(;e.indexOf("\\")!==-1;)e=e.replace("\\","/");return e},n.GetFileExtension=function(e){var t=e.lastIndexOf(".");return t<0?e:e.substring(t+1)},n.GetFilenameWithoutExtension=function(e,t){var n=e.lastIndexOf("."),i=e.lastIndexOf("/");return e.substring(t?0:i+1,n)},n.GetFileType=function(e){switch(e){case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"bmp":return"image/bmp";case"tga":return"image/targa";case"dds":return"image/vnd.ms-dds";case"wav":case"wave":return"audio/wav";case"mp3":return"audio/mp3";case"mpg":case"mpeg":return"audio/mpeg";case"ogg":return"audio/ogg";default:return""}},n.GetBaseURL=function(){if(this.CheckIfElectron())return __dirname+"/";var t=window.location.href;return t=t.replace(e.Tools.GetFilename(t),"")},n.CheckIfElectron=function(){var e=window.process;return void 0!==e},n.CreateFileInpuElement=function(e){var n=$("#"+e);return n[0]||($("#BABYLON-EDITOR-UTILS").append(t.GUI.GUIElement.CreateElement('input type="file"',e,"display: none;")),n=$("#"+e)),n},n.BeautifyName=function(e){for(var t=e[0].toUpperCase(),n=1;n<e.length;n++){var i=e[n];i===i.toUpperCase()&&(t+=" "),t+=e[n]}return t},n.CleanProject=function(e){e.renderTargets=e.renderTargets||[],e.sounds=e.sounds||[],e.customMetadatas=e.customMetadatas||{},e.physicsEnabled=e.physicsEnabled||!1},n.GetConstructorName=function(e){var t=e&&e.constructor?e.constructor.name:"";return""===t&&(t=typeof e),t},n.BooleanToInt=function(e){return e===!0?1:0},n.IntToBoolean=function(e){return!(0===e)},n.GetParticleSystemByName=function(e,t){for(var n=0;n<e.particleSystems.length;n++)if(e.particleSystems[n].name===t)return e.particleSystems[n];return null},n.ConvertStringToArray=function(e){for(var t=e.length,n=new Uint8Array(t),i=0;i<t;i++)n[i]=e.charCodeAt(i);return n},n.ConvertBase64StringToArrayBuffer=function(e){var t=window.atob(e.split(",")[1]);return n.ConvertStringToArray(t)},n.CreateFileFromURL=function(i,r,a){void 0===a&&(a=!1);var o=e.Tools.GetFilename(i),s=o.toLowerCase();return a&&t.FilesInput.FilesTextures[s]?void r(t.FilesInput.FilesTextures[s]):!a&&t.FilesInput.FilesToLoad[s]?void r(t.FilesInput.FilesToLoad[s]):void e.Tools.LoadFile(i,function(t){var i=n.CreateFile(new Uint8Array(t),o);a?e.FilesInput.FilesTextures[o.toLowerCase()]=i:e.FilesInput.FilesToLoad[o.toLowerCase()]=i,r&&r(i)},null,null,!0,function(){e.Tools.Error("Cannot create file from file url : "+i)})},n.CreateFile=function(t,i){if(null===t)return null;var r=new File([new Blob([t])],e.Tools.GetFilename(i),{type:n.GetFileType(n.GetFileExtension(i))});return r},n.LoadAndCreateBase64Texture=function(t,i,r){e.Tools.LoadFile(t,function(a){var o=e.Tools.GetFilename(t),s=e.Tools.EncodeArrayBufferTobase64(a),l=e.Texture.CreateFromBase64String(s,o,i,!1,!1,e.Texture.BILINEAR_SAMPLINGMODE);l.name=l.name.replace("data:",""),l.url=l.url.replace("data:",""),e.FilesInput.FilesTextures[o]=n.CreateFile(new Uint8Array(a),o),r(l)},null,null,!0)},n}();t.Tools=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(t){var n=this;this._currentNode=null,this._cameraAttached=!0,this._actionStack=[],this._enabled=!1,this._core=t,t.eventReceivers.push(this),t.updates.push(this),this._scene=new e.Scene(t.engine),this._scene.autoClear=!1,this._scene.postProcessesEnabled=!1,this._pointerObserver=this._scene.onPointerObservable.add(function(e,t){return n._pointerCallback(e,t)},-1,!0),this._manipulator=new ManipulationHelpers.ManipulatorInteractionHelper(this._scene),this._manipulator.detachManipulatedNode(null),this.enabled=this._enabled}return n.prototype.onEvent=function(n){if(n.eventType===t.EventType.SCENE_EVENT&&n.sceneEvent.eventType===t.SceneEventType.OBJECT_PICKED){var i=n.sceneEvent.object;i instanceof e.Node||(i=null),this.setNode(i)}return!1},n.prototype.onPreUpdate=function(){this._scene.activeCamera=this._core.currentScene.activeCamera},n.prototype.onPostUpdate=function(){},n.prototype.getScene=function(){return this._scene},Object.defineProperty(n.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e,e?this._currentNode&&this._manipulator.attachManipulatedNode(this._currentNode):this.setNode(null)},enumerable:!0,configurable:!0}),n.prototype.setNode=function(e){this._currentNode&&this._manipulator.detachManipulatedNode(this._currentNode),e&&this._enabled&&this._manipulator.attachManipulatedNode(e),this._currentNode=e},n.prototype._pointerCallback=function(t,n){switch(this._detectActionChanged(t,n),this._getCurrentAction()){case 1:break;case 2:t.type&(e.PointerEventTypes.POINTERUP|e.PointerEventTypes.POINTERWHEEL)&&this._actionStack.pop()}},n.prototype._detectActionChanged=function(t,n){1===this._getCurrentAction()&&(t.type===e.PointerEventTypes.POINTERDOWN?t.pickInfo.hit||this._actionStack.push(2):t.type===e.PointerEventTypes.POINTERWHEEL&&this._actionStack.push(2))},n.prototype._getCurrentAction=function(){return 0===this._actionStack.length?1:this._actionStack[this._actionStack.length-1]},n}();t.ManipulationHelper=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(){}return n.RunInWindow=function(n){var i=t.Tools.OpenWindowPopup("run-game.html",1280,800);i.onloadeddata=function(){var r=(i.BABYLON.FilesInput,t.ProjectExporter.ExportProject(n,!0)),a=JSON.parse(r);for(var o in e.FilesInput.FilesTextures)i.BABYLON.FilesInput.FilesTextures[o]=e.FilesInput.FilesTextures[o];for(var o in e.FilesInput.FilesToLoad)i.BABYLON.FilesInput.FilesToLoad[o]=e.FilesInput.FilesToLoad[o];for(var s=0;s<a.lensFlares.length;s++)for(var l=a.lensFlares[s].serializationObject,c=0;c<l.flares.length;c++)i.BABYLON.FilesInput.FilesTextures[l.flares[c].base64Name.toLowerCase()]=t.Tools.CreateFile(t.Tools.ConvertBase64StringToArrayBuffer(l.flares[c].base64Buffer),l.flares[c].base64Name);for(var s=0;s<a.particleSystems.length;s++){var d=a.particleSystems[s].serializationObject;i.BABYLON.FilesInput.FilesTextures[d.base64TextureName.toLowerCase()]=t.Tools.CreateFile(t.Tools.ConvertBase64StringToArrayBuffer(d.base64Texture),d.base64TextureName)}var h=t.BabylonExporter.GenerateFinalBabylonFile(n);i.filesInput._sceneFileToLoad=t.Tools.CreateFile(t.Tools.ConvertStringToArray(JSON.stringify(h)),"scene.babylon"),i.BABYLON.EDITOR.EXTENSIONS.EditorExtension._ExtensionsDatas=t.SceneManager._CustomMetadatas,i.loadScene()}},n}();t.GameTester=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e,t){this.element=null,this.name="",this.core=null,this.name=e,this.core=t}return e.prototype.destroy=function(){this.element.destroy()},e.prototype.refresh=function(){this.element.refresh()},e.prototype.resize=function(){this.element.resize()},e.prototype.on=function(e,t){this.element.on(e,t)},e.prototype.buildElement=function(e){},e.CreateDivElement=function(e,t){return'<div id="'+e+'"'+(t?' style="'+t+'"':"")+"></div>"},e.CreateElement=function(e,t,n,i,r){return void 0===n&&(n="width: 100%; height: 100%;"),void 0===i&&(i=""),void 0===r&&(r=!1),"<"+(e instanceof Array?e.join(" "):e)+' id="'+t+'"'+(n?' style="'+n+'"':"")+">"+i+"</"+(e instanceof Array?e[0]:e)+">"+(r?"<br />":"")},e.CreateButton=function(e,t,n){var i="string"==typeof e?$("#"+e):e;return i.append('<button value="Red" id="'+t+'">'+n+"</button>"),$("#"+t)},e.CreateTransition=function(e,t,n,i){w2utils.transition($("#"+e)[0],$("#"+t)[0],n,function(){i&&i()})},e}();e.GUIElement=t}(t=e.GUI||(e.GUI={}))}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(e,n,i,r){t.call(this,e,n),this.callback=null,this.title=i,this.body=r}return __extends(n,t),n.prototype.buildElement=function(t){var n=this;this.element=w2confirm(this.body,this.title,function(t){n.callback&&n.callback(t);var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.WINDOW_BUTTON_CLICKED,t),n.core.sendEvent(i)})},n.CreateDialog=function(e,t,n,i){w2confirm(e,t,null).yes(function(){n&&n()}).no(function(){i&&i()})},n}(t.GUIElement);t.GUIDialog=n}(t=e.GUI||(e.GUI={}))}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n;!function(t){var n=function(t){function n(e,n){t.call(this,e,n)}return __extends(n,t),n.prototype.remove=function(){this._datElement.domElement.parentNode.removeChild(this._datElement.domElement)},n.prototype.addFolder=function(e,t){var n=t?t:this._datElement,i=n.addFolder(e);return i.open(),i},n.prototype.add=function(e,t,n,i){return e&&void 0!==e[t]&&null!==e[t]?this._datElement.add(e,t,n).name(i):this._datElement.add(null,"")},n.prototype.tagObjectIfChanged=function(t,n,i){t.onFinishChange(function(t){e.Tags.HasTags(n)||e.Tags.EnableFor(n),e.Tags.MatchesQuery(n,i)||e.Tags.AddTagsTo(n,i)})},Object.defineProperty(n.prototype,"width",{get:function(){return this._datElement.width},set:function(e){this._datElement.width=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._datElement.height},set:function(e){this._datElement.height=e},enumerable:!0,configurable:!0}),n.prototype.remember=function(e){this._datElement.remember(e)},n.prototype.buildElement=function(e){var t=$("#"+e);this._datElement=new dat.GUI({autoPlace:!1}),this._datElement.width=t.width(),this.element=t[0].appendChild(this._datElement.domElement)},n}(t.GUIElement);t.GUIEditForm=n}(n=t.GUI||(t.GUI={}))}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(e,n,i){void 0===n&&(n=""),t.call(this,e,i),this.fields=[],this.toolbarFields=[],this.header=n}return __extends(n,t),n.prototype.createField=function(e,t,n,i,r,a){void 0===i&&(i=void 0),void 0===r&&(r=""),void 0===a&&(a={}),i=null===i?6:i;var o={name:e,type:t,html:{caption:n,span:i,text:r},options:a};return this.fields.push(o),this},n.prototype.createToolbarField=function(e,t,n,i){var r={id:name,text:n,type:t,checked:!1,img:i};return this.toolbarFields.push(r),r},n.prototype.setRecord=function(e,t){this.element.record[e]=t},n.prototype.getRecord=function(e){return this.element.record[e]},n.prototype.buildElement=function(t){var n=this;this.element=$("#"+t).w2form({name:this.name,focus:-1,header:this.header,formHTML:"",fields:this.fields,toolbar:{items:this.toolbarFields,onClick:function(t){n.onToolbarClicked&&n.onToolbarClicked(t.target);var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.FORM_CHANGED),i.guiEvent.data=t.target,n.core.sendEvent(i)}}}),this.element.on({type:"change",execute:"after"},function(){n.onFormChanged&&n.onFormChanged();var t=new e.Event;t.eventType=e.EventType.GUI_EVENT,t.guiEvent=new e.GUIEvent(n,e.GUIEventType.FORM_CHANGED),n.core.sendEvent(t)})},n}(t.GUIElement);t.GUIForm=n}(t=e.GUI||(e.GUI={}))}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(e,n){t.call(this,e,n),this.menus=[]}return __extends(n,t),n.prototype.addMenu=function(e,t,n){void 0===n&&(n=""),this.menus.push({id:e,text:t,img:n})},n.prototype.createNode=function(e,t,n,i){return void 0===n&&(n=""),{id:e,text:t,img:n,data:i}},n.prototype.addNodes=function(e,t,n){void 0===n&&(n=!0),t?this.element.add(t,Array.isArray(e)?e:[e],n):this.element.add(Array.isArray(e)?e:[e])},n.prototype.removeNode=function(e){this.element.remove(e)},n.prototype.setNodeExpanded=function(e,t){t?this.element.expand(e):this.element.collapse(e)},n.prototype.setSelected=function(e){var t=this.element.get(e);if(t){for(;null!==t.parent;)t=t.parent,t&&t.id&&this.element.expand(t.id);this.element.select(e),this.element.scrollIntoView(e)}},n.prototype.getSelected=function(){return this.element.selected},n.prototype.getSelectedNode=function(){var e=this.element.get(this.getSelected());return e?e:null},n.prototype.getNode=function(e){var t=this.element.get(e);return t},n.prototype.getSelectedData=function(){var e=this.getSelected();return this.element.get(e).data},n.prototype.clear=function(){for(var e=[],t=0;t<this.element.nodes.length;t++)e.push(this.element.nodes[t].id);this.element.remove.apply(this.element,e)},n.prototype.buildElement=function(t){var n=this;this.element=$("#"+t).w2sidebar({name:this.name,img:null,keyboard:!1,nodes:[],menu:this.menus,onClick:function(t){n.onGraphClick&&n.onGraphClick(t.object.data);var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.GRAPH_SELECTED),i.guiEvent.data=t.object.data,n.core.sendEvent(i)},onDblClick:function(t){n.onGraphDblClick&&n.onGraphDblClick(t.object.data);var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.GRAPH_DOUBLE_SELECTED),i.guiEvent.data=t.object.data,n.core.sendEvent(i)},onMenuClick:function(t){n.onMenuClick&&n.onMenuClick(t.menuItem.id);var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.GRAPH_MENU_SELECTED),i.guiEvent.data=t.menuItem.id,n.core.sendEvent(i)}})},n}(t.GUIElement);t.GUIGraph=n}(t=e.GUI||(e.GUI={}))}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t;!function(t){var n=w2obj.grid.prototype.buttons;n.add.caption=w2utils.lang(""),n["delete"].caption=w2utils.lang("");var i=function(t){function n(e,n){t.call(this,e,n),this.columns=[],this.records=[],this.header="",this.fixedBody=!0,this.showToolbar=!0,this.showFooter=!1,this.showDelete=!1,this.showAdd=!1,this.showEdit=!1,this.showOptions=!0,this.showRefresh=!0,this.showSearch=!0,this.showColumnHeaders=!0,this.menus=[],this.autoMergeChanges=!0,this.multiSelect=!0,this.hasSubGrid=!1}return __extends(n,t),n.prototype.addMenu=function(e,t,n){this.menus.push({id:e,text:t,icon:n})},n.prototype.createColumn=function(e,t,n,i){n||(n="50%"),this.columns.push({field:e,caption:t,size:n,style:i})},n.prototype.createEditableColumn=function(e,t,n,i,r){i||(i="50%"),this.columns.push({field:e,caption:t,size:i,style:r,editable:n})},n.prototype.addRow=function(e){e.recid=this.getRowCount(),this.element.add(e)},n.prototype.addRecord=function(e){this.element?(e.recid=this.element.records.length,this.element.records.push(e)):(e.recid=this.records.length,this.records.push(e))},n.prototype.removeRow=function(e){this.element.remove(e)},n.prototype.removeRecord=function(e){this.element.records.splice(e,1)},n.prototype.refresh=function(){for(var e=0;e<this.element.records.length;e++)this.element.records[e].recid=e;t.prototype.refresh.call(this)},n.prototype.getRowCount=function(){return this.element.total},n.prototype.clear=function(){this.element.clear(),this.element.total=0},n.prototype.lock=function(e,t){this.element.lock(e,t)},n.prototype.unlock=function(){this.element.unlock()},n.prototype.getSelectedRows=function(){return this.element.getSelection()},n.prototype.setSelected=function(e){for(var t=0;t<e.length;t++)this.element.select(e[t])},n.prototype.getRow=function(e){return e>=0?this.element.get(e):null},n.prototype.modifyRow=function(e,t){this.element.set(e,t)},n.prototype.getChanges=function(e){var t=this.element.getChanges();if(e){for(var n=0;n<t.length;n++)if(t[n].recid===e)return[t[n]];return[]}return t},n.prototype.scrollIntoView=function(e){e>=0&&e<this.element.records.length&&this.element.scrollIntoView(e)},n.prototype.mergeChanges=function(){this.element.mergeChanges()},n.prototype.buildElement=function(t){var n=this,i=$("#"+t);i.on("mousedown",function(e){n.onMouseDown&&n.onMouseDown()}),i.on("mouseup",function(e){n.onMouseUp&&n.onMouseUp()}),this.element=i.w2grid({name:this.name,show:{toolbar:this.showToolbar,footer:this.showFooter,toolbarDelete:this.showDelete,toolbarAdd:this.showAdd,toolbarEdit:this.showEdit,toolbarSearch:this.showSearch,toolbarColumns:this.showOptions,toolbarReload:this.showRefresh,header:!(""===this.header),columnHeaders:this.showColumnHeaders},menu:this.menus,header:this.header,fixedBody:this.fixedBody,columns:this.columns,records:this.records,multiSelect:this.multiSelect,onClick:function(t){t.onComplete=function(){var t=n.getSelectedRows();if(1===t.length){n.onClick&&n.onClick(t);var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.GRID_SELECTED,t),n.core.sendEvent(i)}}},keyboard:!1,onMenuClick:function(t){n.onMenuClick&&n.onMenuClick(t.menuItem.id);var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.GRID_MENU_SELECTED,t.menuItem.id),n.core.sendEvent(i)},onDelete:function(t){if(t.force){var i=n.getSelectedRows();n.onDelete&&n.onDelete(i);var r=new e.Event;r.eventType=e.EventType.GUI_EVENT,r.guiEvent=new e.GUIEvent(n,e.GUIEventType.GRID_ROW_REMOVED,i),n.core.sendEvent(r)}},onAdd:function(t){n.onAdd&&n.onAdd();var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.GRID_ROW_ADDED),n.core.sendEvent(i)},onEdit:function(t){var i=n.getSelectedRows();n.onEdit&&n.onEdit(i);var r=new e.Event;r.eventType=e.EventType.GUI_EVENT,r.guiEvent=new e.GUIEvent(n,e.GUIEventType.GRID_ROW_EDITED,i),n.core.sendEvent(r)},onReload:function(t){n.onReload&&n.onReload();var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.GRID_RELOADED),n.core.sendEvent(i)},onExpand:this.hasSubGrid?function(e){if(n.onExpand){var t="subgrid-"+e.recid+e.target;w2ui.hasOwnProperty(t)&&w2ui[t].destroy();var i=n.onExpand(t,parseInt(e.recid));i&&(i.fixedBody=!0,i.showToolbar=!1,i.buildElement(e.box_id),$("#"+e.box_id).css({margin:"0px",padding:"0px",width:"100%"}).animate({height:(n.subGridHeight||105)+"px"},100),setTimeout(function(){w2ui[t].resize()},300))}}:void 0,onChange:function(t){if(t.recid){n.onEditField&&(t.onComplete=function(){return n.onEditField(t.recid,t.value_new)});var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.GRID_ROW_CHANGED,{recid:t.recid,value:t.value_new}),n.core.sendEvent(i),n.autoMergeChanges&&n.element.mergeChanges()}},onEditField:function(t){if(t.recid){n.onEditField&&(t.onComplete=function(){return n.onEditField(parseInt(t.recid),t.value)});var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.GRID_ROW_CHANGED,{recid:parseInt(t.recid),value:t.value}),n.core.sendEvent(i),n.autoMergeChanges&&n.element.mergeChanges()}}})},n}(t.GUIElement);t.GUIGrid=i}(t=e.GUI||(e.GUI={}))}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t;!function(t){var n=function(n){function i(e,t){n.call(this,e,t),this.panels=[]}return __extends(i,n),i.prototype.createPanel=function(e,n,i,r){void 0===r&&(r=!0);var a=new t.GUIPanel(e,n,i,r,this.core);return this.panels.push(a),a},i.prototype.lockPanel=function(e,t,n){this.element.lock(e,t,n)},i.prototype.unlockPanel=function(e){this.element.unlock(e)},i.prototype.getPanelFromType=function(e){for(var t=0;t<this.panels.length;t++)if(this.panels[t].type===e)return this.panels[t];return null},i.prototype.getPanelFromName=function(e){for(var t=0;t<this.panels.length;t++)if(this.panels[t].name===e)return this.panels[t];return null},i.prototype.setPanelSize=function(e,t){this.element.sizeTo(e,t)},i.prototype.buildElement=function(t){var n=this;this.element=$("#"+t).w2layout({name:this.name,panels:this.panels}),this.element.on({type:"resize",execute:"after"},function(){var t=new e.Event;t.eventType=e.EventType.GUI_EVENT,t.guiEvent=new e.GUIEvent(n,e.GUIEventType.LAYOUT_CHANGED),n.core.sendEvent(t)});for(var i=0;i<this.panels.length;i++)this.panels[i]._panelElement=this.element.get(this.panels[i].type)},i}(t.GUIElement);t.GUILayout=n}(t=e.GUI||(e.GUI={}))}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t;!function(e){var t=function(e){function t(t,n){e.call(this,t,n),this.items=[],this.renderDrop=!1,this.selected=""}return __extends(t,e),t.prototype.addItem=function(e){return this.items.push(e),this},t.prototype.getSelected=function(){var e=this.element.val();return this.element.items.indexOf(e)},t.prototype.getValue=function(){return this.element.val()},t.prototype.buildElement=function(e){for(var t=this,n=$("#"+e),i=[],r=0;r<this.items.length;r++)i.push({id:this.items[r],text:this.items[r]});this.element=n.w2field("list",{items:i,selected:{id:this.selected,text:this.selected},renderItem:function(e){return e.text},renderDrop:this.renderDrop?function(e){return e.text}:void 0,compare:function(e,t){return e.text.indexOf(t)!==-1}}),this.element.change(function(e){t.onChange&&t.onChange(t.element.val())})},t}(e.GUIElement);e.GUIList=t}(t=e.GUI||(e.GUI={}))}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(e,n,i,r,a){t.call(this,e,a),this.tabs=new Array,this.size=70,this.minSize=10,this.maxSize=void 0,this.style="background-color: #F5F6F7; border: 1px solid #dfdfdf; padding: 5px;",this.toolbar=null,this.type=n,this.size=i,this.resizable=r}return __extends(n,t),n.prototype.createTab=function(t){var n=this;return t.onClick=function(t){n.onTabChanged&&n.onTabChanged(t.target);var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.TAB_CHANGED,t.target),n.core.sendEvent(i)},t.onClose=function(t){n.onTabClosed&&n.onTabClosed(t.target);var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.TAB_CLOSED,t.target),n.core.sendEvent(i)},this.tabs.push(t),null!==this._panelElement&&this._panelElement.tabs.add(t),this},n.prototype.removeTab=function(e){null!==this._panelElement&&this._panelElement.tabs.remove(e);for(var t=0;t<this.tabs.length;t++)if(this.tabs[t].id===e)return this.tabs.splice(t,1),!0;return!1},Object.defineProperty(n.prototype,"width",{get:function(){return this._panelElement?this._panelElement.width:0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._panelElement?this._panelElement.height:0},enumerable:!0,configurable:!0}),n.prototype.getTabCount=function(){return this.tabs.length},n.prototype.setTabEnabled=function(e,t){return null===this._panelElement?this:(t?this._panelElement.tabs.enable(e):this._panelElement.tabs.disable(e),this)},n.prototype.setActiveTab=function(t){this._panelElement.tabs.select(t);var n=new e.Event;n.eventType=e.EventType.GUI_EVENT,n.guiEvent=new e.GUIEvent(this,e.GUIEventType.TAB_CHANGED,t),this.core.sendEvent(n)},n.prototype.getTabIDFromIndex=function(e){return e>=0&&e<this.tabs.length?this.tabs[e].id:""},n.prototype.getTab=function(e){var t=this._panelElement.tabs.get(e);return t},n.prototype.setContent=function(e){return this.content=e,this},n.prototype.hideTab=function(e){return 1===this._panelElement.tabs.hide(e)},n.prototype.showTab=function(e){return 1===this._panelElement.tabs.show(e)},n}(t.GUIElement);t.GUIPanel=n}(t=e.GUI||(e.GUI={}))}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(e,n){t.call(this,e,n),this.menus=[]}return __extends(n,t),n.prototype.createMenu=function(e,t,n,i,r,a){var o={type:e,id:t,text:n,img:i,checked:r||!1,hint:a,items:[]};return this.menus.push(o),o},n.prototype.createMenuItem=function(e,t,n,i,r,a,o){var s={type:t,id:n,text:i,icon:r,checked:a||!1,disabled:o||!1};return e.items.push(s),s},n.prototype.createInput=function(e,t,n,i){void 0===i&&(i=10);var r={type:"html",id:e,html:'<div style="padding: 3px 10px;">'+n+'    <input size="'+i+'" id="'+t+'" style="padding: 3px; border-radius: 2px; border: 1px solid silver"/></div>',text:n};return this.menus.push(r),r},n.prototype.addBreak=function(e){var t={type:"break",id:void 0,text:void 0,img:void 0,icon:void 0,checked:void 0,items:void 0};return e?e.items.push(t):this.menus.push(t),t},n.prototype.addSpacer=function(){var e={type:"spacer",id:void 0,text:void 0,img:void 0,icon:void 0,checked:void 0,items:void 0};return this.menus.push(e),e},n.prototype.setItemText=function(e,t,n){var i=this.element.get(n?n:e);if(i&&!n&&(i.text=t),i&&n&&i.items)for(var r=0;r<i.items.length;r++)i.items[r].id===e&&(i.items[r].text=t)},n.prototype.setItemChecked=function(e,t,n){if(n){var i=this.element.get(n);if(i&&i.items)for(var r=0;r<i.items.length;r++)i.items[r].id===e&&(i.items[r].checked=t)}else t?this.element.check(e):this.element.uncheck(e)},n.prototype.setItemAutoChecked=function(e,t){var n=this.element.get(t?t+":"+e:e),i=!!n&&n.checked;i?this.element.uncheck(e):this.element.check(e)},n.prototype.isItemChecked=function(e,t){var n=this.element.get(t?t:e);if(n&&!t)return n.checked;if(n&&t&&n.items)for(var i=0;i<n.items.length;i++)if(n.items[i].id===e)return n.items[i].checked;return!1},n.prototype.setItemEnabled=function(e,t,n){var i=n?n+":"+e:e,r=null;if(n&&(r=this.element.get(n)),r){for(var a=0;a<r.items.length;a++)if(r.items[a].id===e){r.items[a].disabled=!t,this.refresh();break}}else t?this.element.enable(i):this.element.disable(i);return!!r},n.prototype.getItemByID=function(e){for(var t=0;t<this.menus.length;t++){var n=this.menus[t];if("break"!==n.type){if(n.id===e)return n;for(var i=0;i<n.items.length;i++){var r=n.items[i];if(r.id===e)return r}}}return null},n.prototype.decomposeSelectedMenu=function(e){var t=e.split(":"),n=this.getItemByID(t[t.length-1]);return n?{hasParent:t.length>1,parent:t[0],selected:t.length>1?t[t.length-1]:""}:null},n.prototype.buildElement=function(t){var n=this;this.element=$("#"+t).w2toolbar({name:this.name,items:this.menus,onClick:function(t){n.onClick&&n.onClick(n.decomposeSelectedMenu(t.target));var i=new e.Event;i.eventType=e.EventType.GUI_EVENT,i.guiEvent=new e.GUIEvent(n,e.GUIEventType.TOOLBAR_MENU_SELECTED),i.guiEvent.data=t.target,n.core.sendEvent(i)}})},n}(t.GUIElement);t.GUIToolbar=n}(t=e.GUI||(e.GUI={}))}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n;!function(n){var i=function(n){function i(t,i,r,a,o,s){var l=this;n.call(this,t,i),this.title="",this.body="",this.size=new e.Vector2(800,600),this.buttons=[],this.modal=!0,this.showClose=!0,this.showMax=!0,this._onCloseCallbacks=[],this.title=r,this.body=a,o&&(this.size=o),s&&(this.buttons=s),this._onCloseCallback=function(){l.core.editor.renderMainScene=!0;for(var e=0;e<l._onCloseCallbacks.length;e++)l._onCloseCallbacks[e]()}}return __extends(i,n),i.prototype.destroy=function(){this.element.clear()},i.prototype.setOnCloseCallback=function(e){this._onCloseCallbacks.push(e)},i.prototype.close=function(){this.element.close()},i.prototype.maximize=function(){this.element.max()},i.prototype.lock=function(e){w2popup.lock(e)},i.prototype.unlock=function(){w2popup.unlock()},Object.defineProperty(i.prototype,"onToggle",{get:function(){return this._onToggle},set:function(e){var t=function(t){t.onComplete=function(t){e(t.options.maximized,t.options.width,t.options.height)}};this.element.onMax=t,this.element.onMin=t,this._onToggle=e},enumerable:!0,configurable:!0}),i.prototype.notify=function(e){w2popup.message({width:400,height:180,html:'<div style="padding: 60px; text-align: center">'+e+'</div><div style="text- align: center"><button class="btn" onclick="w2popup.message()">Close</button>'})},i.prototype.buildElement=function(e){for(var n=this,i="WindowButton",r="",a=0;a<this.buttons.length;a++)r+='<button class="btn" id="'+i+this.buttons[a]+'">'+this.buttons[a]+"</button>\n";this.element=w2popup.open({title:this.title,body:this.body,buttons:r,width:this.size.x,height:this.size.y,showClose:this.showClose,showMax:null!=this.showMax&&this.showMax,modal:this.modal});for(var a=0;a<this.buttons.length;a++){var o=$("#"+i+this.buttons[a]);o.click(function(e){var r=e.target.id.replace(i,""),a=new t.Event;a.eventType=t.EventType.GUI_EVENT,a.guiEvent=new t.GUIEvent(n,t.GUIEventType.WINDOW_BUTTON_CLICKED,r),n.core.sendEvent(a),n.onButtonClicked&&n.onButtonClicked(r)})}var s=this.element;s.onClose=this._onCloseCallback,this.core.editor.renderMainScene=!1},i.CreateAlert=function(e,t,n){
w2alert(e,t,n)},i}(n.GUIElement);n.GUIWindow=i}(n=t.GUI||(t.GUI={}))}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(e){this.object=null,this.tab="",this._editionTool=e}return e.prototype.isObjectSupported=function(e){return!1},e.prototype.createUI=function(){},e.prototype.update=function(){return!0},e.prototype.apply=function(){},e.prototype.resize=function(){},e}();e.AbstractTool=t}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e){n.call(this,e)}return __extends(i,n),i.prototype.update=function(){return this._element&&(this._element.remove(),this._element=null),!0},i.prototype.resize=function(){this._element&&(this._element.width=this._editionTool.panel.width-15)},i.prototype.addColorFolder=function(t,n,i,r,a){void 0===i&&(i=!1);var o=["r","g","b"];t instanceof e.Color4&&o.push("a");for(var s=this._element.addFolder(n,r),l=0;l<o.length;l++)s.add(t,o[l]).min(0).max(1).name(o[l]).onChange(function(e){a&&a()});return i||s.close(),s},i.prototype.addVectorFolder=function(t,n,i,r,a){void 0===i&&(i=!1);var o=["x","y"];t instanceof e.Vector3&&o.push("z");for(var s=this._element.addFolder(n,r),l=0;l<o.length;l++)s.add(t,o[l]).step(.01).name(o[l]).onChange(function(e){a&&a()});return i||s.close(),s},i.prototype.addTextureFolder=function(n,i,r,a,o,s){var l=this;void 0===o&&(o=!1);for(var c=i.replace(" ",""),d="_set"+c,h=["None"],u=this._editionTool.core.currentScene,p=0;p<u.textures.length;p++)!o&&u.textures[p].isCube||h.push(u.textures[p].name);this[d]=function(){new t.GUITextureEditor(l._editionTool.core,i,n,r)},this[c]=n[r]&&n[r]instanceof e.BaseTexture?n[r].name:h[0];var m=this._element.addFolder(i,a);return m.close(),m.add(this,d).name("Browse..."),m.add(this,c,h).name("Choose").onChange(function(e){if("None"===e)n[r]=void 0;else for(var t=0;t<u.textures.length;t++)if(u.textures[t].name===e){n[r]=u.textures[t];break}s&&s()}),m},i}(t.AbstractTool);t.AbstractDatTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e){n.call(this,e),this.object=null,this.tab="GENERAL.TAB",this._isActiveCamera=!1,this._isActivePlayCamera=!1,this.containers=["BABYLON-EDITOR-EDITION-TOOL-GENERAL"]}return __extends(i,n),i.prototype.isObjectSupported=function(t){return t instanceof e.AbstractMesh||t instanceof e.Light||t instanceof e.Camera||t instanceof e.LensFlareSystem},i.prototype.createUI=function(){this._editionTool.panel.createTab({id:this.tab,caption:"General"})},i.prototype.update=function(){var i=this,r=this.object=this._editionTool.object,a=(this._editionTool.core.currentScene,this._editionTool.core);if(n.prototype.update.call(this),!r)return!1;this._element=new t.GUI.GUIEditForm(this.containers[0],this._editionTool.core),this._element.buildElement(this.containers[0]),this._element.remember(r);var o=this._element.addFolder("Common");if(o.add(r,"name").name("Name").onChange(function(e){var t=i._editionTool.core.editor.sceneGraphTool.sidebar,n=t.getSelectedNode();n&&(n.text=e,t.refresh())}),r instanceof e.Camera){var s=this._element.addFolder("Camera");r!==a.camera&&(this._isActivePlayCamera=r===a.playCamera,s.add(this,"_isActivePlayCamera").name("Set Play Camera").listen().onFinishChange(function(e){e===!0?(a.playCamera=r,a.isPlaying&&(a.currentScene.activeCamera=r)):e=!0})),this._isActiveCamera=r===a.currentScene.activeCamera,s.add(this,"_isActiveCamera").name("Active Camera").listen().onFinishChange(function(e){e===!0?a.currentScene.activeCamera=r:e=!0}),s.add(this.object,"maxZ").min(0).step(.1).name("Far Value"),s.add(this.object,"minZ").min(0).step(.1).name("Near Value"),r.speed&&s.add(this.object,"speed").min(0).step(.001).name("Speed"),r.fov&&s.add(this.object,"fov").min(0).max(10).step(.001).name("Fov")}var l=this._element.addFolder("Transforms");if(r.position){var c=this._element.addFolder("Position",l);c.add(r.position,"x").step(.1).name("x"),c.add(r.position,"y").step(.1).name("y"),c.add(r.position,"z").step(.1).name("z")}if(r.rotation){var d=this._element.addFolder("Rotation",l);d.add(r.rotation,"x").name("x").step(.1),d.add(r.rotation,"y").name("y").step(.1),d.add(r.rotation,"z").name("z").step(.1)}if(r.scaling){var h=this._element.addFolder("Scaling",l);h.add(r.scaling,"x").name("x").step(.1),h.add(r.scaling,"y").name("y").step(.1),h.add(r.scaling,"z").name("z").step(.1)}if(r instanceof e.AbstractMesh){var u=this._element.addFolder("Collisions");u.add(r,"checkCollisions").name("Check Collision"),u.add(r,"isBlocker").name("Is Blocker");var p=this._element.addFolder("Rendering");p.add(r,"receiveShadows").name("Receive Shadows"),p.add(r,"applyFog").name("Apply Fog"),p.add(r,"isVisible").name("Is Visible"),p.add(this,"_castShadows").name("Cast Shadows").onChange(function(e){if(e===!0){var n=new t.GUI.GUIDialog("CastShadowsDialog",i._editionTool.core,"Shadows Generator","Make children to cast shadows");n.callback=function(e){"Yes"===e&&i._setChildrenCastingShadows(r)},n.buildElement(null)}})}return!0},Object.defineProperty(i.prototype,"_castShadows",{get:function(){for(var e=this.object.getScene(),t=0;t<e.lights.length;t++){var n=e.lights[t],i=n.getShadowGenerator();if(i)for(var r=i.getShadowMap(),a=0;a<r.renderList.length;a++){var o=r.renderList[a];if(o===this.object)return!0}}return!1},set:function(e){for(var t=this.object.getScene(),n=this.object,i=0;i<t.lights.length;i++){var r=t.lights[i],a=r.getShadowGenerator();if(a){var o=a.getShadowMap();if(e)o.renderList.push(n);else{var s=o.renderList.indexOf(n);s!==-1&&o.renderList.splice(s,1)}}}},enumerable:!0,configurable:!0}),i.prototype._setChildrenCastingShadows=function(t){for(var n=t.getScene(),i=0;i<t.getDescendants().length;i++){var r=t.getDescendants()[i];if(r instanceof e.AbstractMesh){for(var a=0;a<n.lights.length;a++){var o=n.lights[a],s=o.getShadowGenerator();if(s){var l=s.getShadowMap(),c=l.renderList.indexOf(r);c===-1&&l.renderList.push(r)}}this._setChildrenCastingShadows(r)}}},i}(t.AbstractDatTool);t.GeneralTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e){n.call(this,e),this.tab="ANIMATION.TAB",this._animationSpeed=1,this._loopAnimation=!1,this._impostor="",this._mass=0,this._friction=0,this._restitution=0,this.containers=["BABYLON-EDITOR-EDITION-TOOL-ANIMATION"]}return __extends(i,n),i.prototype.isObjectSupported=function(e){return!(!e.animations||!Array.isArray(e.animations))},i.prototype.createUI=function(){this._editionTool.panel.createTab({id:this.tab,caption:"Behavior"})},i.prototype.update=function(){var i=this,r=this.object=this._editionTool.object;if(n.prototype.update.call(this),!r)return!1;this._element=new t.GUI.GUIEditForm(this.containers[0],this._editionTool.core),this._element.buildElement(this.containers[0]),this._element.remember(r),this._element.add(this,"_editAnimations").name("Edit Animations");var a=this._element.addFolder("Play Animations");if(a.add(this,"_playAnimations").name("Play Animations"),a.add(this,"_animationSpeed").min(0).name("Speed"),a.add(this,"_loopAnimation").name("Loop"),r instanceof e.AbstractMesh&&r.skeleton){var o=this._element.addFolder("Skeleton");o.add(this,"_playSkeletonAnimations").name("Play Animations"),r.skeleton.needInitialSkinMatrix=r.skeleton.needInitialSkinMatrix||!1,o.add(r.skeleton,"needInitialSkinMatrix").name("Need Initial Skin Matrix")}if(r instanceof e.Scene||r instanceof e.AbstractMesh){var s=this._element.addFolder("Actions Builder");s.add(this,"_openActionsBuilder").name("Open Actions Builder")}if(r instanceof e.AbstractMesh&&this._editionTool.core.currentScene.getPhysicsEngine()){var l=this._element.addFolder("Physics"),c=(this._editionTool.core.currentScene,["NoImpostor","SphereImpostor","BoxImpostor","PlaneImpostor","MeshImpostor","CylinderImpostor","ParticleImpostor","HeightmapImpostor"]),d=["NoImpostor","SphereImpostor","BoxImpostor","CylinderImpostor"];this._impostor=r.getPhysicsImpostor()?c[r.getPhysicsImpostor().type]||c[0]:c[0],l.add(this,"_impostor",d).name("Impostor").onChange(function(t){r.getPhysicsImpostor()&&(r.getPhysicsImpostor().dispose(),r.physicsImpostor=null),t!==d[0]&&(r.setPhysicsState(e.PhysicsEngine[t],{mass:0}),r.getPhysicsImpostor().sleep(),e.Tags.AddTagsTo(r.getPhysicsImpostor(),"added")),i._editionTool.updateEditionTool()}),r.getPhysicsImpostor()&&(this._mass=r.getPhysicsMass(),this._friction=r.getPhysicsFriction(),this._restitution=r.getPhysicsRestitution(),l.add(this,"_mass").name("Mass").min(0).step(.01).onChange(function(e){return r.getPhysicsImpostor().setMass(e)}),l.add(this,"_friction").name("Friction").min(0).step(.01).onChange(function(e){return r.getPhysicsImpostor().setParam("friction",e)}),l.add(this,"_restitution").name("Restitution").min(0).step(.01).onChange(function(e){return r.getPhysicsImpostor().setParam("restitution",e)}))}return!0},i.prototype._editAnimations=function(){new t.GUIAnimationEditor(this._editionTool.core,this.object)},i.prototype._playAnimations=function(){this._editionTool.core.currentScene.beginAnimation(this.object,0,Number.MAX_VALUE,this._loopAnimation,this._animationSpeed)},i.prototype._playSkeletonAnimations=function(){var e=this.object=this._editionTool.object,t=e.getScene();t.beginAnimation(e.skeleton,0,Number.MAX_VALUE,this._loopAnimation,this._animationSpeed)},i.prototype._openActionsBuilder=function(){var n=null,i=this.object;n=this.object instanceof e.Scene?this._editionTool.core.isPlaying?this.object.actionManager:t.SceneManager._SceneConfiguration.actionManager:this._editionTool.core.isPlaying?this.object.actionManager:t.SceneManager._ConfiguredObjectsIDs[this.object.id].actionManager,n||(n=new e.ActionManager(this._editionTool.core.currentScene),this.object instanceof e.Scene?t.SceneManager._SceneConfiguration.actionManager=n:t.SceneManager._ConfiguredObjectsIDs[i.id].actionManager=n);new t.GUIActionsBuilder(this._editionTool.core,this.object,n)},i}(t.AbstractDatTool);t.AnimationTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e){n.call(this,e),this.tab="SOUND.TAB",this.containers=["BABYLON-EDITOR-EDITION-TOOL-SOUND"]}return __extends(i,n),i.prototype.isObjectSupported=function(t){return t instanceof e.Sound},i.prototype.createUI=function(){this._editionTool.panel.createTab({id:this.tab,caption:"Sound"})},i.prototype.update=function(){var e=this.object=this._editionTool.object;this._editionTool.core.currentScene.soundTracks[e.soundTrackId];if(n.prototype.update.call(this),!e)return!1;this._element=new t.GUI.GUIEditForm(this.containers[0],this._editionTool.core),this._element.buildElement(this.containers[0]),this._element.remember(e);var i=this._element.addFolder("Sound");if(i.add(this,"_playSound").name("Play Sound"),i.add(this,"_pauseSound").name("Pause Sound"),i.add(this,"_stopSound").name("Stop Sound"),this._volume=e.getVolume(),this._playbackRate=e._playbackRate,i.add(this,"_volume").min(0).max(1).step(.01).name("Volume").onChange(function(t){e.setVolume(t)}),i.add(this,"_playbackRate").min(0).max(1).step(.01).name("Playback Rate").onChange(function(t){e.setPlaybackRate(t)}),i.add(e,"rolloffFactor").min(0).max(1).step(.01).name("Rolloff Factor").onChange(function(t){e.updateOptions({rolloffFactor:t})}),i.add(e,"loop").name("Loop").onChange(function(t){e.updateOptions({loop:t})}),e.spatialSound){i.add(e,"distanceModel",["linear","exponential","inverse"]).name("Distance Model").onFinishChange(function(t){e.updateOptions({distanceModel:t})}),i.add(e,"maxDistance").min(0).name("Max Distance").onChange(function(t){e.updateOptions({maxDistance:t})}),this._position=e._position;var r=i.addFolder("Position");r.open(),r.add(this._position,"x").step(.1).onChange(this._positionCallback(e)).listen(),r.add(this._position,"y").step(.1).onChange(this._positionCallback(e)).listen(),r.add(this._position,"z").step(.1).onChange(this._positionCallback(e)).listen(),i.add(this,"_attachSoundToMesh").name("Attach to mesh...")}this._element.addFolder("Sound Track");return!0},i.prototype._positionCallback=function(e){var t=this;return function(n){e.setPosition(t._position)}},i.prototype._attachSoundToMesh=function(){var e=this,n=new t.ObjectPicker(this._editionTool.core);n.objectLists.push(this._editionTool.core.currentScene.meshes),n.minSelectCount=0,n.onObjectPicked=function(t){var n=null;t.length>0&&(n=e._editionTool.core.currentScene.getNodeByName(t[0]),n&&e.object.attachToMesh(n))},n.open()},i.prototype._pauseSound=function(){var e=this.object;e.pause()},i.prototype._playSound=function(){var e=this.object;e.play()},i.prototype._stopSound=function(){var e=this.object;e.stop()},i}(t.AbstractDatTool);t.AudioTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e){n.call(this,e),this.tab="LENSFLARE.TAB",this._dummyProperty="Lens Flare 1",this._currentLensFlareId=0,this.containers=["BABYLON-EDITOR-EDITION-TOOL-LENS-FLARE"]}return __extends(i,n),i.prototype.isObjectSupported=function(t){return t instanceof e.LensFlareSystem},i.prototype.createUI=function(){this._editionTool.panel.createTab({id:this.tab,caption:"Lens Flare"})},i.prototype.update=function(){var e=this,i=this.object=this._editionTool.object;this._editionTool.core.currentScene,this._editionTool.core;if(n.prototype.update.call(this),!i)return!1;this._element=new t.GUI.GUIEditForm(this.containers[0],this._editionTool.core),this._element.buildElement(this.containers[0]),this._element.remember(i);var r=this._element.addFolder("Common");r.add(i,"borderLimit").min(0).step(1).name("Border Limit"),r.add(this,"_addLensFlare").name("Add Lens Flare...");for(var a=[],o=0;o<i.lensFlares.length;o++)a.push("Lens Flare "+(o+1));r.add(this,"_dummyProperty",a).name("Lens Flare :").onFinishChange(function(t){var n=parseFloat(t.split("Lens Flare ")[1]);"number"==typeof n&&(n--,e._currentLensFlareId=n),e.update()});var s=i.lensFlares[this._currentLensFlareId];if(!s)return!1;var l=this._element.addFolder("Lens Flare"),c=this._element.addFolder("Color",l);return c.add(s.color,"r").min(0).max(1).name("R"),c.add(s.color,"g").min(0).max(1).name("G"),c.add(s.color,"b").min(0).max(1).name("B"),l.add(s,"position").step(.1).name("Position"),l.add(s,"size").step(.1).name("Size"),this.addTextureFolder(s,"Texture","texture",l).open(),this._setupRemove(this._currentLensFlareId),l.add(this,"_removeLensFlare"+this._currentLensFlareId).name("Remove..."),this._currentLensFlareId=0,this._dummyProperty="Lens Flare 1",!0},i.prototype._addLensFlare=function(){t.SceneFactory.AddLensFlare(this._editionTool.core,this.object,.5,0,new e.Color3(1,0,0));this.update()},i.prototype._reset=function(){for(var e in this)e.indexOf("_removeLensFlare")!==-1?delete this[e]:e.indexOf("_changeTexture")!==-1&&delete this[e];this.update()},i.prototype._setupRemove=function(e){var t=this;this["_removeLensFlare"+e]=function(){t.object.lensFlares[e].dispose(),t._reset()}},i}(t.AbstractDatTool);t.LensFlareTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e){n.call(this,e),this.tab="LIGHT.TAB",this._customShadowsGeneratorSize=512,this.containers=["BABYLON-EDITOR-EDITION-TOOL-LIGHT"]}return __extends(i,n),i.prototype.isObjectSupported=function(t){return t instanceof e.Light},i.prototype.createUI=function(){this._editionTool.panel.createTab({id:this.tab,caption:"Light"})},i.prototype.update=function(){var i=this.object=this._editionTool.object;if(n.prototype.update.call(this),!i)return!1;this._element=new t.GUI.GUIEditForm(this.containers[0],this._editionTool.core),this._element.buildElement(this.containers[0]),this._element.remember(i);var r=this._element.addFolder("Common");if(r.add(i,"intensity").min(0).name("Intensity"),r.add(i,"range").name("Range").min(0),r.add(i,"radius").min(0).step(.001).name("Radius"),i instanceof e.DirectionalLight){var a=this._element.addFolder("Direction");a.add(i.direction,"x").step(.1),a.add(i.direction,"y").step(.1),a.add(i.direction,"z").step(.1)}if(i instanceof e.SpotLight){var o=this._element.addFolder("Spot Light");o.add(i,"exponent").min(0).name("Exponent"),o.add(i,"angle").min(0).name("Angle")}if(i instanceof e.HemisphericLight){var s=this._element.addFolder("Hemispheric Light");this.addVectorFolder(i.direction,"Direction",!0,s),this.addColorFolder(i.groundColor,"Ground Color",!0,s)}var l=this._element.addFolder("Colors");if(i.diffuse){var c=l.addFolder("Diffuse Color");c.open(),c.add(i.diffuse,"r").min(0).max(1).step(.01),c.add(i.diffuse,"g").min(0).max(1).step(.01),c.add(i.diffuse,"b").min(0).max(1).step(.01)}if(i.specular){var d=l.addFolder("Specular Color");d.open(),d.add(i.specular,"r").min(0).max(1).step(.01),d.add(i.specular,"g").min(0).max(1).step(.01),d.add(i.specular,"b").min(0).max(1).step(.01)}var h=this._element.addFolder("Shadows"),u=i.getShadowGenerator();return u?(h.add(u,"useBlurVarianceShadowMap").name("Use Blur Variance Shadows Map").listen(),h.add(u,"useVarianceShadowMap").name("Use Variance Shadow Map").listen(),h.add(u,"usePoissonSampling").name("Use Poisson Sampling").listen(),void 0!==u.forceBackFacesOnly&&h.add(u,"forceBackFacesOnly").name("Force back faces only"),h.add(u,"_darkness").min(0).max(1).step(.01).name("Darkness"),h.add(u,"bias").name("Bias"),h.add(u,"blurBoxOffset").min(0).max(10).step(1).name("Blur Box Offset"),h.add(u,"blurScale").min(0).max(10).name("Blur Scale"),h.add(this,"_removeShadowGenerator").name("Remove Shadows Generator")):i instanceof e.HemisphericLight||(h.add(this,"_createShadowsGenerator").name("Create Shadows Generator"),h.add(this,"_customShadowsGeneratorSize").min(0).name("Shadow Map Size")),!0},i.prototype._createShadowsGenerator=function(){var t=this.object=this._editionTool.object,n=new e.ShadowGenerator(this._customShadowsGeneratorSize,t);e.Tags.EnableFor(n),e.Tags.AddTagsTo(n,"added"),this._editionTool.updateEditionTool()},i.prototype._removeShadowGenerator=function(){var e=this.object=this._editionTool.object,t=e.getShadowGenerator();t&&t.dispose(),e._shadowGenerator=null,this.update()},i}(t.AbstractDatTool);t.LightTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e){n.call(this,e),this.tab="MATERIAL.TAB",this._dummyProperty="",this._libraryDummyProperty="",this.containers=["BABYLON-EDITOR-EDITION-TOOL-MATERIAL"]}return __extends(i,n),i.prototype.isObjectSupported=function(t){return t instanceof e.AbstractMesh?!(t.material&&t.material instanceof e.MultiMaterial):t instanceof e.SubMesh},i.prototype.createUI=function(){this._editionTool.panel.createTab({id:this.tab,caption:"Material"})},i.prototype.update=function(){var i=this,r=this._editionTool.object,a=null,o=this._editionTool.core.currentScene;n.prototype.update.call(this),r instanceof e.AbstractMesh?a=r.material:r instanceof e.SubMesh&&(a=r.getMaterial()),this.object=r,this._element=new t.GUI.GUIEditForm(this.containers[0],this._editionTool.core),this._element.buildElement(this.containers[0]),this._element.remember(r);for(var s=this._element.addFolder("Material"),l=["None"],c=0;c<o.materials.length;c++)l.push(o.materials[c].name);if(this._dummyProperty=a&&a.name?a.name:l[0],s.add(this,"_dummyProperty",l).name("Material :").onFinishChange(function(t){if("None"===t)i._removeMaterial();else{var n=o.getMaterialByName(t);if(i._editionTool.object instanceof e.SubMesh){var r=i._editionTool.object.materialIndex,a=i._editionTool.object.getMesh().material;a instanceof e.MultiMaterial&&(i._editionTool.object.getMesh().material.subMaterials[r]=n)}else i._editionTool.object.material=n}i._editionTool.updateEditionTool()}),s.add(this,"_removeMaterial").name("Remove Material"),a){var d=this._element.addFolder("Common");d.add(a,"id").name("Id"),d.add(a,"alpha").min(0).max(1).name("Alpha");var h=this._element.addFolder("Options");h.add(a,"wireframe").name("Wire frame"),h.add(a,"fogEnabled").name("Fog Enabled"),h.add(a,"backFaceCulling").name("Back Face Culling"),h.add(a,"checkReadyOnEveryCall").name("Check Ready On every Call"),h.add(a,"checkReadyOnlyOnce").name("Check Ready Only Once"),h.add(a,"disableDepthWrite").name("Disable Depth Write"),void 0!==a.disableLighting&&h.add(a,"disableLighting").name("Disable Lighting")}var u=this._element.addFolder("Materials Library");return this._configureMaterialsLibrary(u),!0},i.prototype._configureMaterialsLibrary=function(e){var n=["None","StandardMaterial","PBRMaterial","FireMaterial","GradientMaterial","FurMaterial","GridMaterial","LavaMaterial","NormalMaterial","SkyMaterial","TerrainMaterial","TriPlanarMaterial","WaterMaterial","SimpleMaterial"],i=t.Tools.GetConstructorName(this.object.material);this._libraryDummyProperty="undefined"===i?n[0]:i,e.add(this,"_libraryDummyProperty",n).name("Material"),e.add(this,"_applyMaterial").name("Apply Material")},i.prototype._applyMaterial=function(){var n=new e[this._libraryDummyProperty]("New Material "+t.SceneFactory.GenerateUUID(),this._editionTool.core.currentScene);if(this.object instanceof e.AbstractMesh)this.object.material=n;else if(this.object instanceof e.SubMesh){var i=this.object,r=i.getMesh().material;if(!(r instanceof e.MultiMaterial))return;r.subMaterials[i.materialIndex]=n}if(n instanceof e.FurMaterial&&this.object instanceof e.AbstractMesh){var a=e.FurMaterial.GenerateTexture("furTexture",this._editionTool.core.currentScene);n.furTexture=a;for(var o=e.FurMaterial.FurifyMesh(this.object,30),s=0;s<o.length;s++)e.Tags.EnableFor(o[s]),e.Tags.AddTagsTo(o[s],"FurAdded")}this._editionTool.updateEditionTool()},i.prototype._removeMaterial=function(){if(this.object instanceof e.AbstractMesh)this.object.material=void 0;else if(this.object instanceof e.SubMesh){var t=this.object,n=t.getMesh().material;if(!(n instanceof e.MultiMaterial))return;n.subMaterials[t.materialIndex]=void 0}this._editionTool.updateEditionTool()},i.prototype._setMaterialsLibrary=function(){var n=t.GUI.GUIElement.CreateElement("div","BABYLON-EDITOR-MATERIALS-LIBRARY"),i=new t.GUI.GUIWindow("MaterialsLibraryWindow",this._editionTool.core,"Materials Library",n,new e.Vector2(800,600),["Select","Cancel"]);i.modal=!0,i.buildElement(null)},i}(t.AbstractDatTool);t.MaterialTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e){n.call(this,e),this.tab="PARTICLE.SYSTEM.TAB",this.containers=["BABYLON-EDITOR-EDITION-TOOL-PARTICLE-SYSTEM"]}return __extends(i,n),i.prototype.isObjectSupported=function(t){return t instanceof e.ParticleSystem},i.prototype.createUI=function(){this._editionTool.panel.createTab({id:this.tab,caption:"Particles"})},i.prototype.update=function(){var i=this.object=this._editionTool.object;this._editionTool.core.currentScene;n.prototype.update.call(this);var r=this._editionTool.core.editor.mainToolbar;if(r.toolbar.setItemEnabled(r.particleSystemCopyItem.id,null!==i,r.particleSystemMenu.id),r.toolbar.setItemEnabled(r.particleSystemPasteItem.id,i instanceof e.ParticleSystem,r.particleSystemMenu.id),t.GUIParticleSystemEditor._CurrentParticleSystem=i,!i)return!1;var a=new t.GUIParticleSystemEditor(this._editionTool.core,i,(!1));return this._element=a._createEditor(this.containers[0]),!0},i}(t.AbstractDatTool);t.ParticleSystemTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e){n.call(this,e),this.tab="POSTPROCESSES.TAB",this._renderEffects={},this.containers=["BABYLON-EDITOR-EDITION-TOOL-POSTPROCESSES"]}return __extends(i,n),i.prototype.isObjectSupported=function(t){return t instanceof e.Scene},i.prototype.createUI=function(){this._editionTool.panel.createTab({id:this.tab,caption:"Post-Processes"})},i.prototype.update=function(){var e=this,i=this.object=this._editionTool.object;if(n.prototype.update.call(this),!i)return!1;this._element=new t.GUI.GUIEditForm(this.containers[0],this._editionTool.core),this._element.buildElement(this.containers[0]),this._element.remember(i),t.SceneFactory.EnabledPostProcesses.standard=null!==t.SceneFactory.StandardPipeline,t.SceneFactory.EnabledPostProcesses.ssao=null!==t.SceneFactory.SSAOPipeline;var r=this._element.addFolder("HDR2");if(r.add(t.SceneFactory.EnabledPostProcesses,"standard").name("Enabled Standard").onChange(function(n){n===!0?t.SceneFactory.CreateStandardRenderingPipeline(e._editionTool.core):(t.SceneFactory.StandardPipeline.dispose(),t.SceneFactory.StandardPipeline=null),e.update()}),t.SceneFactory.StandardPipeline){var a=r.addFolder("Animations");a.add(this,"_editAnimations").name("Edit Animations");var o=r.addFolder("Highlighting");o.add(t.SceneFactory.StandardPipeline,"exposure").min(0).max(10).step(.01).name("Exposure"),o.add(t.SceneFactory.StandardPipeline,"brightThreshold").min(0).max(10).step(.01).name("Bright Threshold"),o.add(t.SceneFactory.StandardPipeline,"gaussianCoefficient").min(0).max(10).step(.01).name("Gaussian Coefficient"),o.add(t.SceneFactory.StandardPipeline,"gaussianMean").min(0).max(30).step(.01).name("Gaussian Mean"),o.add(t.SceneFactory.StandardPipeline,"gaussianStandardDeviation").min(0).max(30).step(.01).name("Gaussian Standard Deviation"),o.add(t.SceneFactory.StandardPipeline,"blurWidth").min(0).max(5).step(.01).name("Blur Width"),this.addTextureFolder(t.SceneFactory.StandardPipeline,"Lens Dirt Texture","lensTexture",o).open(),o.open();var s=r.addFolder("Lens Flare");s.add(t.SceneFactory.StandardPipeline,"LensFlareEnabled").name("Lens Flare Enabled"),s.add(t.SceneFactory.StandardPipeline,"lensFlareStrength").min(0).max(50).step(.01).name("Strength"),s.add(t.SceneFactory.StandardPipeline,"lensFlareHaloWidth").min(0).max(2).step(.01).name("Halo Width"),s.add(t.SceneFactory.StandardPipeline,"lensFlareGhostDispersal").min(0).max(10).step(.1).name("Ghost Dispersal"),s.add(t.SceneFactory.StandardPipeline,"lensFlareDistortionStrength").min(0).max(500).step(.1).name("Distortion Strength"),this.addTextureFolder(t.SceneFactory.StandardPipeline,"Lens Flare Dirt Texture","lensFlareDirtTexture",s).open(),s.open();var l=r.addFolder("Depth Of Field");l.add(t.SceneFactory.StandardPipeline,"DepthOfFieldEnabled").name("Enable Depth-Of-Field"),l.add(t.SceneFactory.StandardPipeline,"depthOfFieldDistance").min(0).max(this._editionTool.core.currentScene.activeCamera.maxZ).name("DOF Distance"),l.open();var c=r.addFolder("Debug");this._setupDebugPipeline(c,t.SceneFactory.StandardPipeline)}var d=this._element.addFolder("SSAO");if(d.add(t.SceneFactory.EnabledPostProcesses,"ssao").name("Enable SSAO").onChange(function(n){n===!0?t.SceneFactory.SSAOPipeline=t.SceneFactory.CreateSSAOPipeline(e._editionTool.core):(t.SceneFactory.SSAOPipeline.dispose(),t.SceneFactory.SSAOPipeline=null),e.update()}),t.SceneFactory.SSAOPipeline){d.add(t.SceneFactory.EnabledPostProcesses,"attachSSAO").name("Attach SSAO").onChange(function(t){e._attachDetachPipeline(t,"ssao")}),d.add(t.SceneFactory.SSAOPipeline,"totalStrength").min(0).max(10).step(.001).name("Strength"),d.add(t.SceneFactory.SSAOPipeline,"area").min(0).max(1).step(1e-4).name("Area"),d.add(t.SceneFactory.SSAOPipeline,"radius").min(0).max(1).step(1e-5).name("Radius"),d.add(t.SceneFactory.SSAOPipeline,"fallOff").min(0).step(1e-6).name("Fall Off"),d.add(t.SceneFactory.SSAOPipeline,"base").min(0).max(10).step(.001).name("Base");var c=d.addFolder("Debug");this._setupDebugPipeline(c,t.SceneFactory.SSAOPipeline)}var h=this._element.addFolder("Volumetric Light Scattering");return h.add(t.SceneFactory.EnabledPostProcesses,"vls").name("Enable VLS").onChange(function(n){if(n===!0){var i=new t.ObjectPicker(e._editionTool.core);i.objectLists.push(e._editionTool.core.currentScene.meshes),i.minSelectCount=0,i.closeButtonName="Cancel",i.selectButtonName="Add",i.windowName="Select an emitter?",i.onObjectPicked=function(n){var i=e._editionTool.core.currentScene.getMeshByName(n[0]);t.SceneFactory.VLSPostProcess=t.SceneFactory.CreateVLSPostProcess(e._editionTool.core,i),e.update()},i.open()}else t.SceneFactory.VLSPostProcess.dispose(e._editionTool.core.camera),t.SceneFactory.VLSPostProcess=null,e.update()}),t.SceneFactory.VLSPostProcess&&(h.add(t.SceneFactory.VLSPostProcess,"exposure").min(0).max(1).name("Exposure"),h.add(t.SceneFactory.VLSPostProcess,"decay").min(0).max(1).name("Decay"),h.add(t.SceneFactory.VLSPostProcess,"weight").min(0).max(1).name("Weight"),h.add(t.SceneFactory.VLSPostProcess,"density").min(0).max(1).name("Density"),h.add(t.SceneFactory.VLSPostProcess,"invert").name("Invert"),h.add(t.SceneFactory.VLSPostProcess,"useDiffuseColor").name("use Diffuse Color"),h.add(t.SceneFactory.VLSPostProcess,"useCustomMeshPosition").name("Use Custom Position"),this.addVectorFolder(t.SceneFactory.VLSPostProcess.customMeshPosition,"Position",!0,h),h.add(this,"_setVLSAttachedNode").name("Attach Node...")),!0},i.prototype._setVLSAttachedNode=function(){var e=this,n=new t.ObjectPicker(this._editionTool.core);n.objectLists.push(this._editionTool.core.currentScene.meshes),n.objectLists.push(this._editionTool.core.currentScene.lights),n.objectLists.push(this._editionTool.core.currentScene.cameras),n.minSelectCount=0,n.onObjectPicked=function(n){var i=null;n.length>0&&(i=e._editionTool.core.currentScene.getNodeByName(n[0])),t.SceneFactory.VLSPostProcess.attachedNode=i},n.open()},i.prototype._setupDebugPipeline=function(e,t){var n=this,i=t._renderEffects,r=function(){for(var e in i)n._renderEffects[e]===!0?t._enableEffect(e,n._getPipelineCameras()):t._disableEffect(e,n._getPipelineCameras())};for(var a in i){i[a];this._renderEffects[a]||(this._renderEffects[a]=!0),e.add(this._renderEffects,a).onChange(function(e){r()})}},i.prototype._attachDetachPipeline=function(e,t){e?this._editionTool.core.currentScene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(t,this._getPipelineCameras()):this._editionTool.core.currentScene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(t,this._getPipelineCameras())},i.prototype._getPipelineCameras=function(){var e=[this._editionTool.core.camera];return this._editionTool.core.playCamera&&e.push(this._editionTool.core.playCamera),e},i.prototype._loadHDRLensDirtTexture=function(){var n=this,i=t.Tools.CreateFileInpuElement("HDR-LENS-DIRT-LOAD-TEXTURE");i.change(function(r){var a=r.target.files||r.currentTarget.files;if(!(a.length<1)){var o=a[0];e.Tools.ReadFileAsDataURL(o,function(r){var a=e.Texture.CreateFromBase64String(r,o.name,n._editionTool.core.currentScene);a.name=a.name.replace("data:",""),t.SceneFactory.HDRPipeline.lensTexture=a,i.remove()},null)}}),i.click()},i.prototype._editAnimations=function(){new t.GUIAnimationEditor(this._editionTool.core,t.SceneFactory.StandardPipeline)},i}(t.AbstractDatTool);t.PostProcessesTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e){n.call(this,e),this.tab="REFLECTION.PROBE.TAB",this._window=null,this._excludedMeshesList=null,this._includedMeshesList=null,this._layouts=null,this.containers=["BABYLON-EDITOR-EDITION-TOOL-RENDER-TARGET"],this._editionTool.core.eventReceivers.push(this)}return __extends(i,n),i.prototype.onEvent=function(e){if(e.eventType!==t.EventType.GUI_EVENT)return!1;if(e.guiEvent.eventType!==t.GUIEventType.GRID_ROW_ADDED&&e.guiEvent.eventType!==t.GUIEventType.GRID_ROW_REMOVED)return!1;var n=this.object;if(e.guiEvent.caller===this._includedMeshesList){for(var i=this._includedMeshesList.getSelectedRows(),r=0;r<i.length;r++){var a=n.renderList[i[r]-r],o=n.renderList.indexOf(a);o!==-1&&n.renderList.splice(o,1),this._excludedMeshesList.addRecord({name:a.name})}return this._excludedMeshesList.refresh(),!0}if(e.guiEvent.caller===this._excludedMeshesList){for(var i=this._excludedMeshesList.getSelectedRows(),s=0,r=0;r<i.length;r++){var a=this._editionTool.core.currentScene.getMeshByName(this._excludedMeshesList.getRow(i[r]).name);
n.renderList.push(a),this._includedMeshesList.addRecord({name:a.name}),this._excludedMeshesList.removeRecord(i[r]-s),s++}return this._includedMeshesList.refresh(),this._excludedMeshesList.refresh(),!0}return!1},i.prototype.isObjectSupported=function(t){return!!(t instanceof e.ReflectionProbe||t instanceof e.RenderTargetTexture||t instanceof e.Light&&t.getShadowGenerator())},i.prototype.createUI=function(){this._editionTool.panel.createTab({id:this.tab,caption:"Render"})},i.prototype.update=function(){var i=this;n.prototype.update.call(this);var r=this.object=this._editionTool.object;r instanceof e.Light&&r.getShadowGenerator()&&(r=this.object=r.getShadowGenerator().getShadowMap());this._editionTool.core.currentScene;if(!r)return!1;this._element=new t.GUI.GUIEditForm(this.containers[0],this._editionTool.core),this._element.buildElement(this.containers[0]),this._element.remember(r);var a=this._element.addFolder("Common");if(a.add(r,"name").name("Name").onChange(function(e){var t=i._editionTool.core.editor.sceneGraphTool.sidebar,n=t.getSelectedNode();n&&(n.text=e,t.refresh())}),a.add(r,"refreshRate").name("Refresh Rate").min(0).step(1),a.add(this,"_setIncludedMeshes").name("Configure Render List..."),r instanceof e.ReflectionProbe&&a.add(this,"_attachToMesh").name("Attach To Mesh..."),r instanceof e.RenderTargetTexture&&a.add(this,"_exportRenderTarget").name("Dump Render Target"),r instanceof e.ReflectionProbe){var o=this._element.addFolder("Position");o.add(r.position,"x").step(.01),o.add(r.position,"y").step(.01),o.add(r.position,"z").step(.01)}return!0},i.prototype._exportRenderTarget=function(){var n=this,i=this.object,r=i.onAfterRender,a=i.getSize().width,o=i.getSize().height;i.onAfterRender=function(){e.Tools.DumpFramebuffer(a,o,n._editionTool.core.engine,function(e){t.Tools.OpenWindowPopup(e,a,o)})},i.render(!1),this._editionTool.core.currentScene.incrementRenderId(),r&&r(0),i.onAfterRender=r},i.prototype._attachToMesh=function(){var e=this,n=new t.ObjectPicker(this._editionTool.core);n.objectLists.push(n.core.currentScene.meshes),n.onObjectPicked=function(i){if(i.length>1){var r=new t.GUI.GUIDialog("ReflectionProbeDialog",n.core,"Warning","A Reflection Probe can be attached to only one mesh.\nThe first was considered as the mesh.");r.buildElement(null)}e.object.attachToMesh(n.core.currentScene.getMeshByName(i[0]))},n.open()},i.prototype._setIncludedMeshes=function(){var e=this,n="REFLECTION-PROBES-RENDER-LIST-LAYOUT",i="REFLECTION-PROBES-RENDER-LIST-LAYOUT-LEFT",r="REFLECTION-PROBES-RENDER-LIST-LAYOUT-RIGHT",a="REFLECTION-PROBES-RENDER-LIST-LIST-EXCLUDED",o="REFLECTION-PROBES-RENDER-LIST-LIST-INCLUDED",s=t.GUI.GUIElement.CreateElement("div",n);this._window=new t.GUI.GUIWindow("REFLECTION-PROBES-RENDER-LIST-WINDOW",this._editionTool.core,"Configure Render List",s),this._window.modal=!0,this._window.size.x=800,this._window.buildElement(null),this._window.setOnCloseCallback(function(){e._includedMeshesList.destroy(),e._excludedMeshesList.destroy(),e._layouts.destroy(),e._includedMeshesList=null,e._excludedMeshesList=null}),this._window.onToggle=function(t,n,i){e._layouts.getPanelFromType("left").width=n/2,e._layouts.getPanelFromType("main").width=i/2,e._layouts.resize()};var l=t.GUI.GUIElement.CreateElement("div",i),c=t.GUI.GUIElement.CreateElement("div",r);this._layouts=new t.GUI.GUILayout(n,this._editionTool.core),this._layouts.createPanel(l,"left",400,!0).setContent(l),this._layouts.createPanel(c,"main",400,!0).setContent(c),this._layouts.buildElement(n);var d=this._editionTool.core.currentScene,h=this.object;this._excludedMeshesList=new t.GUI.GUIGrid(a,this._editionTool.core),this._excludedMeshesList.header="Excluded Meshes",this._excludedMeshesList.showAdd=!0,this._excludedMeshesList.createColumn("name","name","100%"),this._excludedMeshesList.buildElement(i);for(var u=0;u<d.meshes.length;u++)h.renderList.indexOf(d.meshes[u])===-1&&this._excludedMeshesList.addRecord({name:d.meshes[u].name});this._excludedMeshesList.refresh(),this._includedMeshesList=new t.GUI.GUIGrid(o,this._editionTool.core),this._includedMeshesList.header="Included Meshes",this._includedMeshesList.showDelete=!0,this._includedMeshesList.createColumn("name","name","100%"),this._includedMeshesList.buildElement(r);for(var u=0;u<h.renderList.length;u++)this._includedMeshesList.addRecord({name:h.renderList[u].name});this._includedMeshesList.refresh()},i}(t.AbstractDatTool);t.ReflectionProbeTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e){n.call(this,e),this.tab="SCENE.TAB",this._fogType="",this._physicsEnabled=!1,this.containers=["BABYLON-EDITOR-EDITION-TOOL-SCENE"]}return __extends(i,n),i.prototype.isObjectSupported=function(t){return t instanceof e.Scene},i.prototype.createUI=function(){this._editionTool.panel.createTab({id:this.tab,caption:"Scene"})},i.prototype.update=function(){var i=this.object=this._editionTool.object;if(n.prototype.update.call(this),!i)return!1;this._element=new t.GUI.GUIEditForm(this.containers[0],this._editionTool.core),this._element.buildElement(this.containers[0]),this._element.remember(i),this._element.add(t.SceneFactory,"AnimationSpeed").min(0).name("Animation Speed");var r=this._element.addFolder("Colors"),a=r.addFolder("Ambient Color");a.open(),a.add(i.ambientColor,"r").min(0).max(1).step(.01),a.add(i.ambientColor,"g").min(0).max(1).step(.01),a.add(i.ambientColor,"b").min(0).max(1).step(.01);var o=r.addFolder("Clear Color");o.open(),o.add(i.clearColor,"r").min(0).max(1).step(.01),o.add(i.clearColor,"g").min(0).max(1).step(.01),o.add(i.clearColor,"b").min(0).max(1).step(.01);var s=this._element.addFolder("Collisions");s.add(i,"collisionsEnabled").name("Collisions Enabled");var l=s.addFolder("Gravity");l.add(i.gravity,"x"),l.add(i.gravity,"y"),l.add(i.gravity,"z");var c=this._element.addFolder("Physics");this._physicsEnabled=i.isPhysicsEnabled(),c.add(this,"_physicsEnabled").name("Enable Physics").onChange(function(t){t?(i.enablePhysics(i.gravity,new e.CannonJSPlugin),i.getPhysicsEngine().setTimeStep(0)):i.disablePhysicsEngine()});var d=this._element.addFolder("Audio");d.add(i,"audioEnabled").name("Audio Enabled");var h=this._element.addFolder("Fog"),u=["None","Exp","Exp2","Linear"];switch(i.fogMode){case e.Scene.FOGMODE_EXP:this._fogType="Exp";break;case e.Scene.FOGMODE_EXP2:this._fogType="Exp2";break;case e.Scene.FOGMODE_LINEAR:this._fogType="Linear";break;default:this._fogType="None"}h.add(this,"_fogType",u).name("Fog Mode").onFinishChange(function(t){switch(t){case"Exp":i.fogMode=e.Scene.FOGMODE_EXP;break;case"Exp2":i.fogMode=e.Scene.FOGMODE_EXP2;break;case"Linear":i.fogMode=e.Scene.FOGMODE_LINEAR;break;default:i.fogMode=e.Scene.FOGMODE_NONE}}),h.add(i,"fogEnabled").name("Enable Fog"),h.add(i,"fogStart").name("Fog Start").min(0),h.add(i,"fogEnd").name("Fog End").min(0),h.add(i,"fogDensity").name("Fog Density").min(0);var p=h.addFolder("Fog Color");p.add(i.fogColor,"r").min(0).max(1).step(.001),p.add(i.fogColor,"g").min(0).max(1).step(.001),p.add(i.fogColor,"b").min(0).max(1).step(.001);var m=this._element.addFolder("Capacities");return m.close(),m.add(i,"postProcessesEnabled").name("Post-Processes Enabled"),m.add(i,"shadowsEnabled").name("Shadows Enabled"),m.add(i,"fogEnabled").name("Fog Enabled"),m.add(i,"lensFlaresEnabled").name("Lens Flares Enabled"),m.add(i,"lightsEnabled").name("Lights Enabled"),m.add(i,"particlesEnabled").name("Particles Enabled"),m.add(i,"probesEnabled").name("Reflection Probes Enabled"),m.add(i,"proceduralTexturesEnabled").name("Procedural Textures Enabled"),m.add(i,"renderTargetsEnabled").name("Render Targets Enabled"),m.add(i,"texturesEnabled").name("Textures Enabled"),m.add(i,"skeletonsEnabled").name("Skeletons Enabled"),!0},i}(t.AbstractDatTool);t.SceneTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e){n.call(this,e),this.tab="TEXTURE.TAB",this._currentCoordinatesMode="",this.containers=["BABYLON-EDITOR-EDITION-TOOL-TEXTURE"]}return __extends(i,n),i.prototype.isObjectSupported=function(t){return t instanceof e.BaseTexture},i.prototype.createUI=function(){this._editionTool.panel.createTab({id:this.tab,caption:"Texture"})},i.prototype.update=function(){var i=this.object=this._editionTool.object;if(n.prototype.update.call(this),!i)return!1;this._element=new t.GUI.GUIEditForm(this.containers[0],this._editionTool.core),this._element.buildElement(this.containers[0]),this._element.remember(i);var r=["EXPLICIT_MODE","SPHERICAL_MODE","PLANAR_MODE","CUBIC_MODE","PROJECTION_MODE","SKYBOX_MODE","INVCUBIC_MODE","EQUIRECTANGULAR_MODE","FIXED_EQUIRECTANGULAR_MODE"],a=this._element.addFolder("Common");if(a.add(i,"getAlphaFromRGB").name("Get Alpha From RGB"),a.add(i,"hasAlpha").name("Has Alpha"),this._currentCoordinatesMode=r[i.coordinatesMode],a.add(this,"_currentCoordinatesMode",r,"Coordinates Mode").name("Coordinates Mode").onChange(function(t){return i.coordinatesMode=e.Texture[t]}),i instanceof e.Texture){var o=this._element.addFolder("Texture");o.add(i,"uScale").name("uScale"),o.add(i,"vScale").name("vScale")}return!0},i}(t.AbstractDatTool);t.TextureTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e,t,i,r){n.call(this,e),this._tabName="New Tab",this.material=null,this.containers=["BABYLON-EDITOR-EDITION-TOOL-"+t],this.tab="MATERIAL."+i,this._tabName=r}return __extends(i,n),i.prototype.isObjectSupported=function(t){if(t instanceof e.AbstractMesh){if(t.material&&!(t.material instanceof e.MultiMaterial)&&this.onObjectSupported(t.material))return!0}else if(t instanceof e.SubMesh){var n=t,i=n.getMesh().material;if(i instanceof e.MultiMaterial&&i.subMaterials[n.materialIndex]&&this.onObjectSupported(i.subMaterials[n.materialIndex]))return!0}return!1},i.prototype.createUI=function(){this._editionTool.panel.createTab({id:this.tab,caption:this._tabName})},i.prototype.update=function(){var i=this._editionTool.object;this._editionTool.core.currentScene;return n.prototype.update.call(this),i instanceof e.AbstractMesh?this.material=i.material:i instanceof e.SubMesh&&(this.material=i.getMaterial()),!!this.material&&(this.object=i,this._element=new t.GUI.GUIEditForm(this.containers[0],this._editionTool.core),this._element.buildElement(this.containers[0]),this._element.remember(i),!0)},i.prototype.addTextureButton=function(e,t,i,r,a){return void 0===r&&(r=!1),n.prototype.addTextureFolder.call(this,this.material,e,t,i,r,a)},i}(t.AbstractDatTool);t.AbstractMaterialTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(t){function n(n){t.call(this,n,"PBR-MATERIAL","PBR","PBR"),this._dummyPreset="",this.onObjectSupported=function(t){return t instanceof e.PBRMaterial}}return __extends(n,t),n.prototype.update=function(){var e=this;if(!t.prototype.update.call(this))return!1;this.material.useLogarithmicDepth=this.material.useLogarithmicDepth||!1,this._dummyPreset="None";var n=[this._dummyPreset,"Glass","Metal","Plastic","Wood"];this._element.add(this,"_dummyPreset",n,"Preset :").onChange(function(t){e["_createPreset"+t]&&(e["_createPreset"+t](),e.update())});var i=this._element.addFolder("PBR");i.add(this.material,"cameraContrast").step(.01).name("Camera Contrast"),i.add(this.material,"cameraExposure").step(.01).name("Camera Exposure"),i.add(this.material,"microSurface").min(0).step(.01).name("Micro Surface"),i.add(this.material,"usePhysicalLightFalloff").name("use Physical Light Fall Off");var r=this._element.addFolder("Albedo");this.addColorFolder(this.material.albedoColor,"Albedo Color",!0,r),r.add(this.material,"directIntensity").step(.01).name("Direct Intensity"),r.add(this.material,"useAlphaFromAlbedoTexture").name("Use Alpha From Albedo Texture"),this.addTextureButton("Albedo Texture","albedoTexture",r);var a=this._element.addFolder("Bump & Parallax");a.open(),a.add(this.material,"useParallax").name("Use Parallax"),a.add(this.material,"useParallaxOcclusion").name("Use Parallax Occlusion"),a.add(this.material,"parallaxScaleBias").step(.001).name("Bias"),this.addTextureButton("Bump Texture","bumpTexture",a);var o=this._element.addFolder("Reflectivity");this.addColorFolder(this.material.reflectivityColor,"Reflectivity Color",!0,o),o.add(this.material,"specularIntensity").min(0).step(.01).name("Specular Intensity"),o.add(this.material,"useSpecularOverAlpha").name("Use Specular Over Alpha"),o.add(this.material,"useMicroSurfaceFromReflectivityMapAlpha").name("Use Micro Surface From Reflectivity Map Alpha"),this.addTextureButton("Reflectivity Texture","reflectivityTexture",o);var s=this._element.addFolder("Reflection");this.addColorFolder(this.material.reflectionColor,"Reflection Color",!0,s),s.add(this.material,"environmentIntensity").step(.01).name("Environment Intensity"),this.addTextureButton("Reflection Texture","reflectionTexture",s,!0);var l=this._element.addFolder("Emissive");this.addColorFolder(this.material.emissiveColor,"Emissive Color",!0,l),l.add(this.material,"emissiveIntensity").step(.01).name("Emissive Intensity"),l.add(this.material,"linkEmissiveWithAlbedo").name("Link Emissive With Albedo"),l.add(this.material,"useEmissiveAsIllumination").name("Use Emissive As Illumination"),this.addTextureButton("Emissive Texture","emissiveTexture",l);var c=this._element.addFolder("Ambient");this.addColorFolder(this.material.ambientColor,"Ambient Color",!0,c),this.addTextureButton("Ambient Texture","ambientTexture",c);var d=this._element.addFolder("Light Map");d.add(this.material,"useLightmapAsShadowmap").name("Use Lightmap As Shadowmap"),this.addTextureButton("Light Map Texture","lightmapTexture",d);var h=this._element.addFolder("Refraction");h.add(this.material,"indexOfRefraction").name("Index of Refraction"),this.addTextureButton("Refraction Texture","refractionTexture",h,!0);var u=this._element.addFolder("Options");u.add(this.material,"useLightmapAsShadowmap").name("Use Lightmap As Shadowmap"),u.add(this.material,"useLogarithmicDepth").name("Use Logarithmic Depth");var p=this._element.addFolder("Debug");return p.add(this.material,"overloadedShadowIntensity").min(0).step(.01).name("Shadow Intensity"),p.add(this.material,"overloadedShadeIntensity").min(0).step(.01).name("Shade Intensity"),r=p.addFolder("Albedo Debug"),this.addColorFolder(this.material.overloadedAlbedo,"Albedo Color",!0,r),r.add(this.material,"overloadedAlbedoIntensity").min(0).step(.01).name("Albedo Intensity"),o=p.addFolder("Reflectivity Debug"),this.addColorFolder(this.material.overloadedReflectivity,"Reflectivity Color",!0,o),o.add(this.material,"overloadedReflectivityIntensity").min(0).step(.01).name("Reflectivity Intensity"),s=p.addFolder("Reflection Debug"),this.addColorFolder(this.material.overloadedReflection,"Reflection Color",!0,s),s.add(this.material,"overloadedReflectionIntensity").min(0).step(.01).name("Reflection Intensity"),c=p.addFolder("Ambient Debug"),this.addColorFolder(this.material.overloadedAmbient,"Reflection Color",!0,c),c.add(this.material,"overloadedAmbientIntensity").min(0).step(.01).name("Ambient Intensity"),l=p.addFolder("Emissive Debug"),this.addColorFolder(this.material.overloadedEmissive,"Emissive Color",!0,l),l.add(this.material,"overloadedEmissiveIntensity").min(0).step(.01).name("Emissive Intensity"),!0},n.prototype._createPresetGlass=function(){this.material.linkRefractionWithTransparency=!0,this.material.useMicroSurfaceFromReflectivityMapAlpha=!1,this.material.indexOfRefraction=.52,this.material.alpha=0,this.material.directIntensity=0,this.material.environmentIntensity=.5,this.material.cameraExposure=.5,this.material.cameraContrast=1.7,this.material.microSurface=1},n.prototype._createPresetMetal=function(){this.material.linkRefractionWithTransparency=!1,this.material.useMicroSurfaceFromReflectivityMapAlpha=!1,this.material.directIntensity=.3,this.material.environmentIntensity=.7,this.material.cameraExposure=.55,this.material.cameraContrast=1.6,this.material.microSurface=.96},n.prototype._createPresetPlastic=function(){this.material.linkRefractionWithTransparency=!1,this.material.useMicroSurfaceFromReflectivityMapAlpha=!1,this.material.directIntensity=.6,this.material.environmentIntensity=.7,this.material.cameraExposure=.6,this.material.cameraContrast=1.6,this.material.microSurface=.96},n.prototype._createPresetWood=function(){this.material.linkRefractionWithTransparency=!1,this.material.directIntensity=1.5,this.material.environmentIntensity=.5,this.material.specularIntensity=.3,this.material.cameraExposure=.9,this.material.cameraContrast=1.6,this.material.useMicroSurfaceFromReflectivityMapAlpha=!0},n}(t.AbstractMaterialTool);t.PBRMaterialTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(t){function n(n){t.call(this,n,"SKY-MATERIAL","SKY","Sky"),this.onObjectSupported=function(t){return t instanceof e.SkyMaterial}}return __extends(n,t),n.prototype.update=function(){return!!t.prototype.update.call(this)&&(this._element.add(this.material,"inclination").step(.01).name("Inclination"),this._element.add(this.material,"azimuth").step(.01).name("Azimuth"),this._element.add(this.material,"luminance").step(.01).name("Luminance"),this._element.add(this.material,"turbidity").step(.01).name("Turbidity"),this._element.add(this.material,"mieCoefficient").step(1e-4).name("Mie Coefficient"),this._element.add(this.material,"mieDirectionalG").step(.01).name("Mie Coefficient G"),this._element.add(this.material,"rayleigh").step(.01).name("Reileigh Coefficient"),!0)},n}(t.AbstractMaterialTool);t.SkyMaterialTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(t){function n(n){t.call(this,n,"STANDARD-MATERIAL","STANDARD","Std Material"),this.onObjectSupported=function(t){return t instanceof e.StandardMaterial}}return __extends(n,t),n.prototype.update=function(){if(!t.prototype.update.call(this))return!1;this.material.useLogarithmicDepth=this.material.useLogarithmicDepth||!1,this.material.useEmissiveAsIllumination=this.material.useEmissiveAsIllumination||!1,this.material.useReflectionFresnelFromSpecular=this.material.useReflectionFresnelFromSpecular||!1;var e=this._element.addFolder("Values");e.add(this.material,"roughness").min(0).step(.01).name("Roughness");var n=this._element.addFolder("Options");n.add(this.material,"useLogarithmicDepth").name("Use Logarithmic Depth"),n.add(this.material,"useReflectionFresnelFromSpecular").name("Use Reflection Fresnel From Specular");var i=this._element.addFolder("Diffuse");this.addColorFolder(this.material.diffuseColor,"Diffuse Color",!0,i),i.add(this.material,"useAlphaFromDiffuseTexture").name("Use Alpha From Diffuse Texture"),this.addTextureButton("Diffuse Texture","diffuseTexture",i);var r=this._element.addFolder("Bump & Parallax");r.add(this.material,"useParallax").name("Use Parallax"),r.add(this.material,"useParallaxOcclusion").name("Use Parallax Occlusion"),r.add(this.material,"parallaxScaleBias").step(.001).name("Bias"),this.addTextureButton("Bump Texture","bumpTexture",r);var a=this._element.addFolder("Specular");this.addColorFolder(this.material.specularColor,"Specular Color",!0,a),a.add(this.material,"specularPower").min(0).step(.01).name("Specular Power"),a.add(this.material,"useSpecularOverAlpha").name("Use Specular Over Alpha"),a.add(this.material,"useGlossinessFromSpecularMapAlpha").name("Use Glossiness From Specular Map Alpha"),this.addTextureButton("Specular Texture","specularTexture",a);var o=this.addTextureButton("Opacity Texture","opacityTexture",null);o.open();var s=this._element.addFolder("Emissive");this.addColorFolder(this.material.emissiveColor,"Emissive Color",!0,s),s.add(this.material,"useEmissiveAsIllumination").name("Use Emissive As Illumination"),this.addTextureButton("Emissive Texture","emissiveTexture",s);var l=this._element.addFolder("Ambient");this.addColorFolder(this.material.ambientColor,"Ambient Color",!0,l),this.addTextureButton("Ambient Texture","ambientTexture",l);var c=this._element.addFolder("Light Map");c.add(this.material,"useLightmapAsShadowmap").name("Use Lightmap As Shadowmap"),this.addTextureButton("Light Map Texture","lightmapTexture",c);var d=this._element.addFolder("Reflection");this.addTextureButton("Reflection Texture","reflectionTexture",d,!0);var h=this._element.addFolder("Refraction");h.add(this.material,"indexOfRefraction").name("Index of Refraction"),h.add(this.material,"invertRefractionY").name("Invert Y"),this.addTextureButton("Refraction Texture","refractionTexture",h,!0);var u=this._element.addFolder("Functions");return u.add(this,"_convertToPBR").name("Convert to PBR Material"),!0},n.prototype._convertToPBR=function(){var t=new e.PBRMaterial(this.material.name+"_PBR",this._editionTool.core.currentScene);if(t.albedoColor=this.material.diffuseColor,t.albedoTexture=this.material.diffuseTexture,t.useAlphaFromAlbedoTexture=this.material.useAlphaFromDiffuseTexture,t.linkEmissiveWithAlbedo=this.material.linkEmissiveWithDiffuse,t.bumpTexture=this.material.bumpTexture,t.parallaxScaleBias=this.material.parallaxScaleBias,t.useParallax=this.material.useParallax,t.useParallaxOcclusion=this.material.useParallaxOcclusion,t.specularIntensity=this.material.specularPower,t.reflectivityColor=this.material.specularColor,t.reflectivityTexture=this.material.specularTexture,t.useSpecularOverAlpha=this.material.useSpecularOverAlpha,t.emissiveColor=this.material.emissiveColor,t.emissiveTexture=this.material.emissiveTexture,t.useEmissiveAsIllumination=this.material.useEmissiveAsIllumination,t.emissiveFresnelParameters=this.material.emissiveFresnelParameters,t.indexOfRefraction=this.material.indexOfRefraction,t.invertRefractionY=this.material.invertRefractionY,t.refractionTexture=this.material.refractionTexture,t.reflectionTexture=this.material.reflectionTexture,t.opacityFresnelParameters=this.material.opacityFresnelParameters,t.opacityTexture=this.material.opacityTexture,t.ambientColor=this.material.ambientColor,t.ambientTexture=this.material.ambientTexture,this.object instanceof e.SubMesh){var n=this.object.materialIndex,i=this.object.getMesh().material;i instanceof e.MultiMaterial&&(this.object.getMesh().material.subMaterials[n]=t)}else this.object.material=t;this._editionTool.updateEditionTool()},n}(t.AbstractMaterialTool);t.StandardMaterialTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(t){n.call(this,t,"WATER-MATERIAL","WATER","Water"),this.onObjectSupported=function(t){return t instanceof e.WaterMaterial}}return __extends(i,n),i.prototype.update=function(){var e=this;if(!n.prototype.update.call(this))return!1;this.addColorFolder(this.material.diffuseColor,"Diffuse Color",!0),this.addColorFolder(this.material.specularColor,"Specular Color",!0),this._element.add(this.material,"specularPower").min(0).step(.1).name("Specular Power");var t=this._element.addFolder("Bump");t.add(this.material,"bumpHeight").min(0).step(.01).name("Bump Height"),this.addTextureButton("Texture","bumpTexture",t);var i=this._element.addFolder("Wind");i.add(this.material,"windForce").min(0).step(.01).name("Wind Force"),this.addVectorFolder(this.material.windDirection,"Wind Direction",!0,i);var r=this._element.addFolder("Waves");r.add(this.material,"waveHeight").min(0).step(.01).name("Wave Height"),r.add(this.material,"waveLength").min(0).step(.01).name("Wave Length"),r.add(this.material,"waveSpeed").min(0).step(.01).name("Wave Speed");var a=this._element.addFolder("Color");a.add(this.material,"colorBlendFactor").min(0).max(1).step(.01).name("Blend Factor"),this.addColorFolder(this.material.waterColor,"Water Color",!0,a);var o=this._element.addFolder("Advanced");o.add(this.material,"bumpSuperimpose").name("Bump Super Impose"),o.add(this.material,"bumpAffectsReflection").name("Bump Affects Reflection"),o.add(this.material,"fresnelSeparate").name("Fresnel Separate"),o.add(this.material,"colorBlendFactor2").min(0).max(1).step(.01).name("Blend Factor 2"),this.addColorFolder(this.material.waterColor2,"Water Color 2",!0,o),this._rtsEnabled=this.material.renderTargetsEnabled;var s=this._element.addFolder("Reflection & Refraction");return s.add(this,"_rtsEnabled").name("Enable Reflection & Refraction").onChange(function(t){e.material.enableRenderTargets(t)}),s.add(this,"_configureReflection").name("Render..."),!0},i.prototype._configureReflection=function(){var e=this,n=this.material.getScene(),i=(this.material.getRenderList(),new t.ObjectPicker(this._editionTool.core));i.objectLists.push(n.meshes),i.selectedObjects=this.material.getRenderList(),i.minSelectCount=0,i.open(),i.onObjectPicked=function(t){e.material.reflectionTexture.renderList=[],e.material.refractionTexture.renderList=[];for(var i=0;i<t.length;i++){var r=n.getMeshByName(t[i]);r&&e.material.addToRenderList(r)}}},i}(t.AbstractMaterialTool);t.WaterMaterialTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(t){function n(n){t.call(this,n,"LAVA-MATERIAL","LAVA","Lava"),this.onObjectSupported=function(t){return t instanceof e.LavaMaterial}}return __extends(n,t),n.prototype.update=function(){if(!t.prototype.update.call(this))return!1;var e=this._element.addFolder("Diffuse");this.addColorFolder(this.material.diffuseColor,"Diffuse Color",!0,e),this.addTextureButton("Texture","diffuseTexture",e);var n=this._element.addFolder("Lava");this.addTextureButton("Noise Texture","noiseTexture",n),n.add(this.material,"movingSpeed").min(0).name("Moving Speed"),n.add(this.material,"lowFrequencySpeed").min(0).name("Low Frequency Speed");var i=this._element.addFolder("Fog");return this.addColorFolder(this.material.fogColor,"Fog Color",!0,i),i.add(this.material,"fogDensity").min(0).name("Fog Density"),!0},n}(t.AbstractMaterialTool);t.LavaMaterialTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(t){function n(n){t.call(this,n,"FUR-MATERIAL","FUR","Fur"),this.onObjectSupported=function(t){return t instanceof e.FurMaterial}}return __extends(n,t),n.prototype.update=function(){var e=this;if(!t.prototype.update.call(this))return!1;var n=function(){e.material.updateFur()},i=this._element.addFolder("Diffuse");this.addColorFolder(this.material.diffuseColor,"Diffuse Color",!0,i,n),this.addTextureButton("Texture","diffuseTexture",i,!1,n);var r=this._element.addFolder("Fur");return this.addColorFolder(this.material.furColor,"Fur Color",!0,r,n),r.add(this.material,"furLength").min(0).step(.01).name("Fur Length").onChange(function(e){n()}),r.add(this.material,"furAngle").min(0).step(.1).name("Fur Angle").onChange(function(e){n()}),r.add(this.material,"furSpacing").min(0).step(.01).name("Fur Spacing").onChange(function(e){n()}),r.add(this.material,"furSpeed").min(1).max(1e3).step(.01).name("Fur Speed").onChange(function(e){n()}),r.add(this.material,"furDensity").min(0).step(.1).name("Fur Density").onChange(function(e){n()}),r.add(this.material,"highLevelFur").name("High Level Fur").onChange(function(e){n()}),this.addVectorFolder(this.material.furGravity,"Gravity",!0,r,n),!0},n}(t.AbstractMaterialTool);t.FurMaterialTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(t){function n(n){t.call(this,n,"GRADIENT-MATERIAL","GRADIENT","Gradient"),this.onObjectSupported=function(t){return t instanceof e.GradientMaterial}}return __extends(n,t),n.prototype.update=function(){if(!t.prototype.update.call(this))return!1;var e=this._element.addFolder("Top");this.addColorFolder(this.material.topColor,"Top Color",!0,e),e.add(this.material,"topColorAlpha").min(0).max(1).step(.01).name("Top Color Alpha");this._element.addFolder("Bottom");this.addColorFolder(this.material.bottomColor,"Bottom Color",!0,e),e.add(this.material,"bottomColorAlpha").min(0).max(1).step(.01).name("Bottom Color Alpha");var n=this._element.addFolder("Gradient");return n.add(this.material,"offset").step(.01).name("Offset"),n.add(this.material,"smoothness").step(.01).name("Smoothness"),!0},n}(t.AbstractMaterialTool);t.GradientMaterialTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(t){function n(n){t.call(this,n,"TERRAIN-MATERIAL","TERRAIN","Terrain"),this.onObjectSupported=function(t){return t instanceof e.TerrainMaterial}}return __extends(n,t),n.prototype.update=function(){if(!t.prototype.update.call(this))return!1;this.addTextureButton("Mix Texture","mixTexture",null).open();var e=this._element.addFolder("Diffuse");this.addColorFolder(this.material.diffuseColor,"Diffuse Color",!0,e),this.addTextureButton("Diffuse Texture R","diffuseTexture1",e).open(),this.addTextureButton("Diffuse Texture G","diffuseTexture2",e).open(),this.addTextureButton("Diffuse Texture B","diffuseTexture3",e).open();var n=this._element.addFolder("Bump");this.addTextureButton("Bump Texture R","bumpTexture1",n).open(),this.addTextureButton("Bump Texture G","bumpTexture2",n).open(),this.addTextureButton("Bump Texture B","bumpTexture3",n).open();var i=this._element.addFolder("Specular");return this.addColorFolder(this.material.specularColor,"Specular Color",!0,i),i.add(this.material,"specularPower").min(0).step(.5).name("Specular Power"),!0},n}(t.AbstractMaterialTool);t.TerrainMaterialTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(t){function n(n){t.call(this,n,"TRI-PLANAR-MATERIAL","TRI-PLANAR","Tri Planar"),this.onObjectSupported=function(t){return t instanceof e.TriPlanarMaterial}}return __extends(n,t),n.prototype.update=function(){if(!t.prototype.update.call(this))return!1;this._element.add(this.material,"tileSize").min(0).step(.01).name("Tile Size");var e=this._element.addFolder("Diffuse");this.addColorFolder(this.material.diffuseColor,"Diffuse Color",!0,e),this.addTextureButton("Diffuse Texture X","diffuseTextureX",e).open(),this.addTextureButton("Diffuse Texture Y","diffuseTextureY",e).open(),this.addTextureButton("Diffuse Texture Z","diffuseTextureZ",e).open();var n=this._element.addFolder("Bump");this.addTextureButton("Bump Texture X","normalTextureX",n).open(),this.addTextureButton("Bump Texture Y","normalTextureY",n).open(),this.addTextureButton("Bump Texture Z","normalTextureZ",n).open();var i=this._element.addFolder("Specular");return this.addColorFolder(this.material.specularColor,"Specular Color",!0,i),i.add(this.material,"specularPower").min(0).step(.5).name("Specular Power"),!0},n}(t.AbstractMaterialTool);t.TriPlanarMaterialTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(t){function n(n){t.call(this,n,"GRID-MATERIAL","GRID","Grid"),this.onObjectSupported=function(t){return t instanceof e.GridMaterial}}return __extends(n,t),n.prototype.update=function(){return!!t.prototype.update.call(this)&&(this.addColorFolder(this.material.mainColor,"Main Color",!0),this.addColorFolder(this.material.lineColor,"Line Color",!0),this._element.add(this.material,"opacity").min(0).name("Opacity"),this._element.add(this.material,"gridRatio").step(.1).name("Grid Ratio"),this._element.add(this.material,"majorUnitFrequency").name("Major Unit Frequency"),this._element.add(this.material,"minorUnitVisibility").name("Minor Unit Frequency"),!0)},n}(t.AbstractMaterialTool);t.GridMaterialTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(t){function n(n){t.call(this,n,"FIRE-MATERIAL","FIRE","Fire"),this.onObjectSupported=function(t){return t instanceof e.FireMaterial}}return __extends(n,t),n.prototype.update=function(){if(!t.prototype.update.call(this))return!1;var e=this._element.addFolder("Diffuse");this.addColorFolder(this.material.diffuseColor,"Diffuse Color",!0,e),
this.addTextureButton("Diffuse Texture","diffuseTexture",e).open();var n=this._element.addFolder("Fire");return n.add(this.material,"speed").min(0).step(.01).name("Speed"),this.addTextureButton("Distortion Texture","distortionTexture",n).open(),this.addTextureButton("Opacity Texture","opacityTexture",n).open(),!0},n}(t.AbstractMaterialTool);t.FireMaterialTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(){this.engine=null,this.canvas=null,this.camera=null,this.playCamera=null,this.isPlaying=!1,this.scenes=new Array,this.updates=new Array,this.eventReceivers=new Array,this.editor=null}return e.prototype.removeScene=function(e){for(var t=0;t<this.scenes.length;t++)if(this.scenes[t].scene===e)return this.scenes.splice(t,1),!0;return!1},e.prototype.removeEventReceiver=function(e){for(var t=0;t<this.eventReceivers.length;t++)if(this.eventReceivers[t]===e)return this.eventReceivers.splice(t,1),!0;return!1},e.prototype.onPreUpdate=function(){for(var e=0;e<this.updates.length;e++)this.updates[e].onPreUpdate()},e.prototype.onPostUpdate=function(){for(var e=0;e<this.updates.length;e++)this.updates[e].onPostUpdate()},e.prototype.sendEvent=function(e){for(var t=0;t<this.eventReceivers.length;t++)this.eventReceivers[t].onEvent(e)},e.prototype.dispose=function(){},e}();e.EditorCore=t}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function t(e){this.object=null,this.container="BABYLON-EDITOR-EDITION-TOOL",this.editionTools=new Array,this.panel=null,this._editor=e.editor,this.core=e,this.panel=this._editor.layouts.getPanelFromType("left"),this.core.updates.push(this),this.core.eventReceivers.push(this)}return t.prototype.onPreUpdate=function(){},t.prototype.onPostUpdate=function(){},t.prototype.onEvent=function(t){if(t.eventType===e.EventType.GUI_EVENT)if(t.guiEvent.eventType===e.GUIEventType.TAB_CHANGED&&t.guiEvent.caller===this.panel){var n=t.guiEvent.data;if(this._currentTab!==n){this._currentTab=n;for(var i=0;i<this.editionTools.length;i++)for(var r=this.editionTools[i],a=0;a<r.containers.length;a++){var o=$("#"+r.containers[a]);r.tab===this._currentTab?(o.show(),r.resize()):o.hide()}}}else if(t.guiEvent.eventType===e.GUIEventType.LAYOUT_CHANGED&&t.guiEvent.caller===this._editor.layouts)for(var i=0;i<this.editionTools.length;i++)this.editionTools[i].resize();return t.eventType===e.EventType.SCENE_EVENT&&t.sceneEvent.eventType===e.SceneEventType.OBJECT_PICKED&&(this.object=t.sceneEvent.object,this.object&&this.isObjectSupported(this.object),!1)},t.prototype.updateEditionTool=function(){this.isObjectSupported(this.object)},t.prototype.isObjectSupported=function(e){for(var t=!1,n=[],i=0;i<this.editionTools.length;i++){var r=this.editionTools[i],a=r.isObjectSupported(this.object);if(a)n.push(r),this.panel.showTab(r.tab),t||(t=r.tab===this._currentTab);else for(var o=0;o<r.containers.length;o++)$("#"+r.containers[o]).hide(),this.panel.hideTab(r.tab)}for(var i=0;i<n.length;i++){var r=n[i];if(!t){for(var o=0;o<r.containers.length;o++)$("#"+r.containers[o]).show();t=!0,this._currentTab=r.tab}r.update()}return!1},t.prototype.createUI=function(){this.addTool(new e.GeneralTool(this)),this.addTool(new e.SceneTool(this)),this.addTool(new e.LightTool(this)),this.addTool(new e.TextureTool(this)),this.addTool(new e.AudioTool(this)),this.addTool(new e.ParticleSystemTool(this)),this.addTool(new e.ReflectionProbeTool(this)),this.addTool(new e.LensFlareTool(this)),this.addTool(new e.AnimationTool(this)),this.addTool(new e.PostProcessesTool(this)),this.addTool(new e.MaterialTool(this)),this.addTool(new e.StandardMaterialTool(this)),this.addTool(new e.SkyMaterialTool(this)),this.addTool(new e.PBRMaterialTool(this)),this.addTool(new e.WaterMaterialTool(this)),this.addTool(new e.LavaMaterialTool(this)),this.addTool(new e.FurMaterialTool(this)),this.addTool(new e.GradientMaterialTool(this)),this.addTool(new e.TerrainMaterialTool(this)),this.addTool(new e.TriPlanarMaterialTool(this)),this.addTool(new e.GridMaterialTool(this)),this.addTool(new e.FireMaterialTool(this));for(var t=0;t<e.PluginManager.EditionToolPlugins.length;t++)this.addTool(new e.PluginManager.EditionToolPlugins[t](this))},t.prototype.addTool=function(e){var t=this.container;$("#"+t).append('<div id="'+e.containers[0]+'"></div>'),$("#"+e.containers[0]).hide();for(var n=1;n<e.containers.length;n++)$("#"+t).after('<div id="'+e.containers[n]+'"></div>'),$("#"+e.containers[n]).hide(),t=e.containers[n];e.createUI(),this.editionTools.push(e)},t}();e.EditionTool=t}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function t(e){this.onClose=null,this._containers=[],this._panelID="BABYLON-EDITOR-PREVIEW-PANEL",this._closeButtonID="BABYLON-EDITOR-PREVIEW-PANEL-CLOSE",this.core=e,this.editor=e.editor,this.core.eventReceivers.push(this),this.panel=this.editor.layouts.getPanelFromType("preview"),this._mainPanel=this.editor.layouts.getPanelFromType("main"),this._addCloseButton()}return t.prototype.onEvent=function(t){return t.eventType===e.EventType.GUI_EVENT&&t.guiEvent.eventType===e.GUIEventType.LAYOUT_CHANGED&&this._configureCloseButton(),!1},t.prototype.addContainer=function(e,t){if(t){var n=$("#"+t)[0];if(n)return!1}return $("#"+this._panelID).append(e),!0},t.prototype.close=function(){this.onClose&&this.onClose(),$("#"+this._panelID).empty(),this.onClose=null,this._addCloseButton()},t.prototype.setPanelSize=function(e){var t=this.panel._panelElement.height;t+=this._mainPanel._panelElement.height,this.editor.layouts.setPanelSize("preview",t*e/100)},t.prototype._addCloseButton=function(){var t=this;$("#"+this._panelID).append(e.GUI.GUIElement.CreateElement('button class="btn w2ui-msg-title w2ui-msg-button"',this._closeButtonID,"")),this._closeButton=$("#"+this._closeButtonID),this._closeButton.text("x"),this._configureCloseButton(),this._closeButton.click(function(e){t.close(),t.setPanelSize(0)})},t.prototype._configureCloseButton=function(){this._closeButton.css("position","absolute"),this._closeButton.css("right","0%"),this._closeButton.css("z-index",1e3),this._closeButton.css("min-width","0px"),this._closeButton.css("min-height","0px")},t}();e.EditPanel=t}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(e,n,i){void 0===n&&(n=!1),void 0===i&&(i=null),this.layouts=null,this.playLayouts=null,this.filesInput=null,this.renderMainScene=!0,this.renderHelpers=!0,this._saveCameraState=!1,this._mainPanelSceneTab=null,this._mainPanelTabs={},this._currentTab=null,this._lastTabUsed=null,this.core=new t.EditorCore,this.core.editor=this,this.container=e,this.mainContainer=e+"MAIN",this.antialias=n,this.options=i,this._createUI(),this._createBabylonEngine(),this.core.eventReceivers.push(this),this.editionTool=new t.EditionTool(this.core),this.editionTool.createUI(),this.sceneGraphTool=new t.SceneGraphTool(this.core),this.sceneGraphTool.createUI(),this.mainToolbar=new t.MainToolbar(this.core),this.mainToolbar.createUI(),this.toolsToolbar=new t.ToolsToolbar(this.core),this.toolsToolbar.createUI(),this.sceneToolbar=new t.SceneToolbar(this.core),this.sceneToolbar.createUI(),this.transformer=new t.ManipulationHelper(this.core),this.SceneHelpers=new t.SceneHelpers(this.core),this.editPanel=new t.EditPanel(this.core),this.timeline=new t.Timeline(this.core),this.timeline.createUI(),this.statusBar=new t.StatusBar(this.core),this.filesInput=new t.FilesInput(this.core,this._handleSceneLoaded(),null,null,null,null),this.filesInput.monitorElementForDragNDrop(this.core.canvas),this.filesInput.renderFunction=function(){},this._createMainEvents()}return Object.defineProperty(n,"PlayLayoutContainerID",{get:function(){return this._PlayLayoutContainerID},enumerable:!0,configurable:!0}),n.prototype.onEvent=function(e){var n=this;if(e.eventType===t.EventType.GUI_EVENT){if(e.guiEvent.eventType===t.GUIEventType.LAYOUT_CHANGED&&e.guiEvent.caller===this.layouts)return this.playLayouts.resize(),this.core.engine.resize(),!0;if(e.guiEvent.eventType===t.GUIEventType.TAB_CHANGED&&e.guiEvent.caller===this._mainPanel){var i=e.guiEvent.data,r=this._mainPanelTabs[i];return t.GUI.GUIElement.CreateTransition(this._currentTab.container,r.container,"flit-right",function(){n.layouts.resize(),n.playLayouts.resize()}),this._lastTabUsed=this._currentTab,this._currentTab=r,this.renderMainScene=this._currentTab.tab===this._mainPanelSceneTab.tab,!1}if(e.guiEvent.eventType===t.GUIEventType.TAB_CLOSED&&e.guiEvent.caller===this._mainPanel){var i=e.guiEvent.data,a=this._mainPanelTabs[i];return this._currentTab=this._lastTabUsed===a?this._mainPanelSceneTab:this._lastTabUsed,t.GUI.GUIElement.CreateTransition(a.container,this._currentTab.container,"pop-in",function(){a.application&&a.application.dispose(),$("#"+a.container).remove(),n._mainPanel.removeTab(a.tab.id),n.layouts.resize(),n.playLayouts.resize()}),delete this._mainPanelTabs[i],this.renderMainScene=this._currentTab.tab===this._mainPanelSceneTab.tab,!1}}return!1},n.prototype.createNewProject=function(){e.FilesInput.FilesToLoad=[],e.FilesInput.FilesTextures=[],this.core.currentScene.dispose(),this._handleSceneLoaded()(null,new e.Scene(this.core.engine))},n.prototype.createRenderLoop=function(){var e=this;this.core.engine.runRenderLoop(function(){e.update()})},n.prototype.update=function(){if(this.core.onPreUpdate(),this.renderMainScene)for(var e=0;e<this.core.scenes.length;e++)this.core.scenes[e].render&&this.core.scenes[e].scene.render();this.transformer.getScene().render(),this.SceneHelpers.getScene().render(),this.core.onPostUpdate()},n.prototype.dispose=function(){},n.prototype.reloadScene=function(e,t){this._saveCameraState=e,t?this.filesInput.loadFiles(t):this.filesInput.reload()},n.prototype.createTab=function(e,n,i,r){void 0===r&&(r=!0);var a={caption:e,id:t.SceneFactory.GenerateUUID(),closable:r};return this._mainPanel.createTab(a),this._mainPanelTabs[a.id]={tab:a,container:n,application:i},this._currentTab||(this._currentTab=this._mainPanelTabs[a.id]),this._mainPanel.setActiveTab(a.id),a},n.prototype.removeTab=function(e){return this._mainPanel.removeTab(e.id)},n.prototype.createContainer=function(){var e=t.SceneFactory.GenerateUUID();return $("#"+n._PlayLayoutContainerID).append(t.GUI.GUIElement.CreateDivElement(e,"width: 100%; height: 100%;")),e},n.prototype.removeContainer=function(e){var t=$("#"+e);t.remove()},n.prototype._createUI=function(){var e=this;this.layouts=new t.GUI.GUILayout(this.container,this.core),this.layouts.createPanel("BABYLON-EDITOR-EDITION-TOOL-PANEL","left",380,!0).setContent('<div id="BABYLON-EDITOR-EDITION-TOOL"></div>'),this.layouts.createPanel("BABYLON-EDITOR-TOP-TOOLBAR-PANEL","top",70,!1).setContent('<div id="BABYLON-EDITOR-MAIN-TOOLBAR" style="height: 50%"></div><div id="BABYLON-EDITOR-TOOLS-TOOLBAR" style="height: 50%"></div>'),this.layouts.createPanel("BABYLON-EDITOR-GRAPH-PANEL","right",350,!0).setContent('<div id="BABYLON-EDITOR-SCENE-GRAPH-TOOL" style="height: 100%;"></div>');var i=this.layouts.createPanel("BABYLON-EDITOR-MAIN-PANEL","main",void 0,void 0).setContent('<div id="'+this.mainContainer+'" style="height: 100%; width: 100%;"></div>');i.style="overflow: hidden;",this.layouts.createPanel("BABYLON-EDITOR-PREVIEW-PANEL","preview",70,!0).setContent('<div style="width: 100%; height: 100%; overflow: hidden;"><div id="BABYLON-EDITOR-PREVIEW-PANEL" style="height: 100%;"></div></div>'),this.layouts.createPanel("BABYLON-EDITOR-BOTTOM-PANEL","bottom",0,!1).setContent('<div id="BABYLON-EDITOR-BOTTOM-PANEL" style="height: 100%; width: 100%"></div>'),this.layouts.buildElement(this.container),this.playLayouts=new t.GUI.GUILayout(this.mainContainer,this.core);var i=this.playLayouts.createPanel("BABYLON-EDITOR-MAIN-MAIN-PANEL","main",void 0,void 0).setContent('<div id="'+n._PlayLayoutContainerID+'" style="width: 100%; height: 100%;"><div id="BABYLON-EDITOR-BOTTOM-PANEL-PREVIEW"><div id="BABYLON-EDITOR-MAIN-DEBUG-LAYER"></div><canvas id="BABYLON-EDITOR-MAIN-CANVAS"></canvas><div id="BABYLON-EDITOR-SCENE-TOOLBAR"></div></div></div>');i.style="overflow: hidden;",this.playLayouts.createPanel("BABYLON-EDITOR-MAIN-PREVIEW-PANEL","preview",0,!1).setContent('<div id="BABYLON-EDITOR-PREVIEW-TIMELINE" style="height: 100%; width: 100%; overflow: hidden;"></div>'),this.playLayouts.buildElement(this.mainContainer),this.playLayouts.on({execute:"after",type:"resize"},function(){if(e.sceneToolbar){var t=e.layouts.getPanelFromType("main").height,n=e.sceneToolbar.toolbar.element.box.clientHeight;e.core.canvas.height=(t-2*n-10-e.playLayouts.getPanelFromType("preview").height)*devicePixelRatio}}),this._mainPanel=this.playLayouts.getPanelFromType("main"),this._mainPanelSceneTab=this._mainPanelTabs[this.createTab("Preview","BABYLON-EDITOR-BOTTOM-PANEL-PREVIEW",null,!1).id]},n.prototype._handleSceneLoaded=function(){var e=this;return function(n,i){for(var r in e._mainPanelTabs)e._mainPanelTabs[r].tab.id!==e._mainPanelSceneTab.tab.id&&t.Event.sendGUIEvent(e._mainPanel,t.GUIEventType.TAB_CLOSED,e.core,e._mainPanelTabs[r].tab.id);e.core.removeScene(e.core.currentScene),e.core.scenes.push({scene:i,render:!0}),e.core.currentScene=i;var a=i.activeCamera;e._createBabylonCamera(),a&&a.speed&&(e.core.camera.speed=a.speed),e.core.currentScene.activeCamera=e.core.camera,e.core.playCamera=a,e.core.engine.stopRenderLoop(),e.createRenderLoop();for(var o=null,s=0;s<i.meshes.length;s++)t.SceneManager.ConfigureObject(i.meshes[s],e.core,o,!1);t.SceneManager._SceneConfiguration={scene:i,actionManager:i.actionManager},i.actionManager=null,i.getPhysicsEngine()&&i.getPhysicsEngine().setTimeStep(0),e.sceneGraphTool.createUI(),e.sceneGraphTool.fillGraph(),t.SceneFactory.NodesToStart=[],e.timeline.reset(),t.Event.sendSceneEvent(e.core.currentScene,t.SceneEventType.NEW_SCENE_CREATED,e.core)}},n.prototype._createBabylonEngine=function(){var t=this;this.core.canvas=document.getElementById("BABYLON-EDITOR-MAIN-CANVAS"),this.core.engine=new e.Engine(this.core.canvas,this.antialias,this.options),this.core.engine.setHardwareScalingLevel(1/devicePixelRatio),this.core.currentScene=new e.Scene(this.core.engine),this.core.currentScene.animations=[],this.core.scenes.push({render:!0,scene:this.core.currentScene}),this._createBabylonCamera(),window.addEventListener("resize",function(e){t.core.isPlaying&&(t.core.isPlaying=!1),t.core.engine.resize()})},n.prototype._createBabylonCamera=function(){var t=new e.Vector3(0,0,10),n=e.Vector3.Zero(),i=10;this.core.camera&&(t=this.core.camera.position,n=this.core.camera.target,i=this.core.camera.radius);var r=new e.ArcRotateCamera("EditorCamera",0,0,10,e.Vector3.Zero(),this.core.currentScene);r.panningSensibility=50,r.attachControl(this.core.canvas,!1,!1),this.core.camera=r,this._saveCameraState&&(r.setPosition(t),r.setTarget(n),r.radius=i)},n.prototype._createMainEvents=function(){var e=this;document.addEventListener("mousedown",function(n){t.Event.sendGUIEvent(null,t.GUIEventType.DOCUMENT_CLICK,e.core,n)}),document.addEventListener("mouseup",function(n){t.Event.sendGUIEvent(null,t.GUIEventType.DOCUMENT_UNCLICK,e.core,n)}),document.addEventListener("keydown",function(n){t.Event.sendKeyEvent(n.key,n.ctrlKey,n.shiftKey,!0,e.core,n)}),document.addEventListener("keyup",function(n){t.Event.sendKeyEvent(n.key,n.ctrlKey,n.shiftKey,!1,e.core,n)})},n._PlayLayoutContainerID="BABYLON-EDITOR-MAIN-MAIN-PANEL-CONTAINER",n}();t.EditorMain=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function t(e){this.container="BABYLON-EDITOR-MAIN-TOOLBAR",this.toolbar=null,this.panel=null,this.particleSystemMenu=null,this.particleSystemCopyItem=null,this.particleSystemPasteItem=null,this._plugins=[],this._mainProject="MAIN-PROJECT",this._mainProjectOpenFiles="MAIN-PROJECT-OPEN-FILES",this._mainProjectReload="MAIN-PROJECT-RELOAD",this._mainProjectNew="MAIN-PROJECT-NEW",this._projectExportCode="PROJECT-EXPORT-CODE",this._projectExportBabylonScene="PROJECT-EXPORT-BABYLON-SCENE",this._projectSaveLocal="PROJECT-SAVE-LOCAL",this._projectTemplateLocal="PROJECT-TEMPLATE-LOCAL",this._projectSaveStorage="PROJECT-CONNECT-STORAGE",this._projectTemplateStorage="PROJECT-TEMPLATE-STORAGE",this._mainEdit="MAIN-EDIT",this._mainEditLaunch="EDIT-LAUNCH",this._mainEditTextures="EDIT-TEXTURES",this._mainAdd="MAIN-ADD",this._addSkyMesh="ADD-SKY-MESH",this._addWaterMesh="ADD-WATER-MESH",this._addLensFlare="ADD-LENS-FLARE",this._addReflectionProbe="ADD-REFLECTION-PROBE",this._addRenderTarget="ADD-RENDER-TARGET",this._addParticleSystem="ADD-PARTICLE-SYSTEM",this._particlesMain="PARTICLES-MAIN",this._particlesCopy="PARTICLES-COPY",this._particlesPaste="PARTICLES-PASTE",this._particlesPlay="PARTICLES-PLAY",this._particlesStop="PARTICLES-STOP",this._editor=e.editor,this.core=e,this.panel=this._editor.layouts.getPanelFromType("top"),this.core.updates.push(this),this.core.eventReceivers.push(this)}return t.prototype.onPreUpdate=function(){},t.prototype.onPostUpdate=function(){},t.prototype.onEvent=function(t){var n=this;if(t.eventType===e.EventType.KEY_EVENT)t.keyEvent.control&&"s"===t.keyEvent.key&&!t.keyEvent.isDown?this._callSaveAction(e.Tools.CheckIfElectron()?this._projectSaveLocal:this._projectSaveStorage):t.keyEvent.shift&&t.keyEvent.control&&"s"===t.keyEvent.key&&!t.keyEvent.isDown&&this._callSaveAction(e.Tools.CheckIfElectron()?this._projectTemplateLocal:this._projectTemplateStorage);else if(t.eventType===e.EventType.GUI_EVENT&&t.guiEvent.eventType===e.GUIEventType.TOOLBAR_MENU_SELECTED){if(t.guiEvent.caller!==this.toolbar||!t.guiEvent.data)return!1;var i=t.guiEvent.data,r=this.toolbar.decomposeSelectedMenu(i);if(!r||!r.hasParent)return!1;if(r.parent===this._mainProject){if(r.selected===this._mainProjectOpenFiles)e.Tools.OpenFileBrowser(this.core,"#BABYLON-EDITOR-LOAD-SCENE-FILE",function(e){0!==e.target.files.length&&n.core.editor.reloadScene(!0,e)},!0);else if(r.selected===this._mainProjectReload)e.GUI.GUIDialog.CreateDialog("Are you sure to reload the project ?","Reload the project",function(){n.core.editor.reloadScene(!0)});else if(r.selected===this._mainProjectNew)e.GUI.GUIDialog.CreateDialog("Are you sure to create a new project ?","Create a new project",function(){n._editor.createNewProject()});else if(r.selected===this._projectExportCode){var a=new e.Exporter(this.core);a.openSceneExporter()}else if(r.selected===this._projectExportBabylonScene){var o=new e.BabylonExporter(this.core);o.createUI()}else this._callSaveAction(r.selected);return!0}if(r.parent===this._mainEdit){if(r.selected===this._mainEditLaunch){new e.LaunchEditor(this.core)}else if(r.selected===this._mainEditTextures){new e.GUITextureEditor(this.core,"")}return!0}if(r.parent===this._mainAdd)return r.selected===this._addLensFlare?e.SceneFactory.AddLensFlareSystem(this.core):r.selected===this._addSkyMesh?e.SceneFactory.AddSkyMesh(this.core):r.selected===this._addWaterMesh?e.SceneFactory.AddWaterMesh(this.core):r.selected===this._addReflectionProbe?e.SceneFactory.AddReflectionProbe(this.core):r.selected===this._addRenderTarget&&e.SceneFactory.AddRenderTargetTexture(this.core),!0;if(r.parent===this._particlesMain){if(r.selected===this._addParticleSystem)e.SceneFactory.AddParticleSystem(this.core);else if(r.selected===this._particlesCopy)e.GUIParticleSystemEditor._CopiedParticleSystem=e.GUIParticleSystemEditor._CurrentParticleSystem;else if(r.selected===this._particlesPaste){if(!e.GUIParticleSystemEditor._CopiedParticleSystem)return!0;var s=this.core.editor.sceneGraphTool.sidebar.getSelectedNode();if(!s||!s.data||!s.data.position)return!0;var l=e.GUIParticleSystemEditor.CreateParticleSystem(this.core.currentScene,e.GUIParticleSystemEditor._CopiedParticleSystem.getCapacity(),e.GUIParticleSystemEditor._CopiedParticleSystem,s.data);e.Event.sendSceneEvent(l,e.SceneEventType.OBJECT_ADDED,this.core),this._editor.editionTool.updateEditionTool()}else r.selected===this._particlesPlay?e.GUIParticleSystemEditor.PlayStopAllParticleSystems(this.core.currentScene,!0):r.selected===this._particlesStop&&e.GUIParticleSystemEditor.PlayStopAllParticleSystems(this.core.currentScene,!1);return!0}for(var c=0;c<this._plugins.length;c++)if(r.parent===this._plugins[c].menuID)return this._plugins[c].onMenuItemSelected(r.selected),!0}return!1},t.prototype.createUI=function(){null!=this.toolbar&&this.toolbar.destroy(),this.toolbar=new e.GUI.GUIToolbar(this.container,this.core);var t=this.toolbar.createMenu("menu",this._mainProject,"Project","icon-folder");this.toolbar.createMenuItem(t,"button",this._mainProjectOpenFiles,"Open Files","icon-copy"),this.toolbar.createMenuItem(t,"button",this._mainProjectReload,"Reload...","icon-copy"),this.toolbar.addBreak(t),this.toolbar.createMenuItem(t,"button",this._mainProjectNew,"New...","icon-copy"),this.toolbar.addBreak(t),this.toolbar.createMenuItem(t,"button",this._projectExportCode,"Export...","icon-export"),this.toolbar.createMenuItem(t,"button",this._projectExportBabylonScene,"Export .babylon Scene...","icon-export"),this.toolbar.addBreak(t),e.Tools.CheckIfElectron()?(this.toolbar.createMenuItem(t,"button",this._projectSaveLocal,"Save...","icon-save"),this.toolbar.createMenuItem(t,"button",this._projectTemplateLocal,"Create template...","icon-save")):(this.toolbar.createMenuItem(t,"button",this._projectSaveStorage,"Save on OneDrive","icon-one-drive"),this.toolbar.createMenuItem(t,"button",this._projectTemplateStorage,"Template on OneDrive","icon-one-drive")),t=this.toolbar.createMenu("menu","MAIN-EDIT","Edit","icon-edit"),this.toolbar.createMenuItem(t,"button",this._mainEditLaunch,"Animate at Launch...","icon-play-game"),this.toolbar.addBreak(t),this.toolbar.createMenuItem(t,"button",this._mainEditTextures,"Edit Textures...","icon-copy"),t=this.toolbar.createMenu("menu",this._mainAdd,"Add","icon-add"),this.toolbar.createMenuItem(t,"button",this._addLensFlare,"Add Lens Flare","icon-lens-flare"),this.toolbar.addBreak(t),this.toolbar.createMenuItem(t,"button",this._addSkyMesh,"Add Sky","icon-shaders"),this.toolbar.createMenuItem(t,"button",this._addWaterMesh,"Add Water","icon-water"),this.toolbar.addBreak(t),this.toolbar.createMenuItem(t,"button",this._addReflectionProbe,"Add Reflection Probe","icon-effects"),this.toolbar.createMenuItem(t,"button",this._addRenderTarget,"Add Render Target Texture","icon-camera"),this.particleSystemMenu=t=this.toolbar.createMenu("menu",this._particlesMain,"Particles","icon-particles"),this.toolbar.createMenuItem(t,"button",this._addParticleSystem,"Add Particle System","icon-particles"),this.toolbar.addBreak(t),this.particleSystemCopyItem=this.toolbar.createMenuItem(t,"button",this._particlesCopy,"Copy Selected Particle System","icon-copy",!1,!0),this.particleSystemPasteItem=this.toolbar.createMenuItem(t,"button",this._particlesPaste,"Paste Particle System","icon-copy",!1,!0),this.toolbar.addBreak(t),this.toolbar.createMenuItem(t,"button",this._particlesPlay,"Start All Particles","icon-play-game"),this.toolbar.createMenuItem(t,"button",this._particlesStop,"Stop All Particles","icon-error");for(var n=0;n<e.PluginManager.MainToolbarPlugins.length;n++)this._plugins.push(new e.PluginManager.MainToolbarPlugins[n](this));this.toolbar.buildElement(this.container)},t.prototype._callSaveAction=function(t){if(t===this._projectSaveLocal){var n=new e.StorageExporter(this.core,"ElectronLocalStorage");n["export"](),e.FilesInput.FilesToLoad["scene.editorproject"]=e.Tools.CreateFile(e.Tools.ConvertStringToArray(e.ProjectExporter.ExportProject(this.core)),"scene.editorproject")}else if(t===this._projectTemplateLocal){var n=new e.StorageExporter(this.core,"ElectronLocalStorage");n.createTemplate()}else if(t===this._projectSaveStorage){var n=new e.StorageExporter(this.core);n["export"](),e.FilesInput.FilesToLoad["scene.editorproject"]=e.Tools.CreateFile(e.Tools.ConvertStringToArray(e.ProjectExporter.ExportProject(this.core)),"scene.editorproject")}else if(t===this._projectTemplateStorage){var n=new e.StorageExporter(this.core);n.createTemplate()}},t}();e.MainToolbar=t}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(e){this.container="BABYLON-EDITOR-SCENE-GRAPH-TOOL",this.sidebar=null,this.panel=null,this._graphRootName="RootScene",this._mainSoundTrackName="",this._menuDeleteId="BABYLON-EDITOR-SCENE-GRAPH-TOOL-REMOVE",this._menuCloneId="BABYLON-EDITOR-SCENE-GRAPH-TOOL-CLONE",this._editor=e.editor,this._core=e,this.panel=this._editor.layouts.getPanelFromType("right"),this._core.updates.push(this),this._core.eventReceivers.push(this)}return n.prototype.onPreUpdate=function(){},n.prototype.onPostUpdate=function(){},n.prototype.onEvent=function(n){if(n.eventType===t.EventType.GUI_EVENT){if(n.guiEvent.caller===this.sidebar){if(n.guiEvent.eventType===t.GUIEventType.GRAPH_SELECTED||n.guiEvent.eventType===t.GUIEventType.GRAPH_DOUBLE_SELECTED){var i=new t.Event;return i.eventType=t.EventType.SCENE_EVENT,i.sceneEvent=new t.SceneEvent(n.guiEvent.data,t.SceneEventType.OBJECT_PICKED),this._core.sendEvent(i),n.guiEvent.eventType===t.GUIEventType.GRAPH_DOUBLE_SELECTED&&this._core.editor.sceneToolbar.setFocusOnObject(n.guiEvent.data),!0}if(n.guiEvent.eventType===t.GUIEventType.GRAPH_MENU_SELECTED){var r=n.guiEvent.data,a=this.sidebar.getSelectedData(),o=this._core.currentScene;if(!a)return!1;if(r===this._menuDeleteId){if(a&&a.dispose&&a!==this._core.camera){a.dispose(),this._ensureObjectDispose(a);var s=this.sidebar.getNode(this.sidebar.getSelected());s&&s.parent&&(s.parent.count=s.parent.count||0,s.parent.count--,s.parent.count<=0&&(s.parent.count=void 0)),this.sidebar.removeNode(this.sidebar.getSelected()),this.sidebar.refresh(),t.Event.sendSceneEvent(a,t.SceneEventType.OBJECT_REMOVED,this._core)}return!0}if(r===this._menuCloneId){if(!(a instanceof e.Mesh))return!0;if(!a.geometry){var l=a.clone(a.name+"Cloned",a.parent);t.Event.sendSceneEvent(l,t.SceneEventType.OBJECT_ADDED,this._core),t.Event.sendSceneEvent(l,t.SceneEventType.OBJECT_PICKED,this._core),this.sidebar.setSelected(l.id);for(var c=null,d=0;d<o.particleSystems.length;d++)if(o.particleSystems[d].emitter===a)c=o.particleSystems[d].particleTexture._buffer;else if(o.particleSystems[d].emitter===l){o.particleSystems[d].particleTexture=e.Texture.CreateFromBase64String(c,o.particleSystems[d].particleTexture.name+"Cloned",o);break}}return!0}}}}else if(n.eventType===t.EventType.SCENE_EVENT){if(n.sceneEvent.eventType===t.SceneEventType.OBJECT_ADDED){var a=n.sceneEvent.object;if(a instanceof e.BaseTexture)return!1;if(a instanceof e.ReflectionProbe){var h=this.sidebar.createNode(a.name+this._core.currentScene.reflectionProbes.length,a.name,"icon-effects",a);this.sidebar.addNodes(h,this._graphRootName+"TARGETS")}else if(a instanceof e.RenderTargetTexture){var h=this.sidebar.createNode(a.name+this._core.currentScene.customRenderTargets.length,a.name,"icon-camera",a);this.sidebar.addNodes(h,this._graphRootName+"TARGETS")}else{var u=null;n.sceneEvent.object instanceof e.ParticleSystem?u=n.sceneEvent.object.emitter:n.sceneEvent.object instanceof e.LensFlareSystem?u=n.sceneEvent.object.getEmitter():n.sceneEvent.object instanceof e.Sound&&(u=this._mainSoundTrackName),this._modifyElement(n.sceneEvent.object,u,a.id?a.id:t.SceneFactory.GenerateUUID())}return!1}if(n.sceneEvent.eventType===t.SceneEventType.OBJECT_REMOVED)return this.sidebar.removeNode(n.sceneEvent.object.id),this.sidebar.refresh(),!1}return!1},n.prototype.fillGraph=function(n,i){var r=null,a=null,o=this._core.currentScene;if(!i){this.sidebar.clear();var s=this.sidebar.createNode(this._graphRootName,"Scene","icon-scene",this._core.currentScene);this.sidebar.addNodes(s),a=this._graphRootName;var l=this.sidebar.createNode(this._graphRootName+"TARGETS","Render Targets","icon-folder");this.sidebar.addNodes(l,this._graphRootName,!1);for(var c=0;c<o.reflectionProbes.length;c++){var d=o.reflectionProbes[c];this.sidebar.addNodes(this.sidebar.createNode(d.name+c,d.name,"icon-effects",d),l.id,!1)}for(var c=0;c<o.customRenderTargets.length;c++){var h=o.customRenderTargets[c];e.Tags.HasTags(h)&&e.Tags.MatchesQuery(h,"added")&&this.sidebar.addNodes(this.sidebar.createNode(h.name+c,d.name,"icon-camera",d),l.id,!1)}var u=this.sidebar.createNode(this._graphRootName+"AUDIO","Audio","icon-folder");this.sidebar.addNodes(u,this._graphRootName,!1);for(var c=0;c<o.soundTracks.length;c++){var p=o.soundTracks[c];0===c&&(this._mainSoundTrackName="Soundtrack "+p.id);var m=this.sidebar.createNode(this._mainSoundTrackName,"Soundtrack "+p.id,"icon-sound",p);1===o.soundTracks.length&&(m.expanded=!0),m.count=p.soundCollection.length,this.sidebar.addNodes(m,u.id,!1);for(var _=0;_<p.soundCollection.length;_++){var f=p.soundCollection[_];this.sidebar.addNodes(this.sidebar.createNode("Sound"+_,f.name,"icon-sound",f),m.id,!1)}}}if(n?r=n.getDescendants?n.getDescendants():[]:(r=[],this._getRootNodes(r,"cameras"),this._getRootNodes(r,"lights"),this._getRootNodes(r,"meshes")),a===this._graphRootName&&this.sidebar.setNodeExpanded(a,!0),n&&o.particleSystems.length>0)for(var c=0;c<o.particleSystems.length;c++){var v=o.particleSystems[c];if(v.emitter&&v.emitter===n){var g=this.sidebar.createNode(v.id,v.name,"icon-particles",v);this.sidebar.addNodes(g,n.id,!1)}}if(n&&o.lensFlareSystems.length>0)for(var c=0;c<o.lensFlareSystems.length;c++){var T=o.lensFlareSystems[c];if(T.getEmitter()===n){var E=this.sidebar.createNode(t.SceneFactory.GenerateUUID(),T.name,"icon-lens-flare",T);this.sidebar.addNodes(E,n.id,!1)}}if(n instanceof e.AbstractMesh&&n.subMeshes&&n.subMeshes.length>1){var y=this.sidebar.createNode(n.id+"SubMeshes","Sub-Meshes","icon-mesh",n);y.count=n.subMeshes.length,this.sidebar.addNodes(y,n.id,!1);for(var c=0;c<n.subMeshes.length;c++){var S=n.subMeshes[c],I=this.sidebar.createNode(n.id+"SubMesh"+c,S.getMaterial().name,"icon-mesh",S);this.sidebar.addNodes(I,y.id,!1)}}if(null!==r)for(var c=0;c<r.length;c++){var b=r[c],O=b.getDescendants().length,A=this._getObjectIcon(b),C=this.sidebar.createNode(b.id,b.name,A,b);O>0&&(C.count=O),this.sidebar.addNodes(C,a?a:n.id,!1),this.fillGraph(b,b.id)}},n.prototype.createUI=function(){null!=this.sidebar&&this.sidebar.destroy(),this.sidebar=new t.GUI.GUIGraph(this.container,this._core),this.sidebar.addMenu(this._menuDeleteId,"Remove","icon-error"),this.sidebar.addMenu(this._menuCloneId,"Clone","icon-clone"),this.sidebar.buildElement(this.container);var e=this.sidebar.createNode(this._graphRootName,"Scene","icon-scene",this._core.currentScene);this.sidebar.addNodes(e)},n.prototype._getRootNodes=function(e,t){for(var n=this._core.currentScene[t],i=0;i<n.length;i++)n[i].parent||e.push(n[i])},n.prototype._getObjectIcon=function(t){return t instanceof e.AbstractMesh?t.skeleton?"icon-animated-mesh":"icon-mesh":t instanceof e.SubMesh?"icon-mesh":t instanceof e.Light?t instanceof e.DirectionalLight?"icon-directional-light":"icon-light":t instanceof e.Camera?"icon-camera":t instanceof e.ParticleSystem?"icon-particles":t instanceof e.LensFlareSystem?"icon-lens-flare":t instanceof e.Sound?"icon-sound":""},n.prototype._modifyElement=function(t,n,i){if(t){var r=this._getObjectIcon(t);if(n){var a=this.sidebar.getNode(n instanceof e.Node?n.id:n);a&&(a.count=a.count||0,a.count++)}this.sidebar.addNodes(this.sidebar.createNode(i?i:t.id,t.name,r,t),n?n instanceof e.Node?n.id:n:this._graphRootName),this.sidebar.refresh()}},n.prototype._ensureObjectDispose=function(t){var n,i=this._core.currentScene;for(n=0;n<i.lensFlareSystems.length;n++){var r=i.lensFlareSystems[n];r.getEmitter()===t&&r.dispose()}for(n=0;n<i.particleSystems.length;n++){var a=i.particleSystems[n];a.emitter===t&&a.dispose()}for(n=0;n<i.lights.length;n++){var o=i.lights[n].getShadowGenerator();if(o)for(var s=o.getShadowMap().renderList,l=0;l<s.length;l++)s[l]===t&&s.splice(l,1)}for(n=0;n<i.customRenderTargets.length;n++){var c=i.customRenderTargets[n];if(c.renderList)for(var l=0;l<c.renderList.length;l++)c.renderList[l]===t&&c.renderList.splice(l,1);
}if(t instanceof e.AbstractMesh){var d=t,h=d.getChildMeshes(!0);for(n=0;n<h.length;n++)e.Tags.MatchesQuery(h[n],"FurAdded")&&(h[n].dispose(!0),this._ensureObjectDispose(h[n]))}},n}();t.SceneGraphTool=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(e){this.container="BABYLON-EDITOR-SCENE-TOOLBAR",this.toolbar=null,this.panel=null,this._fpsInput=null,this._wireframeID="WIREFRAME",this._boundingBoxID="BOUNDINGBOX",this._centerOnObjectID="CENTER-ON-OBJECT",this._renderHelpersID="RENDER-HELPERS",this._renderDebugLayerID="RENDER-DEBUG-LAYER",this._drawingDebugLayer=!1,this._editor=e.editor,this._core=e,this.panel=this._editor.layouts.getPanelFromType("main"),this._core.updates.push(this),this._core.eventReceivers.push(this)}return n.prototype.onPreUpdate=function(){},n.prototype.onPostUpdate=function(){},n.prototype.onEvent=function(e){if(e.eventType===t.EventType.GUI_EVENT&&e.guiEvent.eventType===t.GUIEventType.LAYOUT_CHANGED&&this._drawingDebugLayer)return this._configureDebugLayer(),!1;if(e.eventType===t.EventType.GUI_EVENT&&e.guiEvent.eventType===t.GUIEventType.TOOLBAR_MENU_SELECTED){if(e.guiEvent.caller!==this.toolbar||!e.guiEvent.data)return!1;var n=e.guiEvent.data,i=this.toolbar.decomposeSelectedMenu(n),r=this._core.currentScene;if(!i||!i.parent)return!1;if(n=i.parent,n===this._wireframeID){var a=!this.toolbar.isItemChecked(n);return r.forceWireframe=a,this.toolbar.setItemChecked(n,a),!0}if(n===this._boundingBoxID){var a=!this.toolbar.isItemChecked(n);return r.forceShowBoundingBoxes=a,this.toolbar.setItemChecked(n,a),!0}if(n===this._renderHelpersID){var a=!this.toolbar.isItemChecked(n);return this._core.editor.renderHelpers=a,this.toolbar.setItemChecked(n,a),!0}if(n===this._centerOnObjectID){var o=this._core.editor.sceneGraphTool.sidebar.getSelectedData();return this.setFocusOnObject(o),!0}if(n===this._renderDebugLayerID){var a=!this.toolbar.isItemChecked(n);return this._drawingDebugLayer=a,a?(r.debugLayer.show(!0,r.activeCamera,$("#BABYLON-EDITOR-MAIN-DEBUG-LAYER")[0]),this._configureDebugLayer()):r.debugLayer.hide(),this.toolbar.setItemChecked(n,a),!0}}return!1},n.prototype.createUI=function(){var e=this;null!=this.toolbar&&this.toolbar.destroy(),this.toolbar=new t.GUI.GUIToolbar(this.container,this._core),this.toolbar.createMenu("button",this._wireframeID,"Wireframe","icon-wireframe"),this.toolbar.addBreak(),this.toolbar.createMenu("button",this._boundingBoxID,"Bounding Box","icon-bounding-box"),this.toolbar.addBreak(),this.toolbar.createMenu("button",this._renderHelpersID,"Helpers","icon-helpers",!0),this.toolbar.addBreak(),this.toolbar.createMenu("button",this._centerOnObjectID,"Focus object","icon-focus"),this.toolbar.addBreak(),this.toolbar.createMenu("button",this._renderDebugLayerID,"Debug Layer","icon-wireframe"),this.toolbar.addSpacer(),this.toolbar.createInput("SCENE-TOOLBAR-FPS","SCENE-TOOLBAR-FPS-INPUT","FPS :",5),this.toolbar.buildElement(this.container),this._fpsInput=$("#SCENE-TOOLBAR-FPS-INPUT").w2field("int",{autoFormat:!0}),this._fpsInput.change(function(n){t.GUIAnimationEditor.FramesPerSecond=parseFloat(e._fpsInput.val()),e._configureFramesPerSecond()}),this._fpsInput.val(String(t.GUIAnimationEditor.FramesPerSecond))},n.prototype.setFocusOnObject=function(t){if(t&&t.position){var n=this._core.currentScene,i=this._core.camera,r=t.position;t.getAbsolutePosition&&(r=t.getAbsolutePosition()),t.getBoundingInfo&&(r=t.getBoundingInfo().boundingSphere.centerWorld);var a=[{frame:0,value:i.target},{frame:1,value:r}],o=new e.Animation("FocusOnObjectAnimation","target",10,e.Animation.ANIMATIONTYPE_VECTOR3,e.Animation.ANIMATIONLOOPMODE_CONSTANT);o.setKeys(a),n.stopAnimation(i),n.beginDirectAnimation(i,[o],0,1,!1,1)}},n.prototype.setFramesPerSecond=function(e){this._fpsInput.val(String(e)),this._configureFramesPerSecond()},n.prototype._configureDebugLayer=function(){var e=$("#DebugLayer");e.css("left","10px"),e.css("top","10px")},n.prototype._configureFramesPerSecond=function(){var e=function(e){for(var n=0;n<e.length;n++)for(var i=0;i<e[n].animations.length;i++)e[n].animations[i].framePerSecond=t.GUIAnimationEditor.FramesPerSecond};e([this._core.currentScene]),e(this._core.currentScene.meshes),e(this._core.currentScene.lights),e(this._core.currentScene.cameras),e(this._core.currentScene.particleSystems);for(var n=0;n<this._core.currentScene.skeletons.length;n++)e(this._core.currentScene.skeletons[n].bones)},n}();t.SceneToolbar=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(e){var t=this;this.container="BABYLON-EDITOR-PREVIEW-TIMELINE",this.animations=[],this._overlay=null,this._overlayText=null,this._overlayObj=null,this._mousex=0,this._mousey=0,this._isOver=!1,this._maxFrame=1e3,this._currentTime=0,this._frameRects=[],this._frameTexts=[],this._currentAnimationFrame=0,this._core=e,this._panel=e.editor.playLayouts.getPanelFromType("preview"),e.editor.playLayouts.on({type:"resize",execute:"before"},function(){t._updateTimeline()}),this._core.updates.push(this),this._core.eventReceivers.push(this)}return n.prototype.onEvent=function(e){return!1},n.prototype.onPreUpdate=function(){this._paper.setSize(this._panel.width-17,20),this._rect.attr("width",this._panel.width-17),this._animatedRect.attr("x",this._currentAnimationFrame)},n.prototype.onPostUpdate=function(){},n.prototype.play=function(){var e=this._frameAnimation.getKeys();this._frameAnimation.framePerSecond=t.GUIAnimationEditor.FramesPerSecond,e[0].frame=this._getFrame(),e[0].value=this._getPosition(this._currentTime),e[1].frame=this._maxFrame,e[1].value=this._getPosition(this._maxFrame),this._core.currentScene.beginAnimation(this,e[0].frame,this._maxFrame,!1,t.SceneFactory.AnimationSpeed)},n.prototype.stop=function(){this._core.currentScene.stopAnimation(this)},Object.defineProperty(n.prototype,"currentTime",{get:function(){return this._currentTime},enumerable:!0,configurable:!0}),n.prototype.reset=function(){this._maxFrame=t.GUIAnimationEditor.GetSceneFrameCount(this._core.currentScene),this._currentTime=0,this._selectorRect.attr("x",0),this.setFramesOfAnimation(null),this._core.editor.playLayouts.setPanelSize("preview",t.SceneFactory.NodesToStart.length>0?40:0)},n.prototype.setFramesOfAnimation=function(e){for(var t=0;t<this._frameRects.length;t++)this._frameRects[t].remove();if(e)for(var n=e.getKeys(),t=0;t<n.length;t++){var i=this._getPosition(n[t].frame),r=this._paper.rect(i-1.5,this._panel.height-30,3,10);r.attr("fill","red"),r.attr("stroke","black"),this._frameRects.push(r)}},n.prototype.createUI=function(){var n=this;this._paper=Raphael(this.container,0,25),this._rect=this._paper.rect(0,0,0,20),this._rect.attr("fill",Raphael.rgb(237,241,246)),this._selectorRect=this._paper.rect(0,0,10,20),this._selectorRect.attr("fill",Raphael.rgb(200,191,231)),this._animatedRect=this._paper.rect(0,0,4,20),this._frameAnimation=new e.Animation("anim","_currentAnimationFrame",12,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CYCLE),this._frameAnimation.setKeys([{frame:0,value:0},{frame:1,value:1}]),this.animations.push(this._frameAnimation);var i=function(i){n._mousex=e.MathTools.Clamp(i.pageX-n._paper.canvas.getBoundingClientRect().left,0,n._paper.width),n._mousey=e.MathTools.Clamp(i.pageY-n._paper.canvas.getBoundingClientRect().top,0,n._paper.height),n._currentTime=n._getFrame(),n._selectorRect.attr("x",n._mousex),n._currentTime>=0&&n._currentTime<n._maxFrame-1&&t.GUIAnimationEditor.SetCurrentFrame(n._core,t.SceneFactory.NodesToStart,n._currentTime),n._overlayText.text("Frame: "+e.Tools.Format(n._currentTime,0)),n._overlayObj.css({left:i.pageX})};window.addEventListener("mousemove",function(e){n._isOver&&i(e)}),window.addEventListener("mouseup",function(e){n._isOver&&n._overlayText.remove(),n._isOver=!1}),this._paper.canvas.addEventListener("mousedown",function(e){n._isOver=!0,n._overlay=$(n._paper.canvas).w2overlay({html:'<div id="BABYLON-EDITOR-TIMELINE-TEXT" style="padding: 10px; line-height: 150%"></div>'}),n._overlayText=$("#BABYLON-EDITOR-TIMELINE-TEXT"),n._overlayObj=$("#w2ui-overlay"),i(e)}),this._updateTimeline()},n.prototype._updateTimeline=function(){for(var t=10,n=0;n<this._frameTexts.length;n++){this._frameTexts[n].text.remove();for(var i=0;i<this._frameTexts[n].bars.length;i++)this._frameTexts[n].bars[i].remove()}this._frameTexts=[];for(var n=0;n<t;n++){var r=this._maxFrame/t*this._panel.width/this._maxFrame*(n+1),a=this._paper.text(r,this._panel.height-35,e.Tools.Format(this._getFrame(r),0));a.node.setAttribute("pointer-events","none"),a.node.style.msUserSelect="none",a.node.style.webkitUserSelect="none",a.attr("font-family","MS Reference Sans Serif"),a.attr("fill","#555");for(var o=[],i=0;i<t;i++){r=this._maxFrame/t*this._panel.width/this._maxFrame*(n+i/t);var s=this._paper.rect(r,this._panel.height-(0===i?30:25),.25,0===i?10:5);s.attr("fill",Raphael.rgb(32,32,32)),o.push(s)}this._frameTexts.push({text:a,bars:o})}},n.prototype._getFrame=function(t){var n=this._rect.attr("width");return t?t*this._maxFrame/n:e.MathTools.Clamp(this._mousex*this._maxFrame/n,0,this._maxFrame-1)},n.prototype._getPosition=function(e){var t=this._rect.attr("width");return e*t/this._maxFrame},n}();t.Timeline=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(e){this.container="BABYLON-EDITOR-TOOLS-TOOLBAR",this.toolbar=null,this.panel=null,this._playGameID="PLAY-GAME",this._testGameID="TEST-GAME",this._transformerPositionID="TRANSFORMER-POSITION",this._editor=e.editor,this._core=e,this.panel=this._editor.layouts.getPanelFromType("top"),this._core.updates.push(this),this._core.eventReceivers.push(this)}return n.prototype.onPreUpdate=function(){},n.prototype.onPostUpdate=function(){},n.prototype.onEvent=function(n){if(n.eventType===t.EventType.GUI_EVENT&&n.guiEvent.eventType===t.GUIEventType.TOOLBAR_MENU_SELECTED){if(n.guiEvent.caller!==this.toolbar||!n.guiEvent.data)return!1;var i=n.guiEvent.data,r=this.toolbar.decomposeSelectedMenu(i);if(!r||!r.parent)return!1;if(i=r.parent,i===this._transformerPositionID){var a=this.toolbar.isItemChecked(i);return this.toolbar.setItemChecked(i,!a),this._editor.transformer.enabled=!a,!0}if(i===this._testGameID)return t.GameTester.RunInWindow(this._core),!0;if(i===this._playGameID){var a=!this.toolbar.isItemChecked(i);if(this._core.isPlaying=a,a){this._editor.transformer.setNode(null),this._editor.transformer.enabled=!1,this.toolbar.setItemChecked(this._transformerPositionID,!1),this._core.engine.resize();for(var o=1*this._editor.timeline.currentTime/t.GUIAnimationEditor.FramesPerSecond/t.SceneFactory.AnimationSpeed,s=0;s<t.SceneFactory.NodesToStart.length;s++){var l=t.SceneFactory.NodesToStart[s];l instanceof e.Sound?(l.stop(),l.play(0,o)):(this._core.currentScene.stopAnimation(l),this._core.currentScene.beginAnimation(l,this._editor.timeline.currentTime,Number.MAX_VALUE,!1,t.SceneFactory.AnimationSpeed))}t.SceneFactory.NodesToStart.length>0&&this._editor.timeline.play()}else{this._core.engine.resize();for(var s=0;s<t.SceneFactory.NodesToStart.length;s++){var l=t.SceneFactory.NodesToStart[s];this._core.currentScene.stopAnimation(l),l instanceof e.Sound&&l.stop()}this._core.editor.timeline.stop()}this.toolbar.setItemChecked(i,a),t.SceneManager.SwitchActionManager();for(var s=0;s<this._core.currentScene.meshes.length;s++)this._core.currentScene.meshes[s].showBoundingBox=!1;return!0}}return!1},n.prototype.createUI=function(){null!=this.toolbar&&this.toolbar.destroy(),this.toolbar=new t.GUI.GUIToolbar(this.container,this._core),this.toolbar.createMenu("button",this._playGameID,"Play...","icon-play-game",void 0,"Play Game..."),this.toolbar.createMenu("button",this._testGameID,"Test...","icon-play-game-windowed",void 0,"Test Game..."),this.toolbar.addBreak(),this.toolbar.createMenu("button",this._transformerPositionID,"","icon-position",void 0,"Draw / Hide Manipulators"),this.toolbar.addBreak(),this.toolbar.buildElement(this.container)},n}();t.ToolsToolbar=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function t(t){this.core=null,this._scene=null,this._helperPlane=null,this._planeMaterial=null,this._subMesh=null,this._batch=null,this._cameraTexture=null,this._soundTexture=null,this._lightTexture=null,this.core=t,t.updates.push(this),this._scene=new e.Scene(t.engine),this._scene.autoClear=!1,this._scene.postProcessesEnabled=!1,this.createHelpers(t)}return t.prototype.createHelpers=function(t){this._planeMaterial=new e.StandardMaterial("HelperPlaneMaterial",this._scene),this._planeMaterial.emissiveColor=e.Color3.White(),this._planeMaterial.useAlphaFromDiffuseTexture=!0,this._planeMaterial.disableDepthWrite=!1,this._scene.materials.pop(),this._cameraTexture=new e.Texture("css/images/camera.png",this._scene),this._cameraTexture.hasAlpha=!0,this._scene.textures.pop(),this._soundTexture=new e.Texture("css/images/sound.png",this._scene),this._soundTexture.hasAlpha=!0,this._scene.textures.pop(),this._lightTexture=new e.Texture("css/images/light.png",this._scene),this._lightTexture.hasAlpha=!0,this._scene.textures.pop(),this._helperPlane=e.Mesh.CreatePlane("HelperPlane",1,this._scene,!1),this._helperPlane.billboardMode=e.Mesh.BILLBOARDMODE_ALL,this._scene.meshes.pop(),this._helperPlane.material=this._planeMaterial},t.prototype.onPreUpdate=function(){this._scene.activeCamera=this.core.currentScene.activeCamera},t.prototype.onPostUpdate=function(){var t=this;if((!this.core.isPlaying||this.core.currentScene.activeCamera===this.core.camera)&&this.core.editor.renderHelpers){var n=this._scene.getEngine();if(n.setAlphaTesting(!0),this._planeMaterial.isReady(this._helperPlane)){this._subMesh=this._helperPlane.subMeshes[0];var i=this._planeMaterial.getEffect();this._batch=this._helperPlane._getInstancesRenderList(this._subMesh._id),n.enableEffect(i),this._helperPlane._bind(this._subMesh,i,e.Material.TriangleFillMode),this._planeMaterial.diffuseTexture=this._cameraTexture,this._renderHelperPlane(this.core.currentScene.cameras,function(e){return e!==t.core.currentScene.activeCamera&&(t._helperPlane.position.copyFrom(e.position),!0)}),this._planeMaterial.diffuseTexture=this._soundTexture;for(var r=0;r<this.core.currentScene.soundTracks.length;r++){var a=this.core.currentScene.soundTracks[r];this._renderHelperPlane(a.soundCollection,function(e){return!!e.spatialSound&&(t._helperPlane.position.copyFrom(e._position),!0)})}this._planeMaterial.diffuseTexture=this._lightTexture,this._renderHelperPlane(this.core.currentScene.lights,function(e){return!!e.getAbsolutePosition&&(t._helperPlane.position.copyFrom(e.getAbsolutePosition()),!0)})}}},t.prototype.getScene=function(){return this._scene},t.prototype._renderHelperPlane=function(t,n){for(var i=this._planeMaterial.getEffect(),r=0;r<t.length;r++){var a=t[r];if(n(a)){var o=.03*e.Vector3.Distance(this.core.currentScene.activeCamera.position,this._helperPlane.position);this._helperPlane.scaling=new e.Vector3(o,o,o),this._helperPlane.computeWorldMatrix(!0),this._scene._cachedMaterial=null,this._planeMaterial.bind(this._helperPlane.getWorldMatrix(),this._helperPlane),this._helperPlane._processRendering(this._subMesh,i,e.Material.TriangleFillMode,this._batch,!1,function(e,t){i.setMatrix("world",t)})}}},t}();t.SceneHelpers=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(e){this._elements=[],this._core=e,this._element=$("#BABYLON-EDITOR-BOTTOM-PANEL"),this.panel=e.editor.layouts.getPanelFromType("bottom"),e.editor.layouts.setPanelSize("bottom",0)}return e.prototype.addElement=function(e,t,n,i){i=i||!1,this._core.editor.layouts.setPanelSize("bottom",35),this._element.append('<div id="'+e+'" style="float: '+(i?"right":"left")+'; height: 100%;">'+(n?'<img id="'+e+'_img" class="w2ui-icon '+n+' style="display: inline;"></img>':"")+'<div id="'+e+'_spinner" class="w2ui-spinner" style="width: 20px; height: 20px; display: none;"></div><p id="'+e+'_text" style="height: 100%; display: inline; vertical-align: super;">\t'+t+'\t</p><div id="'+e+'_separator" style="border-left:1px solid grey; height: 100%; display: inline-block;"></div></div>'),this._elements.push({id:e,"class":n})},e.prototype.removeElement=function(e){for(var t=0;t<this._elements.length;t++){var n=this._elements[t];if(n.id===e){var i=$("#"+e,this._element);return i.empty(),i.remove(),this._elements.splice(t,1),0===this._elements.length&&this._core.editor.layouts.setPanelSize("bottom",0),!0}}return!1},e.prototype.showSpinner=function(e){var t=$("#"+e+"_spinner",this._element);t.css("display","inline-block")},e.prototype.hideSpinner=function(e){var t=$("#"+e+"_spinner",this._element);t.css("display","none")},e.prototype.setText=function(e,t){$("#"+e+"_text").html("\t"+t+"\t")},e.prototype.setImage=function(e,t){var n=this._getItem(e),i=$("#"+e+"_img");i.removeClass(n["class"]),i.addClass(t)},e.prototype._getItem=function(e){for(var t=0;t<this._elements.length;t++)if(this._elements[t].id===e)return this._elements[t];return null},e}();e.StatusBar=t}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e,t,r,a,o,s){n.call(this,e.engine,e.currentScene,e.canvas,null,r,a,o,i._callbackStart(e)),this._sceneLoadedCallback=i._callback(t,e,this)}return __extends(i,n),i._callbackStart=function(e){return function(){e.editor.layouts.lockPanel("main","Loading...",!0)}},i._callback=function(n,i,r){var a=function(e,n){return function(e){t.ProjectImporter.ImportProject(i,e),i.editor.sceneGraphTool.createUI(),i.editor.sceneGraphTool.fillGraph(),i.editor.timeline.reset(),n.msClose&&n.msClose()}};return function(t,o){for(var s=r._filesToLoad,l=0;l<s.length;l++)s[l].name.indexOf(".editorproject")!==-1&&e.Tools.ReadFile(s[l],a(o,s[l]),null);o.getEngine().hideLoadingUI(),n&&n(t,o),i.editor.layouts.unlockPanel("main")}},i}(e.FilesInput);t.FilesInput=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(){}return n.GenerateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})},Object.defineProperty(n,"DummyNodeID",{get:function(){return"BABYLON-EDITOR-DUMMY-NODE"},enumerable:!0,configurable:!0}),n.ConfigureObject=function(n,i){(n instanceof e.AbstractMesh||n instanceof e.Scene)&&t.SceneManager.ConfigureObject(n,i),e.Tags.EnableFor(n),e.Tags.AddTagsTo(n,"added"),t.Event.sendSceneEvent(n,t.SceneEventType.OBJECT_ADDED,i)},n.CreateStandardRenderingPipeline=function(t){this.StandardPipeline&&(this.StandardPipeline.dispose(),this.StandardPipeline=null);var n=t.currentScene.cameras,i=new e.StandardRenderingPipeline("StandardRenderingPipeline",t.currentScene,1/devicePixelRatio,null,n);return i.lensTexture=i.lensFlareDirtTexture=new e.Texture("website/textures/lensdirt.jpg",t.currentScene),i.lensStarTexture=new e.Texture("website/textures/lensstar.png",t.currentScene),i.lensColorTexture=new e.Texture("website/textures/lenscolor.png",t.currentScene),this.StandardPipeline=i,i},n.CreateHDRPipeline=function(t,n){void 0===n&&(n={}),this.HDRPipeline&&(this.HDRPipeline.dispose(),this.HDRPipeline=null);var i,r=t.currentScene.cameras,a={finalRatio:1,blurRatio:.25/devicePixelRatio};if(n.lensTexture&&n.lensTexture.name)i=e.Texture.Parse(n.lensTexture,t.currentScene,"./");else if(n.lensTexture&&n.lensTexture.base64Name){var o=n.lensTexture.base64Buffer;i=e.Texture.CreateFromBase64String(o,"lensdirt.jpg",t.currentScene)}else i=new e.Texture("website/textures/lensdirt.jpg",t.currentScene);i.name=i.name.replace("data:","");var s=new e.HDRRenderingPipeline("hdr",t.currentScene,a,null,r,i);return s.brightThreshold=n.brightThreshold||1,s.gaussCoeff=n.gaussCoeff||.4,s.gaussMean=n.gaussMean||0,s.gaussStandDev=n.gaussStandDev||9,s.minimumLuminance=n.minimumLuminance||.5,s.luminanceDecreaseRate=n.luminanceDecreaseRate||.5,s.luminanceIncreaserate=n.luminanceIncreaserate||.5,s.exposure=n.exposure||1,s.gaussMultiplier=n.gaussMultiplier||4,s.exposureAdjustment=n.exposureAdjustment||s.exposureAdjustment,this.HDRPipeline=s,s},n.CreateSSAOPipeline=function(t,n){void 0===n&&(n={}),this.SSAOPipeline&&(this.SSAOPipeline.dispose(),this.SSAOPipeline=null);var i=t.currentScene.cameras,r=new e.SSAORenderingPipeline("ssao",t.currentScene,{ssaoRatio:.25/devicePixelRatio,combineRatio:1},i);return r.fallOff=n.fallOff||r.fallOff,r.area=n.area||r.area,r.radius=n.radius||r.radius,r.totalStrength=n.totalStrength||r.totalStrength,r.base=n.base||r.base,this.SSAOPipeline=r,r},n.CreateVLSPostProcess=function(t,n,i){void 0===n&&(n=null),void 0===i&&(i={});var r=new e.VolumetricLightScatteringPostProcess("vls",{passRatio:.5/devicePixelRatio,postProcessRatio:1/devicePixelRatio},t.camera,n,100);null===n&&this.ConfigureObject(r.mesh,t);for(var a=0;a<t.currentScene.cameras.length;a++)t.currentScene.cameras[a]!==t.camera&&t.currentScene.cameras[a].attachPostProcess(r);return r},n.AddPointLight=function(t){var n=new e.PointLight("New PointLight",new e.Vector3(10,10,10),t.currentScene);return n.id=this.GenerateUUID(),this.ConfigureObject(n,t),n},n.AddDirectionalLight=function(t){var n=new e.DirectionalLight("New DirectionalLight",new e.Vector3((-1),(-2),(-1)),t.currentScene);return n.position=new e.Vector3(10,10,10),n.id=this.GenerateUUID(),this.ConfigureObject(n,t),n},n.AddSpotLight=function(t){var n=new e.SpotLight("New SpotLight",new e.Vector3(10,10,10),new e.Vector3((-1),(-2),(-1)),.8,2,t.currentScene);return n.id=this.GenerateUUID(),this.ConfigureObject(n,t),n},n.AddHemisphericLight=function(t){var n=new e.HemisphericLight("New HemisphericLight",new e.Vector3((-1),(-2),(-1)),t.currentScene);return n.id=this.GenerateUUID(),this.ConfigureObject(n,t),n},n.AddBoxMesh=function(t){var n=e.Mesh.CreateBox("New Box",1,t.currentScene,!1);return n.id=this.GenerateUUID(),this.ConfigureObject(n,t),n},n.AddSphereMesh=function(t){var n=e.Mesh.CreateSphere("New Sphere",32,1,t.currentScene,!1);return n.id=this.GenerateUUID(),this.ConfigureObject(n,t),n},n.AddPlaneMesh=function(t){var n=e.Mesh.CreatePlane("New Plane",1,t.currentScene,!1);return n.rotation.x=Math.PI/2,n.id=this.GenerateUUID(),this.ConfigureObject(n,t),n},n.AddGroundMesh=function(t){var n=e.Mesh.CreateGround("New Ground",10,10,10,t.currentScene,!1);return n.id=this.GenerateUUID(),this.ConfigureObject(n,t),n},n.AddHeightMap=function(t){var n=e.Mesh.CreateGroundFromHeightMap("New Height Map","",10,10,32,1,1,t.currentScene,!1);return n.id=this.GenerateUUID(),this.ConfigureObject(n,t),n},n.AddParticleSystem=function(e,n){var i=this;if(void 0===n&&(n=!0),n){var r=new t.ObjectPicker(e);r.objectLists.push(e.currentScene.meshes),r.objectLists.push(e.currentScene.lights),r.windowName="Select an emitter ?",r.selectButtonName="Add",r.closeButtonName="Cancel",r.minSelectCount=0,r.onObjectPicked=function(n){if(n.length>1){var r=new t.GUI.GUIDialog("ParticleSystemDialog",e,"Warning","A Particle System can be attached to only one mesh.\nThe first was considered as the mesh.");r.buildElement(null)}var a=t.GUIParticleSystemEditor.CreateParticleSystem(e.currentScene,1e3);if(e.currentScene.meshes.pop(),a.emitter.id=i.GenerateUUID(),n.length>0){var o=a.emitter;o.dispose(!0),a.emitter=e.currentScene.getNodeByName(n[0]),t.Event.sendSceneEvent(a,t.SceneEventType.OBJECT_ADDED,e)}else e.currentScene.meshes.push(a.emitter),t.Event.sendSceneEvent(a.emitter,t.SceneEventType.OBJECT_ADDED,e),t.Event.sendSceneEvent(a,t.SceneEventType.OBJECT_ADDED,e);a.emitter.attachedParticleSystem=a},r.onClosedPicker=function(){},r.open()}},n.AddLensFlareSystem=function(i,r,a){if(void 0===r&&(r=!0),r){var o=new t.ObjectPicker(i);return o.objectLists.push(i.currentScene.meshes),o.objectLists.push(i.currentScene.lights),o.minSelectCount=1,o.windowName="Select an emitter...",o.onObjectPicked=function(r){if(r.length>1){var a=new t.GUI.GUIDialog("ReflectionProbeDialog",o.core,"Warning","A Lens Flare System can be attached to only one mesh.\nThe first was considered as the mesh.");a.buildElement(null)}var s=i.currentScene.getNodeByName(r[0]);if(s){var l=new e.LensFlareSystem("New Lens Flare System",s,i.currentScene),c=n.AddLensFlare(i,l,.2,0,new e.Color3(1,1,1)),d=n.AddLensFlare(i,l,.5,.2,new e.Color3(.5,.5,1)),h=n.AddLensFlare(i,l,.2,1,new e.Color3(1,1,1)),u=n.AddLensFlare(i,l,.4,.4,new e.Color3(1,.5,1)),p=n.AddLensFlare(i,l,.1,.6,new e.Color3(1,1,1)),m=n.AddLensFlare(i,l,.3,.8,new e.Color3(1,1,1));t.Tools.LoadAndCreateBase64Texture("website/textures/lens6.png",i.currentScene,function(e){c.texture=e,d.texture=e,h.texture=e,u.texture=e,p.texture=e,m.texture=e})}t.Event.sendSceneEvent(l,t.SceneEventType.OBJECT_ADDED,i)},o.open(),null}},n.AddLensFlare=function(t,n,i,r,a){var o=new e.LensFlare(i,r,a,null,n);return o},n.AddReflectionProbe=function(t){var n=new e.ReflectionProbe("New Reflection Probe",512,t.currentScene,(!0));return this.ConfigureObject(n,t),n},n.AddRenderTargetTexture=function(t){var n=new e.RenderTargetTexture("New Render Target Texture",512,t.currentScene,(!1));return t.currentScene.customRenderTargets.push(n),this.ConfigureObject(n,t),n},n.AddSkyMesh=function(t){var n=new e.SkyMaterial("skyMaterial",t.currentScene);n.backFaceCulling=!1;var i=e.Mesh.CreateBox("skyBox",1e3,t.currentScene,!1,e.Mesh.BACKSIDE);return i.id=this.GenerateUUID(),i.material=n,this.ConfigureObject(i,t),i},n.AddWaterMesh=function(n){var i=new e.WaterMaterial("waterMaterail",n.currentScene);t.Tools.LoadAndCreateBase64Texture("website/textures/normal.png",n.currentScene,function(e){return i.bumpTexture=e});var r=e.WaterMaterial.CreateDefaultMesh("waterMesh",n.currentScene);r.id=this.GenerateUUID(),r.material=i,this.ConfigureObject(r,n);for(var a=0;a<n.currentScene.meshes.length-1;a++)i.addToRenderList(n.currentScene.meshes[a]);return r},n.HDRPipeline=null,n.StandardPipeline=null,n.SSAOPipeline=null,n.VLSPostProcess=null,n.EnabledPostProcesses={hdr:!1,attachHDR:!0,ssao:!1,ssaoOnly:!1,attachSSAO:!0,standard:!1,attachStandard:!0,vls:!1},n.NodesToStart=[],n.AnimationSpeed=1,n}();t.SceneFactory=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(){}return n.ResetConfiguredObjects=function(){this._ConfiguredObjectsIDs={}},n.SwitchActionManager=function(){var e=this._SceneConfiguration.actionManager;this._SceneConfiguration.actionManager=this._SceneConfiguration.scene.actionManager,this._SceneConfiguration.scene.actionManager=e;for(var t in this._ConfiguredObjectsIDs){var n=this._ConfiguredObjectsIDs[t];e=n.mesh.actionManager,n.mesh.actionManager=n.actionManager,n.actionManager=e}},n.ConfigureObject=function(n,i,r,a){if(void 0===a&&(a=!0),n instanceof e.AbstractMesh){var o=n,s=o.getScene();if(o instanceof e.Mesh&&!o.geometry)return;this._ConfiguredObjectsIDs[o.id]={mesh:o,actionManager:o.actionManager},o.actionManager=new e.ActionManager(s),o.isPickable=!0,o.actionManager.registerAction(new e.SetValueAction(e.ActionManager.OnPointerOverTrigger,o,"showBoundingBox",(!0))),o.actionManager.registerAction(new e.SetValueAction(e.ActionManager.OnPointerOutTrigger,o,"showBoundingBox",(!1)));var l=s.pointerX,c=s.pointerY;o.actionManager.registerAction(new e.ExecuteCodeAction(e.ActionManager.OnPickTrigger,function(e){l=s.pointerX,c=s.pointerY})),o.actionManager.registerAction(new e.ExecuteCodeAction(e.ActionManager.OnPickUpTrigger,function(e){s.pointerX===l&&s.pointerY===c&&(t.Event.sendSceneEvent(o,t.SceneEventType.OBJECT_PICKED,i),i.editor.sceneGraphTool.sidebar.setSelected(o.id))})),r&&!o.parent&&(o.parent=r)}if(a){var d=new t.Event;d.eventType=t.EventType.SCENE_EVENT,d.sceneEvent=new t.SceneEvent(n,e.EDITOR.SceneEventType.OBJECT_PICKED),i.sendEvent(d)}},n.SaveObjectStates=function(t){var n=this;this._ObjectsStatesConfiguration={};var i=function(t,n){for(var r in t)if("_"!=r[0]){var a=t[r];"number"==typeof a||"string"==typeof a||"boolean"==typeof a?n[r]=a:a instanceof e.Vector2||a instanceof e.Vector3||a instanceof e.Vector4?n[r]=a:a instanceof e.Color3||a instanceof e.Color4?n[r]=a:a instanceof e.Material&&(n[r]={},i(a,n[r]))}},r=function(t){for(var r=0;r<t.length;r++){var a="Scene";t[r]instanceof e.Scene||(a=t[r].id),n._ObjectsStatesConfiguration[a]={},i(t[r],n._ObjectsStatesConfiguration[a])}};r(t.meshes),r(t.cameras),r(t.lights),r([t])},n.RestoreObjectsStates=function(t){var n=this,i=function(e,t){for(var n in t){t[n];"material"===n?i(e[n],t[n]):e[n]=t[n]}},r=function(t){for(var r=0;r<t.length;r++){var a="Scene";t[r]instanceof e.Scene||(a=t[r].id);var o=n._ObjectsStatesConfiguration[a];o&&i(t[r],o)}};r(t.meshes),r(t.cameras),r(t.lights),r([t])},n.AddCustomMetadata=function(e,t){this._CustomMetadatas[e]=t},n.RemoveCustomMetadata=function(e){return!!this._CustomMetadatas[e]&&(delete this._CustomMetadatas[e],!0)},n.GetCustomMetadata=function(e){return this._CustomMetadatas[e]?this._CustomMetadatas[e]:null},n._ConfiguredObjectsIDs={},n._CustomMetadatas={},n}();t.SceneManager=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(e){this.core=null,this.core=e}return e.prototype.createFolders=function(e,t,n,i){},e.prototype.getFiles=function(e,t,n){},e.prototype.createFiles=function(e,t,n,i,r){},e.prototype.selectFolder=function(e){},e}();e.Storage=t}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(n){function i(e){n.call(this,e),this._editor=e.editor}return __extends(i,n),i._OnAuthentificated=function(){var e="",t="";if(window.location.hash){var n=window.location.hash.substring(1),i=JSON.parse('{"'+n.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(e,t){return""===e?t:decodeURIComponent(t)});e=i.access_token,t=i.expires_in}window.opener.BABYLON.EDITOR.OneDriveStorage._ClosePopup(e,t,window)},i._ClosePopup=function(e,n,r){i._TOKEN=e,""===e?t.GUI.GUIWindow.CreateAlert("Cannot connect to OneDrive or get token..."):(i._TOKEN_EXPIRES_IN=parseInt(n),i._TOKEN_EXPIRES_NOW=Date.now()),r.OneDriveStorageCallback&&r.OneDriveStorageCallback(),r.close()},i._Login=function(e,n){var r=(Date.now()-i._TOKEN_EXPIRES_NOW)/1e3;if(""===i._TOKEN||r>=i._TOKEN_EXPIRES_IN){var a="https://login.live.com/oauth20_authorize.srf?client_id="+i._ClientID+"&redirect_uri="+t.Tools.GetBaseURL()+"redirect.html&response_type=token&nonce=7a16fa03-c29d-4e6a-aff7-c021b06a9b27&scope=wl.basic onedrive.readwrite wl.offline_access",o=t.Tools.OpenWindowPopup(a,512,512);o.OneDriveStorageCallback=n}else n()},i.prototype.createFolders=function(t,n,r,a){i._Login(this.core,function(){for(var o=0,s="",l=function(){o++,o===t.length&&(""!==s&&a&&a(s),r())},c=0;c<t.length;c++)$.ajax({url:"https://Api.Onedrive.com/v1.0/drive/items/"+n.file.id+"/children",type:"POST",contentType:"application/json",data:JSON.stringify({name:t[c],folder:{},"@name.conflictBehavior":"rename"}),headers:{Authorization:"Bearer "+i._TOKEN},success:function(){l()},error:function(t){s+="- "+t.statusText+"\n",l(),e.Tools.Error("BABYLON.EDITOR.OneDriveStorage: Cannot create folders (POST)")}})})},i.prototype.createFiles=function(t,n,r,a,o){i._Login(this.core,function(){for(var s=0,l="",c=function(){s++,o&&o(s),s===t.length&&(""!==l&&a&&a(l),r())},d=0;d<t.length;d++)$.ajax({url:"https://Api.Onedrive.com/v1.0/drive/items/"+(t[d].parentFolder?t[d].parentFolder.id:n.file.id)+":/"+t[d].name+":/content",processData:!1,data:t[d].content,type:"PUT",headers:{Authorization:"Bearer "+i._TOKEN},success:function(){c()},error:function(t){l+="- "+t.statusText+"\n",c(),e.Tools.Error("BABYLON.EDITOR.OneDriveStorage: Cannot upload files (PUT) of "+n.name)}})})},i.prototype.getFiles=function(t,n,r){i._Login(this.core,function(){$.ajax({url:"https://Api.Onedrive.com/v1.0/drive/"+(t?"items/"+t.file.id:"root")+"/children",type:"GET",
headers:{Authorization:"Bearer "+i._TOKEN},success:function(e){for(var t=[],i=0;i<e.value.length;i++)t.push({file:e.value[i],name:e.value[i].name});n(t)},error:function(n){var i="BABYLON.EDITOR.OneDriveStorage: Cannot get files (GET, children) of "+(t?"folder "+t.name:"root");r?r(i):e.Tools.Error(i)}})})},i._ClientID="000000004C18353E",i._TOKEN="",i._TOKEN_EXPIRES_IN=0,i._TOKEN_EXPIRES_NOW=0,i._POPUP=null,i}(t.Storage);t.OneDriveStorage=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(e){this._window=null,this._editor=null,this._editorID="BABYLON-EDITOR-EXPORT-WINDOW-EDITOR",this._generatedCode="",this.core=e}return n.prototype.openSceneExporter=function(e){var n=this,i=t.GUI.GUIElement.CreateDivElement(this._editorID,"width: 100%; height: 100%");this._window=new t.GUI.GUIWindow("WindowExport",this.core,"Export Project",i),this._window.buildElement(null),this._window.onToggle=function(e,t,i){n._editor.resize()},this._editor=ace.edit(this._editorID),this._editor.setTheme("ace/theme/clouds"),this._editor.getSession().setMode("ace/mode/javascript"),this._generatedCode=this.generateCode(e)},n.prototype.generateCode=function(n){var i=(this.core.currentScene,"");if(n){var r=e.SceneSerializer.Serialize(this.core.currentScene);i=JSON.stringify(r,null,"\t")}else i=t.ProjectExporter.ExportProject(this.core,!0);return this._editor&&(this._editor.setValue(i,-1),n||this._editor.getSession().setUseWrapMode(!1)),i},n.prototype._exportParticleSystem=function(t){var n=t.emitter,i="";i=n.geometry?'\tnode = scene.getMeshByName("'+n.name+'");\n':'\tnode = new BABYLON.Mesh("'+n.name+'", scene, null, null, true);\n',i+='\tparticleSystem = new BABYLON.ParticleSystem("'+t.name+'", '+t.getCapacity()+", scene);\n",i+="\tparticleSystem.emitter = node;\n";for(var r in t)if("_"!==r[0]){var a=t[r],o="";if("number"==typeof a||"boolean"==typeof a)o+=a;else if("string"==typeof a)o+='"'+a+'"';else if(a instanceof e.Vector3)o=this._exportVector3(a);else if(a instanceof e.Color4)o+=this._exportColor4(a);else if(a instanceof e.Color3)o+=this._exportColor3(a);else{if(!(a instanceof e.Texture))continue;o+='BABYLON.Texture.CreateFromBase64String("'+a._buffer+'", "'+a.name+'", scene)'}i+="\tparticleSystem."+r+" = "+o+";\n"}return i+="\tnode.attachedParticleSystem = particleSystem;\n",t._stopped||(i+="\tparticleSystem.start();\n"),i},n.prototype._exportVector3=function(e){return"new BABYLON.Vector3("+e.x+", "+e.y+", "+e.z+")"},n.prototype._exportColor3=function(e){return"new BABYLON.Color3("+e.r+", "+e.g+", "+e.b+")"},n.prototype._exportColor4=function(e){return"new BABYLON.Color4("+e.r+", "+e.g+", "+e.b+", "+e.a+")"},n}();t.Exporter=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(){}return n.ExportProject=function(n,i){void 0===i&&(i=!1),e.SceneSerializer.ClearCache(),n.isPlaying||t.SceneManager.SwitchActionManager();var r={globalConfiguration:this._SerializeGlobalAnimations(),materials:[],particleSystems:[],nodes:[],shadowGenerators:[],postProcesses:this._SerializePostProcesses(),lensFlares:this._SerializeLensFlares(n),renderTargets:this._SerializeRenderTargets(n),actions:this._SerializeActionManager(n.currentScene),physicsEnabled:n.currentScene.isPhysicsEnabled(),sounds:this._SerializeSounds(n),requestedMaterials:i?[]:void 0,customMetadatas:this._SerializeCustomMetadatas()};return this._TraverseNodes(n,null,r),n.isPlaying||t.SceneManager.SwitchActionManager(),JSON.stringify(r,null,"\t")},n._SerializeGlobalAnimations=function(){for(var n={globalAnimationSpeed:t.SceneFactory.AnimationSpeed,framesPerSecond:t.GUIAnimationEditor.FramesPerSecond,animatedAtLaunch:[]},i=0;i<t.SceneFactory.NodesToStart.length;i++){var r=t.SceneFactory.NodesToStart[i],a="Node";r instanceof e.Scene?a="Scene":r instanceof e.Sound?a="Sound":r instanceof e.ParticleSystem&&(a="ParticleSystem");var o={name:r.name,type:a};n.animatedAtLaunch.push(o)}return n},n._SerializeSounds=function(t){var n=[],i=0;for(i=0;i<t.currentScene.soundTracks[0].soundCollection.length;i++){var r=t.currentScene.soundTracks[0].soundCollection[i];e.Tags.HasTags(r)&&e.Tags.MatchesQuery(r,"added")&&n.push({name:r.name,serializationObject:r.serialize()})}return n},n._SerializeRenderTargets=function(t){var n=[],i=0;for(i=0;i<t.currentScene.reflectionProbes.length;i++){var r=t.currentScene.reflectionProbes[i],a=r._attachedMesh,o={isProbe:!0,serializationObject:{}};a&&(o.serializationObject.attachedMeshId=a.id),o.serializationObject.name=r.name,o.serializationObject.size=r.cubeTexture.getBaseSize().width,o.serializationObject.generateMipMaps=r.cubeTexture._generateMipMaps,o.serializationObject.renderList=[];for(var s=0;s<r.renderList.length;s++)o.serializationObject.renderList.push(r.renderList[s].id);n.push(o)}for(i=0;i<t.currentScene.customRenderTargets.length;i++){var l=t.currentScene.customRenderTargets[i];if(e.Tags.HasTags(l)&&e.Tags.MatchesQuery(l,"added")){var o={isProbe:!1,serializationObject:l.serialize()};n.push(o)}}return n},n._SerializeLensFlares=function(e){for(var t=[],n=0;n<e.currentScene.lensFlareSystems.length;n++){for(var i=e.currentScene.lensFlareSystems[n],r={serializationObject:i.serialize()},a=r.serializationObject.flares,n=0;n<a.length;n++)a[n].base64Name=a[n].textureName,delete a[n].textureName,a[n].base64Buffer=i.lensFlares[n].texture._buffer;t.push(r)}return t},n._SerializePostProcesses=function(){var e=[];return t.SceneFactory.SSAOPipeline&&e.push({attach:t.SceneFactory.EnabledPostProcesses.attachSSAO,name:"SSAOPipeline",serializationObject:this._ConfigureBase64Texture(t.SceneFactory.SSAOPipeline,t.SceneFactory.SSAOPipeline.serialize())}),t.SceneFactory.HDRPipeline&&e.push({attach:t.SceneFactory.EnabledPostProcesses.attachHDR,name:"HDRPipeline",serializationObject:this._ConfigureBase64Texture(t.SceneFactory.HDRPipeline,t.SceneFactory.HDRPipeline.serialize())}),e},n._TraverseNodes=function(t,n,i){var r=t.currentScene;if(n){if(n!==t.camera){for(var a=0;a<r.particleSystems.length;a++){var o=r.particleSystems[a];if(o.emitter===n){var s={hasEmitter:!(e.Tags.HasTags(n)&&e.Tags.MatchesQuery(n,"added_particlesystem")),serializationObject:o.serialize()};s.hasEmitter||(s.emitterPosition=o.emitter.position.asArray()),s.serializationObject.base64TextureName=o.particleTexture.name,s.serializationObject.base64Texture=o.particleTexture._buffer,delete s.serializationObject.textureName,i.particleSystems.push(s)}}if(n instanceof e.AbstractMesh&&n.material&&!(n.material instanceof e.StandardMaterial)){var l=n.material;if(!e.Tags.HasTags(l)||!e.Tags.MatchesQuery(l,"furShellMaterial")){if(l instanceof e.MultiMaterial)for(var c=0;c<l.subMaterials.length;c++){var d=l.subMaterials[c];if(!(d instanceof e.StandardMaterial)){var h={meshesNames:[n.name],newInstance:!0,serializedValues:d.serialize()};this._ConfigureMaterial(l,h),i.materials.push(h),this._RequestMaterial(t,i,d)}}var u=this._GetSerializedMaterial(i,l.name);if(u)u.meshesNames.push(n.name);else{var h={meshesNames:[n.name],newInstance:!0,serializedValues:l.serialize()};this._ConfigureMaterial(l,h),i.materials.push(h),this._RequestMaterial(t,i,l)}}}var p={name:n instanceof e.Scene?"Scene":n.name,id:n instanceof e.Scene?"Scene":n instanceof e.Sound?"Sound":n.id,type:n instanceof e.Scene?"Scene":n instanceof e.Sound?"Sound":n instanceof e.Light?"Light":n instanceof e.Camera?"Camera":"Mesh",animations:[]},m=!1;if(e.Tags.HasTags(n)&&(e.Tags.MatchesQuery(n,"added_particlesystem")&&(m=!0),e.Tags.MatchesQuery(n,"added"))){if(m=!0,n instanceof e.Mesh){p.serializationObject=e.SceneSerializer.SerializeMesh(n,!1,!1);for(var _=0;_<p.serializationObject.meshes.length;_++)delete p.serializationObject.meshes[_].animations,delete p.serializationObject.meshes[_].actions}else p.serializationObject=n.serialize(),delete p.serializationObject.animations;delete p.serializationObject.animations}if(n instanceof e.Light){var f=n.getShadowGenerator();f&&e.Tags.HasTags(f)&&e.Tags.MatchesQuery(f,"added")&&i.shadowGenerators.push(n.getShadowGenerator().serialize())}if(n.animations)for(var v=n,g=0;g<v.animations.length;g++){var T=v.animations[g];if(e.Tags.HasTags(T)&&e.Tags.MatchesQuery(T,"modified")){m=!0;var E={events:[],serializationObject:T.serialize(),targetName:n instanceof e.Scene?"Scene":n.name,targetType:n instanceof e.Scene?"Scene":n instanceof e.Sound?"Sound":"Node"};p.animations.push(E)}}if(n instanceof e.AbstractMesh){var y=n.getPhysicsImpostor();y&&e.Tags.HasTags(y)&&e.Tags.MatchesQuery(y,"added")&&(m=!0,p.physics={physicsMass:n.getPhysicsMass(),physicsFriction:n.getPhysicsFriction(),physicsRestitution:n.getPhysicsRestitution(),physicsImpostor:n.getPhysicsImpostor().type}),p.actions=this._SerializeActionManager(n),p.actions&&(m=!0)}m&&i.nodes.push(p)}if(n instanceof e.Node)for(var a=0;a<n.getDescendants().length;a++)this._TraverseNodes(t,n.getDescendants()[a],i)}else{this._TraverseNodes(t,t.currentScene,i);var S=[];this._FillRootNodes(t,S,"lights"),this._FillRootNodes(t,S,"cameras"),this._FillRootNodes(t,S,"meshes");for(var a=0;a<S.length;a++)this._TraverseNodes(t,S[a],i)}},n._SerializeActionManager=function(t){return t.actionManager&&e.Tags.HasTags(t.actionManager)&&e.Tags.MatchesQuery(t.actionManager,"added")?t.actionManager.serialize(t instanceof e.Scene?"Scene":t.name):null},n._SerializeCustomMetadatas=function(){var e={};for(var n in t.SceneManager._CustomMetadatas)e[n]=t.SceneManager._CustomMetadatas[n];return e},n._RequestMaterial=function(t,n,i){if(!(!i||i instanceof e.StandardMaterial||i instanceof e.MultiMaterial||i instanceof e.PBRMaterial)&&n.requestedMaterials){var r=i.constructor?i.constructor.name:null;if(r){var a=n.requestedMaterials.indexOf(r);a===-1&&n.requestedMaterials.push(r)}}},n._GetSerializedMaterial=function(e,t){for(var n=0;n<e.materials.length;n++)if(e.materials[n].serializedValues.name===t)return e.materials[n];return null},n._ConfigureMaterial=function(t,n){for(var i in t){var r=t[i];r instanceof e.BaseTexture&&n.serializedValues[i]&&r._buffer&&(n.serializedValues[i].base64String=r._buffer)}},n._ConfigureBase64Texture=function(t,n){for(var i in t){var r=t[i];r instanceof e.BaseTexture&&n[i]&&r._buffer&&(n[i].base64String=r._buffer)}return n},n._FillRootNodes=function(e,t,n){for(var i=e.currentScene,r=i[n],a=0;a<r.length;a++)r[a].parent||t.push(r[a])},n}();t.ProjectExporter=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(){}return n.ImportProject=function(n,i){var r=JSON.parse(i);t.Tools.CleanProject(r),!n.currentScene.isPhysicsEnabled()&&r.physicsEnabled&&n.currentScene.enablePhysics(n.currentScene.gravity,new e.CannonJSPlugin);for(var a=0;a<r.renderTargets.length;a++){var o=r.renderTargets[a];if(o.isProbe){var s=new e.ReflectionProbe(o.serializationObject.name,o.serializationObject.size,n.currentScene,o.serializationObject.generateMipMaps);s._waitingRenderList=o.serializationObject.renderList,o.waitingTexture=s}else{var l=e.Texture.Parse(o.serializationObject,n.currentScene,"./");l._waitingRenderList=void 0,o.waitingTexture=l,e.Tags.EnableFor(l),e.Tags.AddTagsTo(l,"added")}}for(var a=0;a<r.materials.length;a++){var c=r.materials[a];if(c.newInstance&&c.serializedValues.customType){var d=e.Tools.Instantiate(c.serializedValues.customType);c._babylonMaterial=d.Parse(c.serializedValues,n.currentScene,"file:")}}for(var a=0;a<r.sounds.length;a++){var h=e.Sound.Parse(r.sounds[a].serializationObject,n.currentScene,"");h.name=r.sounds[a].name,e.Tags.EnableFor(h),e.Tags.AddTagsTo(h,"added")}for(var a=0;a<r.nodes.length;a++){var u=r.nodes[a],p=null;switch(u.type){case"Mesh":case"Light":case"Camera":if(u.serializationObject)if("Mesh"===u.type){for(var m=u.serializationObject.geometries.vertexData,_=0;_<m.length;_++)e.Geometry.Parse(m[_],n.currentScene,"./");for(var f=u.serializationObject.meshes,v=0;v<f.length;v++)p=e.Mesh.Parse(f[v],n.currentScene,"./"),e.Tags.EnableFor(p)}else"Light"===u.type?p=e.Light.Parse(u.serializationObject,n.currentScene):"Camera"===u.type&&(p=e.Camera.Parse(u.serializationObject,n.currentScene));else p=n.currentScene.getNodeByName(u.name);break;case"Scene":p=n.currentScene;break;default:continue}if(!p)for(var g=0;g<r.particleSystems.length;g++){var T=r.particleSystems[g];if(!T.hasEmitter&&u.id&&T.serializationObject&&T.serializationObject.emitterId===u.id){p=new e.Mesh(u.name,n.currentScene,null,null,(!0)),p.id=u.id,e.Tags.EnableFor(p),e.Tags.AddTagsTo(p,"added_particlesystem");break}}if(p){u.animations.length>0&&!p.animations&&(p.animations=[]);for(var E=0;E<u.animations.length;E++){var y=u.animations[E],S=e.Animation.Parse(y.serializationObject);p.animations.push(S),e.Tags.EnableFor(S),e.Tags.AddTagsTo(S,"modified")}if(p instanceof e.AbstractMesh){u.physics&&p.setPhysicsState(u.physics.physicsImpostor,{mass:u.physics.physicsMass,friction:u.physics.physicsFriction,restitution:u.physics.physicsRestitution});var I=p.actionManager;u.actions&&(e.ActionManager.Parse(u.actions,p,n.currentScene),e.Tags.EnableFor(p.actionManager),e.Tags.AddTagsTo(p.actionManager,"added"),t.SceneManager._ConfiguredObjectsIDs[p.id]&&(t.SceneManager._ConfiguredObjectsIDs[p.id].actionManager=p.actionManager),p.actionManager=I),t.SceneManager._ConfiguredObjectsIDs[p.id]||t.SceneManager.ConfigureObject(p,n)}}else e.Tools.Warn("Cannot configure node named "+u.name+" , with ID "+u.id)}for(var a=0;a<r.particleSystems.length;a++){var T=r.particleSystems[a],b=e.ParticleSystem.Parse(T.serializationObject,n.currentScene,"./");T.serializationObject.base64Texture;b.particleTexture=e.Texture.CreateFromBase64String(T.serializationObject.base64Texture,T.serializationObject.base64TextureName,n.currentScene),b.particleTexture.name=b.particleTexture.name.replace("data:",""),!T.hasEmitter&&T.emitterPosition&&(b.emitter.position=e.Vector3.FromArray(T.emitterPosition)),b.emitter.attachedParticleSystem=b}for(var a=0;a<r.lensFlares.length;a++)for(var O=r.lensFlares[a],A=e.LensFlareSystem.Parse(O.serializationObject,n.currentScene,"./"),a=0;a<A.lensFlares.length;a++){var C=O.serializationObject.flares[a];A.lensFlares[a].texture=e.Texture.CreateFromBase64String(C.base64Buffer,C.base64Name.replace("data:",""),n.currentScene)}for(var a=0;a<r.shadowGenerators.length;a++){var L=r.shadowGenerators[a],P=e.ShadowGenerator.Parse(L,n.currentScene);e.Tags.EnableFor(P),e.Tags.AddTagsTo(P,"added"),P.getShadowMap().renderList.some(function(e,t,n){return!e&&(n.splice(t,1),!0)})}r.actions&&(e.ActionManager.Parse(r.actions,null,n.currentScene),e.Tags.EnableFor(n.currentScene.actionManager),e.Tags.AddTagsTo(n.currentScene.actionManager,"added"),t.SceneManager._SceneConfiguration.actionManager=n.currentScene.actionManager),t.SceneFactory.AnimationSpeed=r.globalConfiguration.globalAnimationSpeed,t.GUIAnimationEditor.FramesPerSecond=r.globalConfiguration.framesPerSecond||t.GUIAnimationEditor.FramesPerSecond,n.editor.sceneToolbar.setFramesPerSecond(t.GUIAnimationEditor.FramesPerSecond);for(var a=0;a<r.globalConfiguration.animatedAtLaunch.length;a++){var B=r.globalConfiguration.animatedAtLaunch[a];switch(B.type){case"Scene":t.SceneFactory.NodesToStart.push(n.currentScene);break;case"Node":t.SceneFactory.NodesToStart.push(n.currentScene.getNodeByName(B.name));break;case"Sound":t.SceneFactory.NodesToStart.push(n.currentScene.getSoundByName(B.name));break;case"ParticleSystem":t.SceneFactory.NodesToStart.push(t.Tools.GetParticleSystemByName(n.currentScene,B.name))}}for(var a=0;a<r.postProcesses.length;a++){var N=r.postProcesses[a];if(t.SceneFactory["Create"+N.name]){var D=t.SceneFactory["Create"+N.name](n,N.serializationObject);void 0===N.attach||N.attach||D._detachCameras(n.currentScene.cameras)}}for(var a=0;a<r.renderTargets.length;a++){var o=r.renderTargets[a];o.isProbe&&o.serializationObject.attachedMeshId&&o.waitingTexture.attachToMesh(n.currentScene.getMeshByID(o.serializationObject.attachedMeshId));for(var R=0;R<o.serializationObject.renderList.length;R++){var x=n.currentScene.getMeshByID(o.serializationObject.renderList[R]);x&&o.waitingTexture.renderList.push(x)}}for(var a=0;a<r.materials.length;a++){var c=r.materials[a];if(c.meshesNames&&c.serializedValues.customType)for(var w=r.materials[a].meshesNames,F=0;F<w.length;F++){var M=n.currentScene.getMeshByName(w[F]);M&&(M.material=r.materials[a]._babylonMaterial)}}for(var G in r.customMetadatas)t.SceneManager.AddCustomMetadata(G,r.customMetadatas[G])},n}();t.ProjectImporter=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(t,i){void 0===i&&(i=n.OneDriveStorage),this._window=null,this._filesList=null,this._currentChildrenFolder=null,this._currentFolder=null,this._previousFolders=null,this._onFolderSelected=null,this._statusBarId="ONE-DRIVE-STATUS-BAR",this.core=t,t.eventReceivers.push(this),this._storage=new e.EDITOR[i](this.core)}return Object.defineProperty(n,"OneDriveStorage",{get:function(){return"OneDriveStorage"},enumerable:!0,configurable:!0}),n.prototype.onEvent=function(e){var n=this;if(e.eventType===t.EventType.GUI_EVENT&&e.guiEvent.caller===this._filesList&&e.guiEvent.eventType===t.GUIEventType.GRID_SELECTED){var i=this._filesList.getSelectedRows()[0],r=this._filesList.getRow(i);if("folder"===r.type){var a=this._getFileFolder(r.name,"folder",this._currentChildrenFolder);this._previousFolders.push(this._currentFolder),this._updateFolderDialog(a)}else if("previous"===r.type){var o=this._previousFolders.pop();this._updateFolderDialog(o)}return!0}if(e.eventType===t.EventType.GUI_EVENT&&e.guiEvent.caller===this._window&&e.guiEvent.eventType===t.GUIEventType.WINDOW_BUTTON_CLICKED){var s=e.guiEvent.data;this._filesList.getSelectedRows();return"Choose"===s&&this._currentFolder&&this._storage.getFiles(this._currentFolder,function(e){n._onFolderSelected(n._currentFolder,e)}),this._window.close(),!0}return!1},n.prototype.createTemplate=function(){var e=this;this._openFolderDialog(function(t,i){e.core.editor.statusBar.addElement(e._statusBarId,"Preparing Template...","icon-one-drive"),e.core.editor.statusBar.showSpinner(e._statusBarId),n._ProjectFolder=t,n._ProjectFolderChildren=i;for(var r=["materials","textures","libs","scene","defines","code",".vscode"],a=0;a<i.length;a++){var o=r.indexOf(i[a].name);o!==-1&&r.splice(o,1)}var s={codeFolderExists:r.indexOf("code")===-1,vscodeFolderExists:r.indexOf(".vscode")===-1};0===r.length?e._createTemplate(s):e._storage.createFolders(r,t,function(){e._createTemplate(s)},function(){e.core.editor.statusBar.removeElement(e._statusBarId)})})},n.prototype["export"]=function(){var e=this;return n._ProjectFolder?(this.core.editor.statusBar.addElement(this._statusBarId,"Exporting...",t.Tools.CheckIfElectron()?"icon-save":"icon-one-drive"),this.core.editor.statusBar.showSpinner(this._statusBarId),void this._updateFileList(function(){var i=[{name:"scene.editorproject",content:t.ProjectExporter.ExportProject(e.core)}];e._storage.createFiles(i,n._ProjectFolder,function(){e.core.editor.statusBar.removeElement(e._statusBarId)})})):void this._openFolderDialog(function(t,i){n._ProjectFolder=t,n._ProjectFolderChildren=i,e["export"]()})},n.prototype._createTemplate=function(i){var r=this;this._updateFileList(function(){var a=[],o=t.Tools.GetBaseURL(),s=t.ProjectExporter.ExportProject(r.core,!0),l=JSON.parse(s),c=r.getFolder("scene"),d=r.core.editor.filesInput._sceneFileToLoad;a.push({name:d?d.name:"scene.babylon",content:JSON.stringify(t.BabylonExporter.GenerateFinalBabylonFile(r.core)),parentFolder:c.file}),a.push({name:"extensions.editorextensions",content:JSON.stringify(l.customMetadatas),parentFolder:c.file});for(var h=0;h<l.lensFlares.length;h++)for(var u=l.lensFlares[h].serializationObject,p=0;p<u.flares.length;p++)r._fileExists(a,u.flares[p].base64Name,c)||a.push({name:u.flares[p].base64Name,content:t.Tools.ConvertBase64StringToArrayBuffer(u.flares[p].base64Buffer),parentFolder:c.file});for(var h=0;h<l.particleSystems.length;h++){var m=l.particleSystems[h].serializationObject;r._fileExists(a,m.base64TextureName,c)||a.push({name:m.base64TextureName,content:t.Tools.ConvertBase64StringToArrayBuffer(m.base64Texture),parentFolder:c.file})}if(t.SceneFactory.HDRPipeline&&t.SceneFactory.HDRPipeline.lensTexture){var _=t.SceneFactory.HDRPipeline.lensTexture.name;a.push({name:_,content:t.Tools.ConvertBase64StringToArrayBuffer(t.SceneFactory.HDRPipeline.lensTexture._buffer),parentFolder:r.getFolder("textures").file})}var f=a.length;a.push({name:"index.html",url:o+"templates/index.html",content:null}),i.codeFolderExists||(a.push({name:"game.ts",url:o+"templates/game.ts.template",content:null,parentFolder:r.getFolder("code").file}),a.push({name:"development.ts",url:o+"templates/development.ts.template",content:null,parentFolder:r.getFolder("code").file})),i.vscodeFolderExists||a.push({name:"tasks.json",url:o+"templates/tasksTemplate.json",content:null,parentFolder:r.getFolder(".vscode").file}),a.push({name:"run.bat",url:o+"templates/run.bat",content:null}),a.push({name:"run.sh",url:o+"templates/run.bat",content:null}),a.push({name:"server.js",url:o+"templates/server.js",content:null}),a.push({name:"tsconfig.json",url:o+"templates/tsconfigTemplate.json",content:null}),a.push({name:"Web.config",url:o+"templates/WebConfigTemplate.xml",content:null}),a.push({name:"babylon.max.js",url:o+"libs/preview bjs/babylon.max.js",content:null,parentFolder:r.getFolder("libs").file}),a.push({name:"babylon.editor.extensions.js",url:o+"libs/preview release/babylon.editor.extensions.js",content:null,parentFolder:r.getFolder("libs").file}),r.core.currentScene.getPhysicsEngine()&&a.push({name:"cannon.js",url:o+"libs/cannon.js",content:null,parentFolder:r.getFolder("libs").file}),a.push({name:"babylon.d.ts",url:o+"defines/babylon.d.ts",content:null,parentFolder:r.getFolder("defines").file}),a.push({name:"babylon.editor.extensions.d.ts",url:o+"libs/preview release/babylon.editor.extensions.d.ts",content:null,parentFolder:r.getFolder("defines").file});for(var h=0;h<l.requestedMaterials.length;h++){var v="babylon."+l.requestedMaterials[h]+".js";a.push({name:v,url:o+"libs/materials/"+v,content:null,parentFolder:r.getFolder("materials").file})}var g=function(e){return function(t){f++,e>=0&&("index.html"===a[e].name&&(t=r._processIndexHTML(l,t)),a[e].content=t),f>=a.length&&(r._storage.createFiles(a,n._ProjectFolder,function(){r.core.editor.statusBar.removeElement(r._statusBarId)},function(e){r.core.editor.statusBar.removeElement(r._statusBarId)},function(e){r.core.editor.statusBar.setText(r._statusBarId,"Exporting Template... "+e+" / "+a.length)}),n._ProjectFolder=null,n._ProjectFolderChildren=null)}};if(f===a.length)g(-1)(null);else{r.core.editor.statusBar.setText(r._statusBarId,"Configuring files...");for(var h=0;h<a.length;h++)a[h].url&&e.Tools.LoadFile(a[h].url,g(h),null,null,"arraybuffer"===a[h].type);for(var T in e.FilesInput.FilesTextures)a.push({name:T,content:null,parentFolder:c.file}),e.Tools.ReadFile(e.FilesInput.FilesTextures[T],g(a.length-1),null,!0);for(var E in e.FilesInput.FilesToLoad)a.push({name:E,content:null,parentFolder:c.file}),e.Tools.ReadFile(e.FilesInput.FilesToLoad[E],g(a.length-1),null,!0)}})},n.prototype._fileExists=function(e,t,n){for(var i=0;i<e.length;i++)if(e[i].name===t&&e[i].parentFolder===n.file)return!0;return!1},n.prototype._processIndexHTML=function(e,t){for(var n=t,i="",r=0;r<e.requestedMaterials.length;r++)i+='\t<script src="materials/babylon.'+e.requestedMaterials[r]+'.js" type="text/javascript"></script>\n';var a=this.core.editor.filesInput._sceneFileToLoad;return n=n.replace("EXPORTER-SCENE-NAME",a?a.name:"scene.babylon"),n=n.replace("EXPORTER-JS-FILES-TO-ADD",i)},n.prototype._openFolderDialog=function(e){var i=this;if(!n._IsWindowOpened){n._IsWindowOpened=!0,this._onFolderSelected=e;var r="BABYLON-STORAGE-EXPORTER-GRID",a=t.GUI.GUIElement.CreateElement("div",r);this._window=new t.GUI.GUIWindow("BABYLON-STORAGE-EXPORTER-WINDOW",this.core,"Choose folder...",a),this._window.modal=!0,this._window.showMax=!1,this._window.buttons=["Choose","Cancel"],this._window.setOnCloseCallback(function(){n._IsWindowOpened=!1,i.core.removeEventReceiver(i),i._filesList.destroy()}),this._window.buildElement(null),this._filesList=new t.GUI.GUIGrid(r,this.core),this._filesList.header="Files and Folders",this._filesList.createColumn("name","name","80%"),this._filesList.createColumn("type","type","20%"),this._filesList.buildElement(r),this._previousFolders=[],this._updateFolderDialog()}},n.prototype._updateFolderDialog=function(e){var t=this;void 0===e&&(e=null),this._filesList.lock("Loading...",!0),this._filesList.clear(),this._currentFolder=e,this._filesList.addRecord({name:"..",type:"previous",recid:0}),this._storage.getFiles(e,function(e){t._currentChildrenFolder=e;for(var n=0;n<e.length;n++)t._filesList.addRecord({name:e[n].name,type:e[n].file.folder?"folder":"file",recid:n+1});t._filesList.refresh(),t._filesList.unlock()},function(){t._filesList.unlock()})},n.prototype._updateFileList=function(e){this._storage.getFiles(n._ProjectFolder,function(t){n._ProjectFolderChildren=t,e()})},n.prototype._getFileFolder=function(e,t,n){for(var i=0;i<n.length;i++)if(n[i].file.name===e&&n[i].file[t])return n[i];return{file:null,name:""}},n.prototype.getFolder=function(e){return this._getFileFolder(e,"folder",n._ProjectFolderChildren)},n.prototype.getFile=function(e){return this._getFileFolder(e,"file",n._ProjectFolderChildren)},n._ProjectFolder=null,n._ProjectFolderChildren=null,n._IsWindowOpened=!1,n}();t.StorageExporter=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n;!function(e){e[e.COPY=0]="COPY",e[e.PASTE=1]="PASTE",e[e.PASTE_KEYS=2]="PASTE_KEYS"}(n||(n={}));var i=function(){function i(t,n){this.core=null,this._animationsList=null,this._keysList=null,this._valuesForm=null,this._currentAnimation=null,this._currentKey=null,this._addAnimationWindow=null,this._addAnimationLayout=null,this._addAnimationGraph=null,this._addAnimationForm=null,this._addAnimationName="New Animation",this._addAnimationType=e.Animation.ANIMATIONLOOPMODE_CYCLE,this._addAnimationTypeName="Cycle",this._editedAnimation=null,this._graphPaper=null,this._graphLines=[],this._graphValueTexts=[],this._graphMiddleLine=null,this._graphTimeLines=[],this._graphTimeTexts=[],this.core=t,this.core.eventReceivers.push(this),this.object=n,this.core.editor.editPanel.close(),this._createUI()}return i.prototype.onEvent=function(e){if(e.eventType!==t.EventType.GUI_EVENT)return!1;if(e.guiEvent.eventType===t.GUIEventType.WINDOW_BUTTON_CLICKED&&e.guiEvent.caller===this._addAnimationWindow){var n=e.guiEvent.data;return"Cancel"===n?(this._addAnimationWindow.close(),!0):(this._onAddAnimation(),!0)}return e.guiEvent.caller===this._animationsList?(this._setRecords(0,""),!0):e.guiEvent.caller===this._keysList&&null!==this._currentAnimation&&(this.core.editor.timeline.reset(),!0)},i.prototype._createAnimation=function(){var n=this;if(this._editedAnimation)switch(this._addAnimationName=this._editedAnimation.name,this._addAnimationTypeName="Cycle",this._addAnimationType){case e.Animation.ANIMATIONLOOPMODE_RELATIVE:this._addAnimationTypeName="Relative";break;case e.Animation.ANIMATIONLOOPMODE_CONSTANT:this._addAnimationTypeName="Constant"}var i="BABYLON-EDITOR-EDIT-ANIMATIONS-ADD",r="BABYLON-EDITOR-EDIT-ANIMATIONS-ADD-GRAPH",a="BABYLON-EDITOR-EDIT-ANIMATIONS-ADD-EDIT",o=t.GUI.GUIElement.CreateDivElement(i,"width: 100%; height: 100%;");this._addAnimationWindow=new t.GUI.GUIWindow("AddAnimation",this.core,"Add Animation",o,new e.Vector2(800,600)),this._addAnimationWindow.modal=!0,this._addAnimationWindow.showClose=!0,this._addAnimationWindow.showMax=!1,this._addAnimationWindow.buttons=["Apply","Cancel"],this._addAnimationWindow.buildElement(null),this._addAnimationWindow.setOnCloseCallback(function(){n._addAnimationWindow.destroy(),n._addAnimationGraph.destroy(),n._addAnimationLayout.destroy()});var s=t.GUI.GUIElement.CreateElement("div",r),l=t.GUI.GUIElement.CreateElement("div",a);this._addAnimationLayout=new t.GUI.GUILayout(i,this.core),this._addAnimationLayout.createPanel(s,"left",380,!1).setContent(s),this._addAnimationLayout.createPanel(l,"main",380,!1).setContent(l),this._addAnimationLayout.buildElement(i),this._addAnimationForm=new t.GUI.GUIEditForm(a,this.core),this._addAnimationForm.buildElement(a),this._addAnimationForm.add(this,"_addAnimationName").name("Name"),this._addAnimationType=e.Animation.ANIMATIONLOOPMODE_CYCLE,this._addAnimationForm.add(this,"_addAnimationTypeName",["Cycle","Relative","Constant"],"Loop Mode").onFinishChange(function(t){switch(t){case"Relative":n._addAnimationType=e.Animation.ANIMATIONLOOPMODE_RELATIVE;break;case"Cycle":n._addAnimationType=e.Animation.ANIMATIONLOOPMODE_CYCLE;break;case"Constant":n._addAnimationType=e.Animation.ANIMATIONLOOPMODE_CONSTANT}}),this._addAnimationGraph=new t.GUI.GUIGraph(r,this.core),this._addAnimationGraph.buildElement(r);var c=["Vector4","Vector3","Vector2","Color4","Color3","Number","number","Boolean","boolean"],d=["Material","ParticleSystem"],h=function(i,r){for(var a in i){var o=i[a];if(null!==o&&void 0!==o){var s=t.Tools.GetConstructorName(o),l=!0;"_"!==a[0]&&c.indexOf(s)!==-1||(l=!1);for(var u=0;u<d.length;u++)o instanceof e[d[u]]&&(l=!0);if(l){var p="icon-edit";s.indexOf("Vector")!==-1?p="icon-position":s.indexOf("Color")!==-1?p="icon-effects":o instanceof e.Material?p="icon-shaders":o instanceof e.ParticleSystem&&(p="icon-particles");var m=n._addAnimationGraph.createNode(t.SceneFactory.GenerateUUID(),a,p,o);n._addAnimationGraph.addNodes(m,r),h(o,m.id)}}}};h(this.object,"")},i.prototype._getEffectiveTarget=function(e){for(var t=this.object,n=0;n<this._currentAnimation.targetPropertyPath.length-(e?1:0);n++)t=t[this._currentAnimation.targetPropertyPath[n]];return e&&(t[this._currentAnimation.targetPropertyPath[this._currentAnimation.targetPropertyPath.length-1]]=e),t},i.prototype._getFrameTime=function(t){if(0===t)return"0mins 0secs";var n=this._currentAnimation.framePerSecond,i=t/n,r=e.Tools.Format(Math.floor(i/60),0),a=e.Tools.Format(i%60,1);return""+r+"mins "+a+"secs"},i.prototype._setRecords=function(e,t){this._valuesForm.setRecord("frame",e.toString()),this._valuesForm.setRecord("value",this._getFrameValue()),this._valuesForm.refresh()},i.prototype._setFrameValue=function(){var n=this._valuesForm.getRecord("frame"),i=this._valuesForm.getRecord("value"),r=!1,a=parseFloat(n);if(this._currentKey.frame!==a&&(r=!0),this._currentKey.frame=a,"number"==typeof this._currentKey.value||"boolean"==typeof this._currentKey.value)this._currentKey.value=parseFloat(i);else{var o=t.Tools.GetConstructorName(this._currentKey.value);if(e[o]&&e[o].FromArray){var s=i.split(","),l=[];for(var c in s)l.push(parseFloat(s[c]));this._currentKey.value=e[o].FromArray(l)}}return e.Tags.HasTags(this._currentAnimation)||e.Tags.EnableFor(this._currentAnimation),e.Tags.MatchesQuery(this._currentAnimation,"modified")||e.Tags.AddTagsTo(this._currentAnimation,"modified"),r},i.prototype._getFrameValue=function(){if(null===this._currentKey)return"";var e=this._currentKey.value;if("number"==typeof e||"boolean"==typeof e)return Number(e).toString();if(e.asArray){var t=e.asArray();return t.toString()}return""},i.prototype._configureGraph=function(){for(var t,n=this._currentAnimation.getKeys(),i=0,r=function(e){for(var t,r=0;r<n.length;r++)t=n[r].value,e&&(t=t[e]),t=Math.abs(t),t>i&&(i=t)},a=this._graphPaper.canvas.getBoundingClientRect().width,o=this._graphPaper.canvas.getBoundingClientRect().height,s=o/2,l=n[n.length-1].frame,c=["r","g","b"],d=["x","y","z"],h=1,u=0;u<this._graphLines.length;u++)this._graphLines[u].attr("path","");switch(this._currentAnimation.dataType){case e.Animation.ANIMATIONTYPE_VECTOR2:h=2,r("x"),r("y"),t=d;break;case e.Animation.ANIMATIONTYPE_VECTOR3:h=3,r("x"),r("y"),r("z"),t=d;break;case e.Animation.ANIMATIONTYPE_COLOR3:h=3,r("r"),r("g"),r("b"),t=c;break;default:r()}
this._graphValueTexts[0].attr("y",10),this._graphValueTexts[0].attr("text",Math.floor(i)),this._graphValueTexts[1].attr("y",s),this._graphValueTexts[1].attr("text",0),this._graphValueTexts[2].attr("y",2*s-10),this._graphValueTexts[2].attr("text",-Math.floor(i)),this._graphMiddleLine.attr("path",["M",0,s,"L",this._graphPaper.canvas.getBoundingClientRect().width,s]);for(var p=0;p<10;p++){var m=l/10*a/l*(p+1);this._graphTimeLines[p].attr("path",["M",m,0,"L",m,2*s]),this._graphTimeTexts[p].attr("text",Math.floor(m*l/a)),this._graphTimeTexts[p].attr("y",o-10),this._graphTimeTexts[p].attr("x",m-2*this._graphTimeTexts[p].attr("width"))}for(var u=0;u<h;u++){for(var _=[],p=0;p<n.length;p++){var f=n[p].value;h>1&&(f=f[t[u]]);var v=n[p].frame,m=v*a/l,g=s;0!==f&&0!==i&&(g+=f*s/(i*(f>0?1:-1))*(f>0?-1:1)),isNaN(m)&&(m=0),isNaN(g)&&(g=0),_.push(0===p?"M":"L"),_.push(m),_.push(g)}this._graphLines[u].attr("path",_)}},i.prototype._onSelectedAnimation=function(){var e=this._animationsList.getSelectedRows()[0],t=this.object.animations[e],n=t.getKeys();this._currentAnimation=t,this._currentKey=null,this._keysList.clear();for(var i=0;i<n.length;i++)this._keysList.addRecord({key:n[i].frame.toString(),value:this._getFrameTime(n[i].frame),recid:i});this._keysList.refresh(),this.core.editor.timeline.setFramesOfAnimation(t),this._configureGraph()},i.prototype._onAddAnimation=function(){if(this._editedAnimation){var n=this._animationsList.getSelectedRows();n.length>0&&this._animationsList.modifyRow(n[0],{name:this._addAnimationName})}var r=this._addAnimationGraph.getSelectedNode();if(r){var a="",o=r.data;for(o="number"==typeof o||"boolean"==typeof o?o:o.clone();r.parent&&r.text;)a=r.text+(""===a?"":"."+a),r=r.parent;var s=t.Tools.GetConstructorName(o),l=-1;switch(s.toLowerCase()){case"number":case"boolean":l=e.Animation.ANIMATIONTYPE_FLOAT;break;case"vector3":l=e.Animation.ANIMATIONTYPE_VECTOR3;break;case"color3":case"color4":l=e.Animation.ANIMATIONTYPE_COLOR3;break;case"vector2":l=e.Animation.ANIMATIONTYPE_VECTOR2;break;default:return}var c=new e.Animation(this._addAnimationName,a,i.FramesPerSecond,l,this._addAnimationType);if(this._editedAnimation){c.setKeys(this._editedAnimation.getKeys());var n=this._animationsList.getSelectedRows();n.length>0&&(this.object.animations[n[0]]=c)}else c.setKeys([{frame:0,value:o},{frame:1,value:o}]),this.object.animations.push(c),this._animationsList.addRow({name:this._addAnimationName});e.Tags.HasTags(c)&&e.Tags.MatchesQuery(c,"modified")||e.Tags.AddTagsTo(c,"modified"),this.core.editor.timeline.reset(),this._addAnimationWindow.close()}},i.prototype._onModifyKey=function(){if(this._currentKey){var e=this._setFrameValue(),t=this._keysList.getSelectedRows()[0];if(this._keysList.modifyRow(t,{key:this._currentKey.frame,value:this._getFrameTime(this._currentKey.frame)}),this.core.editor.timeline.reset(),e){this._currentAnimation.getKeys().sort(function(e,t){return e.frame-t.frame});var n=this._currentKey;this._onSelectedAnimation(),this._currentKey=n}else this._configureGraph();this._keysList.setSelected([t])}},i.prototype._onAnimationMenuSelected=function(t){if(t===n.COPY){i._CopiedAnimations=[];for(var r=this._animationsList.getSelectedRows(),a=0;a<r.length;a++)i._CopiedAnimations.push(this.object.animations[r[a]])}else if(t===n.PASTE)for(var a=0;a<i._CopiedAnimations.length;a++){for(var o=i._CopiedAnimations[a],s=o.getKeys(),l=new e.Animation(o.name,o.targetPropertyPath.join("."),o.framePerSecond,o.dataType,o.loopMode),c=[],d=0;d<s.length;d++)c.push({frame:s[d].frame,value:s[d].value});l.setKeys(c),this.object.animations.push(l),e.Tags.AddTagsTo(l,"modified"),this._animationsList.addRow({name:o.name})}else if(t===n.PASTE_KEYS){var r=this._animationsList.getSelectedRows();if(1===i._CopiedAnimations.length&&1===r.length)for(var l=this.object.animations[r[0]],o=i._CopiedAnimations[0],c=o.getKeys(),h=l.getKeys().length,a=0;a<c.length;a++)l.getKeys().push({frame:c[a].frame,value:c[a].value}),this._keysList.addRow({key:String(c[a].frame),value:this._getFrameTime(c[a].frame),recid:h}),h++}},i.prototype._onDeleteAnimations=function(){for(var e=this._animationsList.getSelectedRows(),t=0,n=0;n<e.length;n++)this.object.animations.splice(e[n]-t,1),t++;this._keysList.clear(),this.core.currentScene.stopAnimation(this.object)},i.prototype._onKeySelected=function(){var e=this._keysList.getSelectedRows()[0],t=this._currentAnimation.getKeys()[e];this._currentKey=t,this._setRecords(t.frame,t.value);this._getEffectiveTarget(this._currentKey.value)},i.prototype._onAddKey=function(){var e=this._currentAnimation.getKeys(),t=e[e.length-1],n=t?t.frame+1:0,i=0,r=this._getEffectiveTarget();i="number"!=typeof r&&"boolean"!=typeof r?r.clone():r,e.push({frame:n,value:i}),this._keysList.addRow({key:String(n),value:this._getFrameTime(n),recid:e.length-1}),this._onSelectedAnimation()},i.prototype._onRemoveKeys=function(){for(var e=this._keysList.getSelectedRows(),t=this._currentAnimation.getKeys(),n=0,i=0;i<e.length;i++){var r=this._keysList.getRow(e[i+1]);r&&r.recid--,t.splice(e[i]-n,1),n++}this._onSelectedAnimation()},i.prototype._createUI=function(){var e=this;this.core.editor.editPanel.setPanelSize(40);var i="BABYLON-EDITOR-ANIMATION-EDITOR-ANIMATIONS",r="BABYLON-EDITOR-ANIMATION-EDITOR-KEYS",a="BABYLON-EDITOR-ANIMATION-EDITOR-VALUES",o="BABYLON-EDITOR-ANIMATION-EDITOR-CANVAS",s=t.GUI.GUIElement.CreateDivElement(i,"width: 30%; height: 100%; float: left;"),l=t.GUI.GUIElement.CreateDivElement(r,"width: 30%; height: 100%; float: left;"),c=t.GUI.GUIElement.CreateDivElement(a,"width: 40%; height: 50%;"),d=t.GUI.GUIElement.CreateDivElement(o,"width: 40%; height: 50%; float: right;");this.core.editor.editPanel.addContainer(s,i),this.core.editor.editPanel.addContainer(l,r),this.core.editor.editPanel.addContainer(c,a),this.core.editor.editPanel.addContainer(d,o),this._animationsList=new t.GUI.GUIGrid(i,this.core),this._animationsList.header="Animations",this._animationsList.createColumn("name","name","100%"),this._animationsList.showSearch=!1,this._animationsList.showOptions=!1,this._animationsList.showDelete=!0,this._animationsList.showAdd=!0,this._animationsList.showEdit=!0,this._animationsList.addMenu(n.COPY,"Copy","icon-copy"),this._animationsList.addMenu(n.PASTE,"Paste","icon-copy"),this._animationsList.addMenu(n.PASTE_KEYS,"Paste Keys","icon-copy"),this._animationsList.buildElement(i);for(var h=0;h<this.object.animations.length;h++)this._animationsList.addRow({name:this.object.animations[h].name,recid:h});this._animationsList.onDelete=function(t){e._onDeleteAnimations()},this._animationsList.onAdd=function(){e._createAnimation()},this._animationsList.onEdit=function(){var t=e._animationsList.getSelectedRows();t.length>0&&(e._editedAnimation=e.object.animations[t[0]],e._createAnimation())},this._animationsList.onMenuClick=function(t){e._onAnimationMenuSelected(t)},this._animationsList.onClick=function(t){e._onSelectedAnimation()},this._keysList=new t.GUI.GUIGrid(r,this.core),this._keysList.header="Keys",this._keysList.createColumn("key","key","20%"),this._keysList.createColumn("value","value","80%"),this._keysList.showSearch=!1,this._keysList.showOptions=!1,this._keysList.showDelete=!0,this._keysList.showAdd=!0,this._keysList.buildElement(r),this._keysList.onAdd=function(){e._onAddKey()},this._keysList.onDelete=function(t){e._onRemoveKeys()},this._keysList.onClick=function(t){e._onKeySelected()},this._valuesForm=new t.GUI.GUIForm(a,"Value",this.core),this._valuesForm.header="",this._valuesForm.createField("frame","float","Frame :",3),this._valuesForm.createField("value","text","Value :",3),this._valuesForm.buildElement(a),this._valuesForm.onFormChanged=function(){e._onModifyKey()},this._graphPaper=Raphael(o,"100%","100%");var u=this._graphPaper.rect(0,0,0,0);u.attr("width","100%"),u.attr("height","100%"),u.attr("fill","#f5f6f7");for(var h=0;h<3;h++){var p=this._graphPaper.path("");this._graphLines.push(p)}this._graphLines[0].attr("stroke",Raphael.rgb(255,0,0)),this._graphLines[1].attr("stroke",Raphael.rgb(0,255,0)),this._graphLines[2].attr("stroke",Raphael.rgb(0,0,255));for(var h=0;h<3;h++){var m=this._graphPaper.text(5,0,"");m.attr("font-size",11),m.attr("text-anchor","start"),this._graphValueTexts.push(m)}this._graphMiddleLine=this._graphPaper.path(""),this._graphMiddleLine.attr("stroke",Raphael.rgb(128,128,128));for(var h=0;h<10;h++){var p=this._graphPaper.path("");p.attr("stroke",Raphael.rgb(200,200,200)),this._graphTimeLines.push(p);var m=this._graphPaper.text(0,0,"");this._graphTimeTexts.push(m)}this.core.editor.editPanel.onClose=function(){e._animationsList.destroy(),e._keysList.destroy(),e._valuesForm.destroy(),e._graphPaper.clear(),e.core.removeEventReceiver(e)}},i.GetEndFrameOfObject=function(e){var t=0;if(!e.animations)return t;for(var n=0;n<e.animations.length;n++)for(var i=e.animations[n],r=i.getKeys(),a=0;a<r.length;a++)r[a].frame>t&&(t=r[a].frame);return t},i.GetSceneFrameCount=function(e){var t=0,n=function(e){for(var n=0;n<e.length;n++)if(e[n].animations)for(var i=0;i<e[n].animations.length;i++)for(var r=e[n].animations[i],a=r.getKeys(),o=0;o<a.length;o++)a[o].frame>t&&(t=a[o].frame)};n([e]),n(e.meshes),n(e.lights),n(e.cameras),n(e.particleSystems);for(var i=0;i<e.skeletons.length;i++)n(e.skeletons[i].bones);return t},i.SetCurrentFrame=function(e,t,n){for(var i=0;i<t.length;i++)e.currentScene.stopAnimation(t[i]),e.currentScene.beginAnimation(t[i],n,n+1,!1,1)},i.FramesPerSecond=24,i._CopiedAnimations=[],i}();t.GUIAnimationEditor=i}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(e){this._window=null,this._layout=null,this._editor=null,this._configForm=null,this._core=e,this._core.eventReceivers.push(this)}return n.prototype.onEvent=function(e){if(e.eventType!==t.EventType.GUI_EVENT)return!1;if(e.guiEvent.eventType===t.GUIEventType.WINDOW_BUTTON_CLICKED&&e.guiEvent.caller===this._window){var i=e.guiEvent.data;if("Generate"===i){var r=n.GenerateFinalBabylonFile(this._core),a=this._core.currentScene.getCameraByName(this._configForm.getRecord("activeCamera"));r.activeCameraID=a?a.id:void 0,this._editor.setValue(JSON.stringify(r,null,"\t"),-1)}else"Close"===i&&this._window.close();return!0}return e.guiEvent.eventType===t.GUIEventType.LAYOUT_CHANGED&&this._editor.resize(!0),!1},n.prototype.createUI=function(){var e=this,n="BABYLON-EXPORTER-CODE-EDITOR",i=t.GUI.GUIElement.CreateElement("div",n),r="BABYLON-EXPORTER-CONFIG",a=t.GUI.GUIElement.CreateElement("div",r),o="BABYLON-EXPORTER-LAYOUT",s=t.GUI.GUIElement.CreateElement("div",o);this._window=new t.GUI.GUIWindow("BABYLON-EXPORTER-WINDOW",this._core,"Export to .babylon",s),this._window.modal=!0,this._window.showMax=!0,this._window.buttons=["Generate","Close"],this._window.setOnCloseCallback(function(){e._core.removeEventReceiver(e),e._layout.destroy(),e._configForm.destroy()}),this._window.buildElement(null),this._window.onToggle=function(t,n,i){t||(n=e._window.size.x,i=e._window.size.y),e._layout.setPanelSize("left",n/2),e._layout.setPanelSize("main",n/2)},this._layout=new t.GUI.GUILayout(o,this._core),this._layout.createPanel("CODE-PANEL","left",380,!1).setContent(i),this._layout.createPanel("CONFIG-PANEL","main",380,!1).setContent(a),this._layout.buildElement(o),this._editor=ace.edit(n),this._editor.setValue('Click on "Generate" to generate the .babylon file\naccording to the following configuration',-1),this._editor.setTheme("ace/theme/clouds"),this._editor.getSession().setMode("ace/mode/javascript");for(var l=[],c=0;c<this._core.currentScene.cameras.length;c++){var d=this._core.currentScene.cameras[c];d!==this._core.camera&&l.push(d.name)}this._configForm=new t.GUI.GUIForm(r,"Configuration",this._core),this._configForm.createField("activeCamera","list","Active Camera :",5,"",{items:l}),this._configForm.buildElement(r),this._core.playCamera&&this._configForm.setRecord("activeCamera",this._core.playCamera.name)},n.GenerateFinalBabylonFile=function(n){n.isPlaying||t.SceneManager.SwitchActionManager();var i=e.SceneSerializer.Serialize(n.currentScene);n.isPlaying||t.SceneManager.SwitchActionManager(),n.playCamera&&(i.activeCameraID=n.playCamera.id);for(var r=0;r<i.cameras.length;r++)i.cameras[r].name===n.camera.name&&(i.cameras.splice(r,1),r--);var a=t.GUIAnimationEditor.GetSceneFrameCount(n.currentScene),o=function(e){for(var n=0;n<e.length;n++)for(var i=e[n].name,r=0;r<t.SceneFactory.NodesToStart.length;r++)!t.SceneFactory.NodesToStart[r].name!==i&&(e[n].autoAnimate=!0,e[n].autoAnimateFrom=0,e[n].autoAnimateTo=a,e[n].autoAnimateLoop=!1,e[n].autoAnimateSpeed=t.SceneFactory.AnimationSpeed)};t.SceneFactory.NodesToStart.some(function(t,n,i){return t instanceof e.Scene})&&(i.autoAnimate=!0,i.autoAnimateFrom=0,i.autoAnimateTo=a,i.autoAnimateLoop=!1,i.autoAnimateSpeed=t.SceneFactory.AnimationSpeed);for(var r=0;r<i.sounds.length;r++){var s=i.sounds[r];s.url&&(s.url=s.url.replace("file:","")),t.SceneFactory.NodesToStart.some(function(t,n,i){return t instanceof e.Sound&&t.name==s.name})&&(s.autoplay=!0)}return o(i.cameras),o(i.lights),o(i.meshes),o(i.particleSystems),i},n}();t.BabylonExporter=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function t(t){this.core=t;var n=new e.ObjectPicker(t);n.objectLists.push([t.currentScene]),n.objectLists.push(t.currentScene.lights),n.objectLists.push(t.currentScene.cameras),n.objectLists.push(t.currentScene.meshes),n.objectLists.push(t.currentScene.particleSystems),n.objectLists.push(t.currentScene.soundTracks[0].soundCollection),n.selectedObjects=e.SceneFactory.NodesToStart,n.minSelectCount=0,n.includePostProcesses=!0,n.open(),n.onObjectPicked=function(n){e.SceneFactory.NodesToStart=[];for(var i=0;i<n.length;i++){var r=t.currentScene.getNodeByName(n[i]);r||"Scene"!==n[i]||(r=t.currentScene),r||(r=e.Tools.GetParticleSystemByName(t.currentScene,n[i])),r||(r=t.currentScene.getSoundByName(n[i])),!r&&e.SceneFactory.StandardPipeline&&n[i]===e.SceneFactory.StandardPipeline._name&&(r=e.SceneFactory.StandardPipeline),r&&e.SceneFactory.NodesToStart.push(r)}t.editor.timeline.reset()}}return t}();e.LaunchEditor=t}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function t(e){this.core=null,this.objectLists=new Array,this.selectedObjects=new Array,this.minSelectCount=1,this.windowName="Select Object...",this.selectButtonName="Select",this.closeButtonName="Close",this.includePostProcesses=!1,this._window=null,this._list=null,this.core=e,this.core.eventReceivers.push(this)}return t.prototype.onEvent=function(t){if(t.eventType!==e.EventType.GUI_EVENT)return!1;if(t.guiEvent.eventType!==e.GUIEventType.WINDOW_BUTTON_CLICKED)return!1;if(t.guiEvent.caller===this._window){var n=t.guiEvent.data;if(n===this.closeButtonName)this.onClosedPicker&&this.onClosedPicker(),this._window.close();else if(n===this.selectButtonName){var i=this._list.getSelectedRows();if(i.length<this.minSelectCount)this._window.notify("Please select at least 1 object...");else{if(this.onObjectPicked){for(var r=[],a=0;a<i.length;a++)r.push(this._list.getRow(i[a]).name);this.onObjectPicked(r)}this._window.close()}}return!0}return!1},t.prototype.open=function(){var t=this,n="OBJECT-PICKER-LIST",i=e.GUI.GUIElement.CreateElement("div",n);this._window=new e.GUI.GUIWindow("OBJECT-PICKER-WINDOW",this.core,this.windowName,i),this._window.modal=!0,this._window.showMax=!1,this._window.buttons=[this.selectButtonName,this.closeButtonName],this._window.setOnCloseCallback(function(){t.core.removeEventReceiver(t),t._list.destroy()}),this._window.buildElement(null),this._list=new e.GUI.GUIGrid(n,this.core),this._list.header="Objects",this._list.createColumn("name","name","100%"),this._list.buildElement(n);for(var r=[],a=0,o=0;o<this.objectLists.length;o++)for(var s=this.objectLists[o],l=0;l<s.length;l++)s[l]!==this.core.camera&&(this._list.addRecord({name:s[l].name||"Scene",recid:a}),this.selectedObjects.indexOf(s[l])!==-1&&r.push(a),a++);this.includePostProcesses&&e.SceneFactory.StandardPipeline&&this._list.addRecord({name:e.SceneFactory.StandardPipeline._name,recid:a++}),this._list.refresh(),r.length>0&&this._list.setSelected(r)},t}();e.ObjectPicker=t}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(t,i,r){var a=this;void 0===r&&(r=!0),this.core=null,this._window=null,this._layouts=null,this._leftPanel=null,this._layoutID="BABYLON-EDITOR-CREATE-PARTICLE-SYSTEM",this._formTabID=this._layoutID+"TAB-UPDATE-FORM",this._editorTabID=this._layoutID+"TAB-UPDATE-EDITOR",this._editElement=null,this._editElementID=this._layoutID+"FORM",this._inputElementID=this._layoutID+"INPUT",this._editor=null,this._editorElementID=this._layoutID+"EDITOR",this._engine=null,this._scene=null,this._camera=null,this._particleSystem=null,this._particleSystemToEdit=null,this._particleSystemCapacity="",this.core=t,this._uiCreated=r,r?(this._createUI(),this._engine=new e.Engine(document.getElementById(this._layoutID+"CANVAS")),this._scene=new e.Scene(this._engine),this._camera=new e.ArcRotateCamera("Camera",1,1.3,30,new e.Vector3(0,0,0),this._scene),this._camera.attachControl(this._engine.getRenderingCanvas(),!1),this._engine.runRenderLoop(function(){a._scene.render()}),this._particleSystem=n.CreateParticleSystem(this._scene,i.getCapacity(),i),this._particleSystemToEdit=i,t.eventReceivers.push(this),this._createEditor()):(this._particleSystem=i,this._scene=i._scene)}return n.prototype.onEvent=function(e){if(e.eventType!==t.EventType.GUI_EVENT)return!1;if(e.guiEvent.eventType===t.GUIEventType.WINDOW_BUTTON_CLICKED&&e.guiEvent.caller===this._window){var n=e.guiEvent.data;return"Apply"===n?(this._setParticleSystem(),this._window.close(),t.Event.sendSceneEvent(this._particleSystemToEdit,t.SceneEventType.OBJECT_PICKED,this.core)):"Cancel"===n&&this._window.close(),!0}if(e.guiEvent.eventType===t.GUIEventType.TAB_CHANGED){this._layouts.getPanelFromType("left");if(e.guiEvent.caller!==this._leftPanel)return!1;var i=e.guiEvent.data,r=$("#"+this._layoutID+"FORM").hide(),a=$("#"+this._layoutID+"EDITOR").hide();if(i===this._formTabID)r.show();else if(i===this._editorTabID){a.show();this.core.editor.exporter;this._editor.setValue("var "+new t.Exporter(this.core)._exportParticleSystem(this._particleSystemToEdit).replace("\t",""),-1)}return!0}return!1},n.prototype._createUI=function(){var n=this,i=t.GUI.GUIElement.CreateDivElement(this._layoutID,"width: 100%; height: 100%;");this._window=new t.GUI.GUIWindow("EditParticleSystem",this.core,"Edit Particle System",i,new e.Vector2(800,600)),this._window.modal=!0,this._window.showMax=!0,this._window.showClose=!0,this._window.buttons=["Apply","Cancel"],this._window.buildElement(null),this._window.onToggle=function(e,t,i){e||(t=n._window.size.x,i=n._window.size.y),n._layouts.setPanelSize("left",t/2),n._layouts.setPanelSize("main",t/2)},this._window.on({type:"open"},function(){n._window.maximize()}),this._window.setOnCloseCallback(function(){n._window.destroy(),n._layouts.destroy(),n.core.removeEventReceiver(n)});var r=t.GUI.GUIElement.CreateDivElement(this._editElementID)+t.GUI.GUIElement.CreateElement("div",this._editorElementID)+t.GUI.GUIElement.CreateElement('input type="file"',this._inputElementID,"display: none;"),a=t.GUI.GUIElement.CreateElement("canvas",this._layoutID+"CANVAS");this._layouts=new t.GUI.GUILayout(this._layoutID,this.core),this._leftPanel=this._layouts.createPanel(r,"left",380,!0).setContent(r),this._layouts.createPanel(a,"main",380,!0).setContent(a),this._layouts.buildElement(this._layoutID);var o=this._layouts.getPanelFromType("left");this._layoutID+"TAB-EDIT";o.createTab({id:this._formTabID,caption:"Edit"}),o.createTab({id:this._editorTabID,caption:"Generated Code"}),this._layouts.on({type:"resize"},function(){n._engine.resize(),n._editElement.width=o.width-30,n._editor.resize()}),this._editor=ace.edit(this._editorElementID),this._editor.setValue(["var callback = function (particles) {","\t","};"].join("\n"),-1),this._editor.setTheme("ace/theme/clouds"),this._editor.getSession().setMode("ace/mode/javascript"),this._editor.getSession().on("change",function(e){}),$(this._editor.container).hide()},n.prototype._createEditor=function(i){var r=this,a=i?i:this._layoutID+"FORM";this._editElement=new t.GUI.GUIEditForm(a,this.core),this._editElement.buildElement(a);var o=this._particleSystem;this._editElement.remember(o);var s=this._editElement.addFolder("Functions");this._uiCreated||s.add(this,"_editParticleSystem").name("Edit..."),s.add(this,"_startParticleSystem").name("Start Particle System"),s.add(this,"_stopParticleSystem").name("Stop Particle System");var l=this._editElement.addFolder("Common");l.add(o,"name").name("Name").onChange(function(e){r._uiCreated||r._updateGraphNode(e)}),this._particleSystemCapacity=""+this._particleSystem.getCapacity(),l.add(this,"_particleSystemCapacity").name("Capacity").onFinishChange(function(e){e=parseFloat(e);var t=r._particleSystem.emitter,i=r._uiCreated?r._scene:r.core.currentScene;r._particleSystem.emitter=null;var a=n.CreateParticleSystem(i,e,r._particleSystem,t);r._particleSystem.dispose(),r._particleSystem=a,r._uiCreated?(r._editElement.remove(),r._createEditor()):r._updateGraphNode(r._particleSystem.name,r._particleSystem)}),l.add(this,"_setParticleTexture").name("Choose Texture..."),l.add(o,"blendMode",["ONEONE","STANDARD"]).name("Blend Mode: ").onFinishChange(function(t){switch(t){case"ONEONE":o.blendMode=e.ParticleSystem.BLENDMODE_ONEONE;break;case"STANDARD":o.blendMode=e.ParticleSystem.BLENDMODE_STANDARD}});var c=this._editElement.addFolder("Emitter"),d=c.addFolder("Min Emitter");d.open(),d.add(o.minEmitBox,"x").step(.01),d.add(o.minEmitBox,"y").step(.01),d.add(o.minEmitBox,"z").step(.01);var d=c.addFolder("Max Emitter");d.open(),d.add(o.maxEmitBox,"x").step(.01),d.add(o.maxEmitBox,"y").step(.01),d.add(o.maxEmitBox,"z").step(.01);var h=this._editElement.addFolder("Emission");h.add(o,"minSize").name("Min Size").min(0).step(.01),h.add(o,"maxSize").name("Max Size").min(0).step(.01),h.add(o,"minLifeTime").name("Min Life Time").min(0).step(.01),h.add(o,"maxLifeTime").name("Max Life Time").min(0).step(.01),h.add(o,"emitRate").name("Emit Rate").min(0).step(1),h.add(o,"minEmitPower").name("Min Emit Power").min(0).step(.01),h.add(o,"maxEmitPower").name("Max Emit Power").min(0).step(.01),h.add(o,"updateSpeed").name("Update Speed").min(0).step(.001),h.add(o,"minAngularSpeed").name("Min Angular Speed").min(0).max(2*Math.PI).step(.01),h.add(o,"maxAngularSpeed").name("Max Angular Speed").min(0).max(2*Math.PI).step(.01);var u=this._editElement.addFolder("Gravity and directions"),p=u.addFolder("Gravity");p.open(),p.add(o.gravity,"x").step(.01),p.add(o.gravity,"y").step(.01),p.add(o.gravity,"z").step(.01);var m=u.addFolder("Direction 1");m.add(o.direction1,"x").step(.01),m.add(o.direction1,"y").step(.01),m.add(o.direction1,"z").step(.01);var _=u.addFolder("Direction 2");_.add(o.direction2,"x").step(.01),_.add(o.direction2,"y").step(.01),_.add(o.direction2,"z").step(.01);var f=this._editElement.addFolder("Colors"),v=f.addFolder("Color 1");v.add(o.color1,"r").step(.01).min(0).max(1),v.add(o.color1,"g").step(.01).min(0).max(1),v.add(o.color1,"b").step(.01).min(0).max(1);var g=f.addFolder("Color 2");g.add(o.color2,"r").step(.01).min(0).max(1),g.add(o.color2,"g").step(.01).min(0).max(1),g.add(o.color2,"b").step(.01).min(0).max(1);var T=f.addFolder("Color Dead");return T.add(o.colorDead,"r").step(.01).min(0).max(1),T.add(o.colorDead,"g").step(.01).min(0).max(1),T.add(o.colorDead,"b").step(.01).min(0).max(1),this._editElement},n.prototype._setParticleSystem=function(){var t=["id"];if(this._particleSystem.getCapacity()!==this._particleSystemToEdit.getCapacity()){var i=this._particleSystemToEdit.emitter;this._particleSystemToEdit.emitter=null;var r=n.CreateParticleSystem(this.core.currentScene,this._particleSystem.getCapacity(),this._particleSystem,i);return this._particleSystemToEdit.dispose(),this._particleSystemToEdit=r,void this._updateGraphNode(this._particleSystem.name,this._particleSystemToEdit)}for(var a in this._particleSystem)if("_"!==a[0]&&t.indexOf(a)===-1){var o=this._particleSystem[a];"number"!=typeof o&&"string"!=typeof o&&"boolean"!=typeof o||(this._particleSystemToEdit[a]=o),(o instanceof e.Vector3||o instanceof e.Color4)&&(this._particleSystemToEdit[a]=o),o instanceof e.Texture&&(this._particleSystemToEdit[a]=e.Texture.CreateFromBase64String(o._buffer,o.name,this.core.currentScene))}this._updateGraphNode(this._particleSystem.name)},n.prototype._editParticleSystem=function(){new n(this.core,this._particleSystem)},n.prototype._startParticleSystem=function(){this._particleSystem.start()},n.prototype._stopParticleSystem=function(){this._particleSystem.stop()},n.prototype._updateGraphNode=function(e,t){var n=this.core.editor.sceneGraphTool.sidebar,i=n.getSelectedNode();i&&(i.text=e,t&&(i.data=t),n.refresh())},n.prototype._setParticleTexture=function(){var n=this,i=$("#"+this._inputElementID);i[0]||$("#BABYLON-EDITOR-UTILS").append(t.GUI.GUIElement.CreateElement('input type="file"',this._inputElementID,"display: none;")),i=$("#"+this._inputElementID),i.change(function(r){var a=r.target.files||r.currentTarget.files;if(!(a.length<1)){var o=a[0];e.Tools.ReadFileAsDataURL(o,function(r){var a=e.Texture.CreateFromBase64String(r,o.name,n._scene);a.name=a.name.replace("data:",""),n._particleSystem.particleTexture=a,i.remove(),t.Event.sendSceneEvent(a,t.SceneEventType.OBJECT_ADDED,n.core)},null)}}),i.click()},n.PlayStopAllParticleSystems=function(e,t){for(var n=0;n<e.particleSystems.length;n++)t?e.particleSystems[n].start():e.particleSystems[n].stop()},n.CreateParticleSystem=function(n,i,r,a){r=r||{};var o=null;a?o=a:(o=new e.Mesh("New Particle System",n,null,null,(!0)),e.Tags.EnableFor(o),e.Tags.AddTagsTo(o,"added_particlesystem"));var s=new e.ParticleSystem("New Particle System",i,n);if(r.animations)for(var l=0;l<r.animations.length;l++)s.animations.push(r.animations[l].clone());s.name=r.name||s.name,s.id=t.SceneFactory.GenerateUUID(),s.emitter=o,s.minEmitBox=r.minEmitBox||new e.Vector3((-1),0,0),s.maxEmitBox=r.maxEmitBox||new e.Vector3(1,0,0),s.color1=r.color1||new e.Color3(.7,.8,1),s.color2=r.color2||new e.Color3(.2,.5,1),s.colorDead=r.colorDead||new e.Color3(0,0,.2),s.minSize=r.minSize||.1,s.maxSize=r.maxSize||.5,s.minLifeTime=r.minLifeTime||.3,s.maxLifeTime=r.maxLifeTime||1.5,s.emitRate=r.emitRate||1500,s.blendMode=r.blendMode||e.ParticleSystem.BLENDMODE_ONEONE;r.particleTexture?r.particleTexture._buffer:null;return r.particleTexture?s.particleTexture=r.particleTexture:t.Tools.LoadAndCreateBase64Texture("website/textures/flare.png",n,function(e){return s.particleTexture=e}),s.gravity=r.gravity||new e.Vector3(0,(-9.81),0),s.direction1=r.direction1||new e.Vector3((-7),8,3),s.direction2=r.direction2||new e.Vector3(7,8,(-3)),s.minAngularSpeed=r.minAngularSpeed||0,s.maxAngularSpeed=r.maxAngularSpeed||Math.PI,s.minEmitPower=r.minEmitPower||1,s.maxEmitPower=r.maxEmitPower||3,s.updateSpeed=r.updateSpeed||.005,s.start(),o.attachedParticleSystem=s,s},n._CurrentParticleSystem=null,n._CopiedParticleSystem=null,n}();t.GUIParticleSystemEditor=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(t,n,i,r){this._targetTexture=null,this._selectedTexture=null,this._currentRenderTarget=null,this._currentPixels=null,this._dynamicTexture=null,this._texturesList=null,this._engine=null,this._scene=null,this._core=t,this._core.eventReceivers.push(this),this._core.editor.editPanel.close(),this.object=i,this.propertyPath=r,this._objectName=n,i&&r&&(this._targetObject=i[r],this._targetObject&&this._targetObject instanceof e.BaseTexture||(this._targetObject=null)),this._createUI()}return n.prototype.onEvent=function(n){if(n.eventType===t.EventType.SCENE_EVENT){var i=n.sceneEvent.eventType;i===t.SceneEventType.OBJECT_ADDED||i===t.SceneEventType.OBJECT_REMOVED||i===t.SceneEventType.NEW_SCENE_CREATED?this._fillTextureList():i===t.SceneEventType.OBJECT_CHANGED&&n.sceneEvent.object===this._selectedTexture&&this._selectedTexture instanceof e.DynamicTexture&&this._targetTexture.update(!0)}else n.eventType===t.EventType.GUI_EVENT&&n.guiEvent.eventType===t.GUIEventType.LAYOUT_CHANGED&&this._engine.resize();return!1},n.prototype._createUI=function(){var n=this;this._core.editor.editPanel.setPanelSize(40);var i="BABYLON-EDITOR-TEXTURES-EDITOR-TEXTURES",r="BABYLON-EDITOR-TEXTURES-EDITOR-CANVAS",a=t.GUI.GUIElement.CreateDivElement(i,"width: 50%; height: 100%; float: left;"),o=t.GUI.GUIElement.CreateElement("canvas",r,"width: 50%; height: 100%; float: right;");this._core.editor.editPanel.addContainer(a,i),this._core.editor.editPanel.addContainer(o,r),this._engine=new e.Engine($("#"+r)[0],(!0)),this._scene=new e.Scene(this._engine),this._scene.clearColor=new e.Color3(0,0,0);var s=new e.ArcRotateCamera("TextureEditorCamera",0,0,10,e.Vector3.Zero(),this._scene);s.attachControl(this._engine.getRenderingCanvas());var l=new e.StandardMaterial("TextureEditorSphereMaterial",this._scene);l.diffuseColor=new e.Color3(1,1,1),l.disableLighting=!0;var c=(new e.HemisphericLight("TextureEditorHemisphericLight",e.Vector3.Zero(),this._scene),e.Mesh.CreateSphere("TextureEditorSphere",32,5,this._scene));c.setEnabled(!1),c.material=l;var d=new e.PassPostProcess("PostProcessTextureEditor",1,s);if(d.onApply=function(e){n._targetTexture&&e.setTexture("textureSampler",n._targetTexture)},this._engine.runRenderLoop(function(){n._scene.render()}),this._texturesList=new t.GUI.GUIGrid(i,this._core),this._texturesList.header=this._objectName?this._objectName:"Textures ",this._texturesList.createColumn("name","name","100px"),this._texturesList.createColumn("width","width","80px"),this._texturesList.createColumn("height","height","80px"),this._texturesList.showSearch=!0,this._texturesList.showOptions=!0,this._texturesList.showAdd=!0,this._texturesList.hasSubGrid=!0,this._texturesList.buildElement(i),this._fillTextureList(),this._texturesList.onClick=function(i){if(0!==i.length){n._currentRenderTarget&&n._restorRenderTarget();var r=n._core.currentScene.textures[i[0]];if(t.Event.sendSceneEvent(r,t.SceneEventType.OBJECT_PICKED,n._core),n._targetTexture&&(n._targetTexture.dispose(),n._targetTexture=null),r.isRenderTarget&&!r.isCube)n._currentRenderTarget=r,n._configureRenderTarget();else{var a=r.serialize();if(r instanceof e.DynamicTexture){n._targetTexture=new e.DynamicTexture(r.name,{width:r.getBaseSize().width,height:r.getBaseSize().height},n._scene,r.noMipmap);var o=n._targetTexture._canvas;o.remove(),n._targetTexture._context=r._context,n._targetTexture._canvas=r._canvas,n._targetTexture.update(!0)}else{if(r._buffer)a.base64String=r._buffer;else{var h=e.FilesInput.FilesTextures[r.name.toLowerCase()];h&&(a.name=r.url),a.url=a.url||a.name,"file:"!==a.url.substring(0,5)&&(a.name="file:"+a.name),h||a.name.indexOf(".hdr")===-1||(n._targetTexture=new e.HDRCubeTexture(a.name,n._scene,a.isBABYLONPreprocessed?null:a.size),n._targetTexture.coordinatesMode=e.Texture.SKYBOX_MODE)}n._targetTexture||(n._targetTexture=e.Texture.Parse(a,n._scene,""))}}n.object&&(n.object[n.propertyPath]=r),r&&(n._selectedTexture=r,s.detachPostProcess(d),r.isCube&&!r.isRenderTarget?(c.setEnabled(!0),l.reflectionTexture=n._targetTexture):(c.setEnabled(!1),s.attachPostProcess(d)))}},this.object&&this.object[this.propertyPath]){var h=this._core.currentScene.textures.indexOf(this.object[this.propertyPath]);h!==-1&&(this._texturesList.setSelected([h]),this._texturesList.onClick([h]),this._texturesList.scrollIntoView(h))}this._texturesList.onAdd=function(){var i=$("#BABYLON-EDITOR-LOAD-TEXTURE-FILE");i[0].onchange=function(i){for(var r=0;r<i.target.files.length;r++){var a=i.target.files[r].name,o=a.toLowerCase();a.indexOf(".babylon.hdr")!==-1?e.Tools.ReadFile(i.target.files[r],n._onReadFileCallback(a),null,!0):a.indexOf(".hdr")!==-1?(e.FilesInput.FilesToLoad[a]=i.target.files[r],
e.HDRCubeTexture.generateBabylonHDR("file:"+a,256,n._onReadFileCallback(a),function(){t.GUI.GUIWindow.CreateAlert("An error occured when converting HDR Texture","HR Error")})):o.indexOf(".png")!==-1||o.indexOf(".jpg")!==-1?(e.FilesInput.FilesTextures[a]=i.target.files[r],e.Tools.ReadFileAsDataURL(i.target.files[r],n._onReadFileCallback(a),null)):t.GUI.GUIWindow.CreateAlert("Texture format not supported","Textre Format Error")}},i.click()},this._texturesList.onReload=function(){n._fillTextureList()},this._texturesList.onExpand=function(i,r){var a=n._core.currentScene.textures[r],o=new t.GUI.GUIGrid(i,n._core);return o.showColumnHeaders=!1,o.createColumn("name","Property","25%","background-color: #efefef; border-bottom: 1px solid white; padding-right: 5px;"),o.createColumn("value","Value","75%"),o.addRecord({name:"width",value:a.getSize().width}),o.addRecord({name:"height",value:a.getSize().height}),o.addRecord({name:"name",value:a.name}),a instanceof e.Texture&&o.addRecord({name:"url",value:a.url}),o},this._core.editor.editPanel.onClose=function(){n._texturesList.destroy(),n._scene.dispose(),n._engine.dispose(),n._core.removeEventReceiver(n)}},n.prototype._configureRenderTarget=function(){var t=this,n=this._currentRenderTarget.getSize().width,i=this._currentRenderTarget.getSize().height,r=new ImageData(n,i);this._currentOnAfterRender=this._currentRenderTarget.onAfterRender,this._dynamicTexture=new e.DynamicTexture("RenderTargetTexture",{width:n,height:i},this._scene,(!1)),this._currentRenderTarget.onAfterRender=function(e){t._currentOnAfterRender&&t._currentOnAfterRender(e),t._currentPixels=t._core.engine.readPixels(0,0,n,i);for(var a=0;a<t._currentPixels.length;a++)r.data[a]=t._currentPixels[a];t._dynamicTexture.getContext().putImageData(r,0,0),t._dynamicTexture.update(!1)},this._targetTexture=this._dynamicTexture},n.prototype._restorRenderTarget=function(){this._currentRenderTarget.onAfterRender=this._currentOnAfterRender,this._dynamicTexture.dispose(),this._dynamicTexture=null,this._currentPixels=null,this._currentRenderTarget=null},n.prototype._fillTextureList=function(){this._texturesList.clear();for(var e=0;e<this._core.currentScene.textures.length;e++){var t=this._core.currentScene.textures[e],n={name:t.name,width:t.getBaseSize()?t.getBaseSize().width:0,height:t.getBaseSize()?t.getBaseSize().height:0,recid:e};t.isCube?n.style="background-color: #FBFEC0":t.isRenderTarget&&(n.style="background-color: #C2F5B4"),this._texturesList.addRecord(n)}this._texturesList.refresh()},n.prototype._addTextureToList=function(e){this._texturesList.addRow({name:e.name,width:e.getBaseSize()?e.getBaseSize().width:0,height:e.getBaseSize()?e.getBaseSize().height:0,recid:this._texturesList.getRowCount()-1}),this._core.editor.editionTool.updateEditionTool()},n.prototype._onReadFileCallback=function(n){var i=this;return function(r){var a=null;if(n.indexOf(".hdr")!==-1){var o=new Blob([r],{type:"application/octet-stream"}),s=window.URL.createObjectURL(o);try{a=new e.HDRCubeTexture(s,i._core.currentScene),a.name=n,e.FilesInput.FilesToLoad[n]=t.Tools.CreateFile(new Uint8Array(r),n)}catch(l){t.GUI.GUIWindow.CreateAlert("Cannot load HDR texture...","HDR Texture Error")}}else a=e.Texture.CreateFromBase64String(r,n,i._core.currentScene,!1,!1,e.Texture.BILINEAR_SAMPLINGMODE),a.name=a.url=a.name.replace("data:","");i._addTextureToList(a)}},n}();t.GUITextureEditor=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(n,i,r){var a=this,o="BABYLON-EDITOR-ACTIONS-BUILDER-IFRAME",s=t.GUI.GUIElement.CreateElement('iframe sandbox="allow-same-origin allow-scripts"',o,"width: 100%; height: 100%"),l=i instanceof e.Node?i.name:"Scene";this._window=new t.GUI.GUIWindow("BABYLON-ACTIONS-BUILDER-WINDOW",n,"Actions Builder - "+l,s),this._window.modal=!0,this._window.showMax=!0,this._window.buttons=["Apply","Cancel"],this._window.setOnCloseCallback(function(){}),this._window.buildElement(null),this._window.lock();var c=$("#"+o);c.attr("src","libs/actionsBuilder/index.html");var d=c[0].contentWindow;c[0].onload=function(){a._getNames(n.currentScene.meshes,d.setMeshesNames),a._getNames(n.currentScene.lights,d.setLightsNames),a._getNames(n.currentScene.cameras,d.setCamerasNames),a._getNames(n.currentScene.mainSoundTrack.soundCollection,d.setSoundsNames);var t=[];i instanceof e.AbstractMesh&&i.material&&t.push(""),0===t.length&&t.push("None"),d.configureParameters(t),i instanceof e.Scene?d.setIsScene():d.setIsObject(),d.resetList();var o=d.document;o.getElementById("ActionsBuilderObjectName").value=l,o.getElementById("ActionsBuilderJSON").value=JSON.stringify(r.serialize(l)),d.getList().setColorTheme("rgb(147, 148, 148)"),d.getViewer().setColorTheme("-ms-linear-gradient(top, rgba(73, 74, 74, 1) 0%, rgba(125, 126, 125, 1) 100%)"),d.getViewer().setColorTheme("linear-gradient(top, rgba(73, 74, 74, 1) 0%, rgba(125, 126, 125, 1) 100%)"),d.getViewer().setColorTheme("-webkit-linear-gradient(top, rgba(73, 74, 74, 1) 0%, rgba(125, 126, 125, 1) 100%)"),d.getViewer().setColorTheme("-o-linear-gradient(top, rgba(73, 74, 74, 1) 0%, rgba(125, 126, 125, 1) 100%)"),o.getElementById("ParametersElementID").style.backgroundColor="rgb(147, 148, 148)",o.getElementById("ParametersHelpElementID").style.backgroundColor="rgb(64, 65, 65)",o.getElementById("ToolbarElementID").style.backgroundColor="rgb(64, 65, 65)",d.updateObjectName(),d.loadFromJSON(),a._window.unlock()},this._window.onButtonClicked=function(r){if("Cancel"===r)a._window.close();else if("Apply"===r){d.createJSON();var o=d.document,s=o.getElementById("ActionsBuilderJSON").value,l=i.actionManager;e.ActionManager.Parse(JSON.parse(s),i instanceof e.Scene?null:i,n.currentScene),e.Tags.EnableFor(i.actionManager),e.Tags.AddTagsTo(i.actionManager,"added"),n.isPlaying||(i instanceof e.Scene?t.SceneManager._SceneConfiguration.actionManager=i.actionManager:t.SceneManager._ConfiguredObjectsIDs[i.id].actionManager=i.actionManager,i.actionManager=l),a._window.close()}}}return n.prototype._getNames=function(e,t){for(var n=0;n<e.length;n++)t(e[n].name)},n}();t.GUIActionsBuilder=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(){}return e.RegisterEditionTool=function(e){this.EditionToolPlugins.push(e)},e.RegisterMainToolbarPlugin=function(e){this.MainToolbarPlugins.push(e)},e.RegisterCustomUpdatePlugin=function(e){this.CustomUpdatePlugins.push(e)},e.EditionToolPlugins=[],e.MainToolbarPlugins=[],e.CustomUpdatePlugins=[],e}();e.PluginManager=t}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(t){function n(n){t.call(this,n,"SIMPLE-MATERIAL","SIMPLE","Simple"),this.onObjectSupported=function(t){return t instanceof e.SimpleMaterial}}return __extends(n,t),n.prototype.update=function(){if(!t.prototype.update.call(this))return!1;this._element.add(this.material,"name").name("Name");var e=this._element.addFolder("Diffuse");return this.addColorFolder(this.material.diffuseColor,"Diffuse Color",!0,e),this.addTextureButton("Diffuse Texture","diffuseTexture",e).open(),!0},n}(t.AbstractMaterialTool);t.SimpleMaterialTool=n,t.PluginManager.RegisterEditionTool(n)}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function t(e){this.menuID="GEOMETRIES-MENU",this._createCubeID="CREATE-CUBE",this._createSphereID="CREATE-SPHERE",this._createGroundID="CREATE-GROUND",this._createPlane="CREATE-PLANE";var t=e.toolbar;this._core=e.core;var n=t.createMenu("menu",this.menuID,"Geometry","icon-bounding-box");t.createMenuItem(n,"button",this._createCubeID,"Add Cube","icon-box-mesh"),t.createMenuItem(n,"button",this._createSphereID,"Add Sphere","icon-sphere-mesh"),t.addBreak(n),t.createMenuItem(n,"button",this._createGroundID,"Add Ground","icon-mesh"),t.createMenuItem(n,"button",this._createPlane,"Add Plane","icon-mesh")}return t.prototype.onMenuItemSelected=function(t){switch(t){case this._createCubeID:e.SceneFactory.AddBoxMesh(this._core);break;case this._createSphereID:e.SceneFactory.AddSphereMesh(this._core);break;case this._createGroundID:e.SceneFactory.AddGroundMesh(this._core);break;case this._createPlane:e.SceneFactory.AddPlaneMesh(this._core)}},t}();e.GeometriesMenuPlugin=t,e.PluginManager.RegisterMainToolbarPlugin(t)}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(e){this.menuID="LIGHTS-MENU",this._addPointLight="ADD-POINT-LIGHT",this._addDirectionalLight="ADD-DIRECTIONAL-LIGHT",this._addSpotLight="ADD-SPOT-LIGHT",this._addHemisphericLight="ADD-HEMISPHERIC-LIGHT";var t=e.toolbar;this._core=e.core;var n=t.createMenu("menu",this.menuID,"Lights","icon-light");t.createMenuItem(n,"button",this._addPointLight,"Add Point Light","icon-light"),t.createMenuItem(n,"button",this._addDirectionalLight,"Add Directional Light","icon-directional-light"),t.createMenuItem(n,"button",this._addSpotLight,"Add Spot Light","icon-directional-light"),t.createMenuItem(n,"button",this._addHemisphericLight,"Add Hemispheric Light","icon-light")}return n.prototype.onMenuItemSelected=function(e){switch(e){case this._addPointLight:t.SceneFactory.AddPointLight(this._core);break;case this._addDirectionalLight:t.SceneFactory.AddDirectionalLight(this._core);break;case this._addSpotLight:t.SceneFactory.AddSpotLight(this._core);break;case this._addHemisphericLight:t.SceneFactory.AddHemisphericLight(this._core)}},n.prototype._configureSound=function(t){e.Tags.EnableFor(t),e.Tags.AddTagsTo(t,"added")},n}();t.LightsMenuPlugin=n,t.PluginManager.RegisterMainToolbarPlugin(n)}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(e){this.menuID="SOUNDS-MENU",this._addSoundtrack="ADD-SOUNDTRACK",this._add3DSound="ADD-3D-SOUND",this._stopAllSounds="STOP-ALL-SOUNDS",this._playAllSounds="PLAY-ALL-SOUNDS";var t=e.toolbar;this._core=e.core;var n=t.createMenu("menu",this.menuID,"Sound","icon-sound");t.createMenuItem(n,"button",this._addSoundtrack,"Add Soundtracks","icon-sound"),t.createMenuItem(n,"button",this._add3DSound,"Add 3D Sound","icon-sound"),t.addBreak(n),t.createMenuItem(n,"button",this._stopAllSounds,"Stop All Sounds","icon-play-game"),t.createMenuItem(n,"button",this._playAllSounds,"Play All Sounds","icon-error")}return n.prototype.onMenuItemSelected=function(n){var i=this;switch(n){case this._addSoundtrack:case this._add3DSound:this._createInput(function(r,a){var o={autoplay:!1,spatialSound:n===i._add3DSound},s=new e.Sound(r,a,i._core.currentScene,null,o);t.Event.sendSceneEvent(s,t.SceneEventType.OBJECT_ADDED,i._core),i._configureSound(s)});break;case this._stopAllSounds:this._stopPlayAllSounds(!1);break;case this._playAllSounds:this._stopPlayAllSounds(!0)}},n.prototype._stopPlayAllSounds=function(e){for(var t=this._core.currentScene.mainSoundTrack,n=0;n<t.soundCollection.length;n++){var i=t.soundCollection[n];e&&!i.isPlaying?i.play():i.stop()}},n.prototype._configureSound=function(t){e.Tags.EnableFor(t),e.Tags.AddTagsTo(t,"added")},n.prototype._createInput=function(n){var i=this,r=t.Tools.CreateFileInpuElement("BABYLON-EDITOR-LOAD-SOUND-FILE");r[0].onchange=function(t){for(var a=0;a<t.target.files.length;a++){var o=t.target.files[a];switch(o.type){case"audio/wav":case"audio/x-wav":case"audio/mp3":case"audio/mpeg":case"audio/mpeg3":case"audio/x-mpeg-3":case"audio/ogg":e.Tools.ReadFile(o,i._onReadFileCallback(o.name,n),null,!0),e.FilesInput.FilesToLoad[name.toLowerCase()]=o}}r.remove()},r.click()},n.prototype._onReadFileCallback=function(e,t){return function(n){t(e,n)}},n}();t.SoundsMenuPlugin=n,t.PluginManager.RegisterMainToolbarPlugin(n)}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function t(e){this.menuID="TOOLS-PLUGIN-MENU",this._openActionsBuilder="OPEN-ACTIONS-BUILDER",this._openPostProcessBuilder="OPEN-POST-PROCESS-BUILDER",this._openSoftBodyBuilder="OPEN-SOFT-BODY-BUILDER",this._openCosmos="OPEN-COSMOS";var t=e.toolbar;this._core=e.core;var n=t.createMenu("menu",this.menuID,"Tools","icon-scenario");t.createMenuItem(n,"button",this._openActionsBuilder,"Open Actions Builder","icon-graph"),t.addBreak(n),t.createMenuItem(n,"button",this._openPostProcessBuilder,"Open Post-Process Builder","icon-render"),t.addBreak(n),t.createMenuItem(n,"button",this._openSoftBodyBuilder,"Open Soft Body Builder","icon-mesh")}return t.prototype.onMenuItemSelected=function(t){switch(t){case this._openActionsBuilder:e.ActionsBuilder.GetInstance(this._core);break;case this._openPostProcessBuilder:new e.PostProcessBuilder(this._core);break;case this._openSoftBodyBuilder:new e.SoftBodyBuilder(this._core);break;case this._openCosmos:new e.CosmosEditor(this._core)}},t}();e.ToolsMenu=t,e.PluginManager.RegisterMainToolbarPlugin(t)}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){!function(e){e[e.TRIGGER=0]="TRIGGER",e[e.ACTION=1]="ACTION",e[e.CONTROL=2]="CONTROL"}(t.EACTION_TYPE||(t.EACTION_TYPE={}));var n=t.EACTION_TYPE,i=function(){function i(e){this._babylonModule=null,this._actionsClasses=null,this._controlsClasses=null,this._containerElement=null,this._containerID=null,this._tab=null,this._layouts=null,this._triggersList=null,this._actionsList=null,this._controlsList=null,this._graph=null,this._currentSelected=null,this._parametersEditor=null,this._currentNode=null,this._core=e,e.eventReceivers.push(this),this._createUI(),i._Classes?(this._babylonModule=this._getModule("BABYLON"),this._configureUI()):this._loadDefinitionsFile()}return i.GetInstance=function(e){return i._ActionsBuilderInstance||(i._ActionsBuilderInstance=new i(e)),i._ActionsBuilderInstance},i.prototype.onEvent=function(n){if(n.eventType===t.EventType.GUI_EVENT&&n.guiEvent.eventType===t.GUIEventType.DOCUMENT_UNCLICK){var i=n.guiEvent.data,r=$(i.target);return r.parent()&&r.parent().parent()&&(r.parent().parent()[0]!==this._graph.canvasElement[0]?this._currentSelected=null:this._graph.setMousePosition(i.offsetX,i.offsetY)),this._containerElement.css("cursor","default"),!1}if(n.eventType===t.EventType.SCENE_EVENT&&n.sceneEvent.eventType===t.SceneEventType.OBJECT_PICKED){var a=n.sceneEvent.object;(a instanceof e.AbstractMesh||a instanceof e.Scene)&&(this._object=n.sceneEvent.object,this._onObjectSelected())}return!1},i.prototype.dispose=function(){this._core.removeEventReceiver(this),this._triggersList.destroy(),this._actionsList.destroy(),this._controlsList.destroy(),this._layouts.destroy(),i._ActionsBuilderInstance=null},i.prototype.serializeGraph=function(t,n){t||(t={name:this._object instanceof e.Scene?"Scene":this._object.name,type:this._object instanceof e.Scene?3:4,properties:[],children:[],comment:""});for(var i=n?this._graph.getNodesWithParent(n):this._graph.getRootNodes(),r=0;r<i.length;r++){for(var a=this._graph.getNodeData(i[r]).data,o={name:a.name,type:a.type,properties:[],children:[],comment:a.comment},s=0;s<a.properties.length;s++){var l=a.properties[s],c={name:l.name,value:l.value,targetType:l.targetType};"target"===l.name&&"Scene"===l.value&&(c.targetType="SceneProperties"),o.properties.push(c)}this.serializeGraph(o,i[r]),t.children.push(o)}return t},i.prototype.deserializeGraph=function(e,t){for(var i=0;i<e.children.length;i++){var r=e.children[i];if(r.type!==n.TRIGGER||0!==r.children.length){var a={name:r.name,type:r.type,properties:r.properties,children:[],comment:r.comment},o={"class":this._getNodeParametersClass(a.type,a.name),data:a},s=this._graph.addNode(r.name,r.name,this._getNodeColor(r.type),this._getNodeTypeString(r.type),t,o);this.deserializeGraph(r,s)}}},i.prototype._createUI=function(){var e=this;this._containerID=this._core.editor.createContainer(),this._tab=this._core.editor.createTab("Actions Builder",this._containerID,this,!0),this._containerElement=$("#"+this._containerID),this._layouts=new t.GUI.GUILayout(this._containerID,this._core),this._layouts.createPanel("SCENARIO-MAKER-MODULES","left",200,!0).setContent('<div id="ACTIONS-BUILDER-TRIGGERS" style="width: 100%; height: 33.33%;"></div><div id="ACTIONS-BUILDER-ACTIONS" style="width: 100%; height: 33.33%;"></div><div id="ACTIONS-BUILDER-CONTROLS" style="width: 100%; height: 33.33%;"></div>');var n=this._layouts.createPanel("ACTIONS-BUILDER-MAIN-PANEL","main",void 0,void 0).setContent('<div id="ACTIONS-BUILDER-CANVAS" style="height: 100%; width: 100%; position: absolute;"></div>');n.style="overflow: hidden;",this._layouts.createPanel("ACTIONS-BUILDER-RIGHT-PANEL","right",300,!0).setContent(t.GUI.GUIElement.CreateElement("div","ACTIONS-BUILDER-EDIT")),this._layouts.buildElement(this._containerID),this._triggersList=new t.GUI.GUIGrid("ACTIONS-BUILDER-TRIGGERS",this._core),this._triggersList.showAdd=this._triggersList.showEdit=this._triggersList.showOptions=this._triggersList.showRefresh=!1,this._triggersList.header="Triggers",this._triggersList.fixedBody=!0,this._triggersList.createColumn("name","name","100%"),this._triggersList.onMouseDown=function(){return e._onListElementClicked(e._triggersList)},this._triggersList.buildElement("ACTIONS-BUILDER-TRIGGERS"),this._actionsList=new t.GUI.GUIGrid("ACTIONS-BUILDER-ACTIONS",this._core),this._actionsList.showAdd=this._actionsList.showEdit=this._actionsList.showOptions=this._actionsList.showRefresh=!1,this._actionsList.header="Actions",this._actionsList.fixedBody=!0,this._actionsList.multiSelect=!1,this._actionsList.createColumn("name","name","100%"),this._actionsList.onMouseDown=function(){return e._onListElementClicked(e._actionsList)},this._actionsList.buildElement("ACTIONS-BUILDER-ACTIONS"),this._controlsList=new t.GUI.GUIGrid("ACTIONS-BUILDER-CONTROLS",this._core),this._controlsList.showAdd=this._controlsList.showEdit=this._controlsList.showOptions=this._controlsList.showRefresh=!1,this._controlsList.header="Controls",this._controlsList.fixedBody=!0,this._controlsList.multiSelect=!1,this._controlsList.createColumn("name","name","100%"),this._controlsList.onMouseDown=function(){return e._onListElementClicked(e._controlsList)},this._controlsList.buildElement("ACTIONS-BUILDER-CONTROLS"),this._graph=new t.ActionsBuilderGraph(this._core),this._graph.onMouseUp=function(){return e._onMouseUpOnGraph()},this._parametersEditor=new t.ActionsBuilderParametersEditor(this._core,"ACTIONS-BUILDER-EDIT"),this._parametersEditor.onSave=function(){return e._onSave()},this._parametersEditor.onRemove=function(){return e._onRemoveNode(!1)},this._parametersEditor.onRemoveAll=function(){return e._onRemoveNode(!0)}},i.prototype._configureUI=function(){for(var t=e.ActionManager.NothingTrigger;t<=e.ActionManager.OnKeyUpTrigger;t++)this._triggersList.addRecord({recid:t,name:e.ActionManager.GetTriggerName(t),style:"background-color: rgb(133, 154, 185)"});this._triggersList.refresh(),this._actionsClasses=this._getClasses(this._babylonModule,"BABYLON.Action");for(var t=0;t<this._actionsClasses.length;t++)this._actionsList.addRecord({recid:t,name:this._actionsClasses[t].name,style:"background-color: rgb(182, 185, 132)"});this._actionsList.refresh(),this._controlsClasses=this._getClasses(this._babylonModule,"BABYLON.Condition");for(var t=0;t<this._controlsClasses.length;t++)this._controlsList.addRecord({recid:t,name:this._controlsClasses[t].name,style:"background-color: rgb(185, 132, 140)"});this._controlsList.refresh(),this._graph.createGraph("ACTIONS-BUILDER-CANVAS")},i.prototype._onRemoveNode=function(e){this._currentNode&&this._graph.removeNode(this._currentNode,e)},i.prototype._onObjectSelected=function(){if(i._Classes){var n=null;this._graph.clear();var r=t.SceneManager.GetCustomMetadata("ActionsBuilder")||{},a=r[this._object instanceof e.Scene?"Scene":this._object.name];if(a)this.deserializeGraph(a,"");else{if(n=this._object instanceof e.Scene?this._core.isPlaying?this._object.actionManager:t.SceneManager._SceneConfiguration.actionManager:this._core.isPlaying?this._object.actionManager:t.SceneManager._ConfiguredObjectsIDs[this._object.id].actionManager,!n)return;this.deserializeGraph(n.serialize(this._object instanceof e.Scene?"Scene":this._object.name),"")}this._graph.layout()}},i.prototype._onSave=function(){var n=this;if(this._object){var i=this.serializeGraph(),r=t.SceneManager.GetCustomMetadata("ActionsBuilder")||{};r[this._object instanceof e.Scene?"Scene":this._object.name]=i,t.SceneManager.AddCustomMetadata("ActionsBuilder",r);var a=null;this._core.isPlaying||(a=this._object.actionManager),e.ActionManager.Parse(i,this._object,this._core.currentScene),this._core.isPlaying||(this._object instanceof e.AbstractMesh?t.SceneManager._ConfiguredObjectsIDs[this._object.id].actionManager=this._object.actionManager:t.SceneManager._SceneConfiguration.actionManager=this._object.actionManager,this._object.actionManager=a)}else{var o=t.SceneFactory.GenerateUUID(),s=new t.GUI.GUIWindow("SELECT-OBJECT-WINDOW",this._core,"Select object",t.GUI.GUIElement.CreateElement("input",o,"width: 100%;"),new e.Vector2(400,150),["Select","Close"]);s.setOnCloseCallback(function(){s.destroy()}),s.buildElement(null);var l=[];this._parametersEditor.populateStringArray(l,["Scene"]),this._parametersEditor.populateStringArray(l,this._core.currentScene.meshes,"name");var c=new t.GUI.GUIList(o,this._core);c.renderDrop=!0,c.items=l,c.buildElement(o),s.onButtonClicked=function(e){if("Select"===e){var t=c.getValue();"Scene"===t?n._object=n._core.currentScene:n._object=n._core.currentScene.getMeshByName(t)}s.close(),n._onSave()}}this._graph.layout()},i.prototype._onListElementClicked=function(e){var t=e.getSelectedRows();this._containerElement.css("cursor","copy"),t.length&&(this._currentSelected={id:e.getRow(t[0]).name,list:e})},i.prototype._getNodeParametersClass=function(e,t){return e===n.ACTION?this._getClass(this._actionsClasses,t):e===n.CONTROL?this._getClass(this._controlsClasses,t):null},i.prototype._getNodeColor=function(e){var t="rgb(133, 154, 185)";return e===n.ACTION?"rgb(182, 185, 132)":e===n.CONTROL?"rgb(185, 132, 140)":t},i.prototype._getNodeTypeString=function(e){var t="trigger";return e===n.ACTION?"action":e===n.CONTROL?"control":t},i.prototype._onMouseUpOnGraph=function(){if(this._containerElement.css("cursor","default"),this._currentSelected){var e="rgb(133, 154, 185)",t="trigger",i={"class":null,data:{name:this._currentSelected.id,properties:[],type:0}};this._currentSelected.list===this._triggersList?this._configureActionsBuilderData(i,n.TRIGGER):this._currentSelected.list===this._actionsList?(e="rgb(182, 185, 132)",t="action",i["class"]=this._getClass(this._actionsClasses,this._currentSelected.id),this._configureActionsBuilderData(i,n.ACTION)):this._currentSelected.list===this._controlsList&&(e="rgb(185, 132, 140)",t="control",i["class"]=this._getClass(this._controlsClasses,this._currentSelected.id),this._configureActionsBuilderData(i,n.CONTROL));var r=this._graph.getTargetNodeType();if("trigger"===t&&null!==r||"trigger"!==t&&null===r)return void(this._currentSelected=null);var a=this._graph.getTargetNodeId();if(a){var o=this._graph.getNodeData(a),s=this._graph.getNodesWithParent(a);if(s.length>0&&o.data.type!==n.TRIGGER)return void(this._currentSelected=null)}this._graph.addNode(this._currentSelected.id,this._currentSelected.id,e,t,null,i),this._currentSelected=null}else{var l=this._graph.getTargetNodeId();if(!l)return;var i=this._graph.getNodeData(l);this._parametersEditor.drawProperties(i),this._currentNode=l}},i.prototype._configureActionsBuilderData=function(e,t){if(e.data.type=t,e["class"])for(var n=e["class"].constructors[0],i=["number","string","boolean","any","Vector3","Vector2","Sound","ParticleSystem"],r=0;r<n.parameters.length;r++){var a=n.parameters[r],o={name:a.name,value:null,targetType:null};"triggerOptions"!==a.name&&"condition"!==a.name&&i.indexOf(a.type)!==-1&&("target"===a.name&&(o.targetType=null,o.value="Scene"),e.data.properties.push(o))}else{var s=e.data.name;"OnKeyDownTrigger"===s||"OnKeyUpTrigger"===s?e.data.properties.push({name:"parameter",value:"a",targetType:null}):"OnIntersectionEnterTrigger"!==s&&"OnIntersectionExitTrigger"!==s||e.data.properties.push({name:"target",value:null,targetType:"MeshProperties"})}},i.prototype._loadDefinitionsFile=function(){var t=this;this._layouts.lockPanel("main","Loading...",!0),e.Tools.LoadFile("website/resources/classes.min.json",function(e){i._Classes=JSON.parse(e),t._babylonModule=t._getModule("BABYLON"),t._configureUI(),t._layouts.unlockPanel("main")})},i.prototype._getModule=function(e){for(var t=0;t<i._Classes.length;t++){var n=i._Classes[t];if(n&&n.name===e)return n}return null},i.prototype._getClasses=function(e,t){for(var n=[],r=0;r<e.classes.length;r++){var a=e.classes[r];i._ExcludedClasses.indexOf(a.name)===-1&&(!t||a.heritageClauses&&a.heritageClauses.some(function(e){return e===t}))&&n.push(a)}return n},i.prototype._getClass=function(e,t){for(var n=0;n<e.length;n++)if(e[n].name===t)return e[n];return null},i._ActionsBuilderInstance=null,i._Classes=null,i._ExcludedClasses=["PredicateCondition","ExecuteCodeAction","CombineAction"],i}();t.ActionsBuilder=i}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function t(e){this.canvasElement=null,this.onMouseUp=function(){},this._mousex=0,this._mousey=0,this._core=e}return t.prototype.createGraph=function(e){var t=this;this.canvasElement=$("#"+e),this._graph=cytoscape({container:this.canvasElement[0],zoomingEnabled:!1,layout:{name:"grid"}}),this.canvasElement.on("resize",function(e){return t._graph.resize()}),this.canvasElement.on("mousemove",function(e){t.setMousePosition(e.offsetX,e.offsetY)}),this.canvasElement.on("mouseup",function(e){t._graph.trigger("mouseup")}),this._graph.on("mouseup",function(e){t.onMouseUp&&t.onMouseUp()}),this._graph.layout({name:"grid"})},t.prototype.clear=function(){this._graph.remove(this._graph.nodes())},t.prototype.layout=function(){this._graph.layout({name:"breadthfirst",directed:!0,padding:0,spacingFactor:1,animate:!0})},t.prototype.setMousePosition=function(e,t){this._mousex=e,this._mousey=t},t.prototype.addNode=function(t,n,i,r,a,o){var s=this._graph.add({data:{id:t+"_"+e.SceneFactory.GenerateUUID(),name:n,type:r,actionsBuilderData:o}}),l=a&&""!==a?this._graph.nodes('[id="'+a+'"]'):""===a?null:this._getNodeAtPosition(this._mousex,this._mousey);if(l){var c=this._graph.add({data:{name:"",source:l.id(),target:s.id()}});c.css("target-arrow-shape","triangle"),c.css("curve-style","unbundled-bezier"),c.css("control-point-distances","10 -10"),c.css("control-point-weights","0.25 0.75"),c.css("label",o.data&&o.data.comment?o.data.comment.substr(0,20)+"...":"")}return s.css("shape","roundrectangle"),s.css("background-color",i),s.css("width","150px"),s.css("height","25px"),s.css("font","normal 12px"),s.css("label",n.length>16?n.substr(0,13)+"...":n),s.css("text-valign","center"),s.css("text-halign","center"),s.renderedPosition({x:this._mousex,y:l?this._mousey+l.height()+25:this._mousey}),s.id()},t.prototype.removeNode=function(e,t){void 0===t&&(t=!1);var n=this._graph.nodes('[id="'+e+'"]');if(0!==n.length){var i=this.getNodesWithParent(e);if(t)for(var r=0;r<i.length;r++)this.removeNode(i[r],t);for(var a=this._graph.edges(),r=0;r<a.length;r++){var o=a[r].data();if(o.target===e){if(a[r].remove(),0!==i.length&&!t){var s=this._graph.add({data:{name:"",source:o.source,target:i[0]}});s.css("target-arrow-shape","triangle"),s.css("curve-style","unbundled-bezier"),s.css("control-point-distances","10 -10"),s.css("control-point-weights","0.25 0.75")}break}}n.remove()}},t.prototype.getTargetNodeType=function(){var e=this._getNodeAtPosition(this._mousex,this._mousey);return e?e.data().type:null},t.prototype.getTargetNodeId=function(){var e=this._getNodeAtPosition(this._mousex,this._mousey);return e?e.id():null},t.prototype.getNodeData=function(e){var t=this._graph.nodes('[id="'+e+'"]');return t.length>0?t[0].data().actionsBuilderData:null},t.prototype.getNodesWithParent=function(e){for(var t=this._graph.edges(),n=[],i=0;i<t.length;i++)t[i].data().source===e&&n.push(t[i].data().target);return n},t.prototype.getRootNodes=function(){for(var e=this._graph.edges(),t=this._graph.nodes(),n=[],i=!1,r=0;r<t.length;r++){i=!1;for(var a=0;a<e.length;a++)if(e[a].data().target===t[r].id()){i=!0;break}i||n.push(t[r].id())}return n},t.prototype._getNodeAtPosition=function(e,t){for(var n=this._graph.nodes(),i=0;i<n.length;i++){var r=n[i],a=r.renderedPosition();if(e>=a.x-r.width()/2&&e<=a.x+r.width()/2&&t>=a.y-r.height()/2&&t<=a.y+r.height()/2)return r}return null},t}();e.ActionsBuilderGraph=t}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function t(e,t){this.onSave=function(){},this.onRemove=function(){},this.onRemoveAll=function(){},this._guiElements=[],this._currentTarget=null,this._currentProperty=null,this._editors=[],this._core=e,this._container=$("#"+t),this._currentTarget=e.currentScene,this._destroyGUIElements()}return t.prototype.drawProperties=function(t){var n=this,i=t.data;this._destroyGUIElements(),this._createHeader(i.name,t.data.type);var r=e.GUI.GUIElement.CreateButton(this._container,e.SceneFactory.GenerateUUID(),"Remove");r.css("width","100%"),r.addClass("btn-orange"),r.click(function(e){n._destroyGUIElements(),n.onRemove&&n.onRemove()}),this._container.append("<br />"),this._container.append("<hr>");var a=e.GUI.GUIElement.CreateButton(this._container,e.SceneFactory.GenerateUUID(),"Remove Branch");a.css("width","100%"),a.addClass("btn-red"),a.click(function(e){n._destroyGUIElements(),n.onRemoveAll&&n.onRemoveAll()}),this._container.append("<br />"),this._container.append("<hr>");for(var o=t["class"]?t["class"].constructors[0]:null,s=0;s<i.properties.length;s++){var l=i.properties[s],c=o?this._getParameterType(o,l.name):"string";if("target"===l.name){null===l.value&&(l.value="Scene","MeshProperties"===l.targetType?l.value=this._core.currentScene.meshes[0].name:"LightProperties"===l.targetType?l.value=this._core.currentScene.lights[0].name:"CameraProperties"===l.targetType&&(l.value=this._core.currentScene.cameras[0].name));var d=this._createListOfElements(l,this._getCollectionOfObjects(l.targetType),function(e){"Scene"===e?n._currentTarget=n._core.currentScene:n._currentTarget=n._core.currentScene.getNodeByName(e),n.drawProperties(t)})}else if("propertyPath"===l.name){var d=this._createListOfElements(l,this._createPropertyPath(this._currentTarget));null===l.value&&(l.value=d.items[0])}else if("sound"===l.name){var d=this._createListOfElements(l,this._createSoundsList());null===l.value&&(this._core.currentScene.mainSoundTrack.soundCollection.length>0?l.value=d.items[0]:l.value="")}else if("particleSystem"===l.name){var d=this._createListOfElements(l,this._createParticleSystemList());null===l.value&&(this._core.currentScene.particleSystems.length>0?l.value=d.items[0]:l.value="")}else if("operator"===l.name)var d=this._createListOfOperators(l);else if("boolean"===c)this._createCheckbox(l),null===l.value&&(l.value="false");else if("string"===c&&"data"===l.name){var h=["{",'   "stringExample": "myStringExample"',"}"].join("\n");this._createEditor(l,h),null===l.value&&(l.value=h)}else"number"!==c&&"string"!==c&&"any"!==c&&"Vector3"!==c||("true"===l.value||"false"===l.value?this._createCheckbox(l,"Set Active"):this._createField(l),null===l.value&&("number"===c?l.value="0":"Vector3"===c?l.value="0, 0, 0":l.value="new value"));this._container.append("<hr>")}var u=e.SceneFactory.GenerateUUID();this._container.append(e.GUI.GUIElement.CreateElement("textarea",u,"width: 100%; height: 150px;",t.data.comment||"your comment..."));var p=$("#"+u);p.keyup(function(e){t.data.comment=p.val()}),this._container.append("<br />"),this._container.append("<hr>")},t.prototype.populateStringArray=function(e,t,n){for(var i=0;i<t.length;i++)n?e.push(t[i][n]):e.push(t[i])},t.prototype._createField=function(t){
var n=e.GUI.GUIElement.CreateElement("p",e.SceneFactory.GenerateUUID(),"width: 100%; height: 0px;",t.name+":",!0);this._container.append(n);var i=name+e.SceneFactory.GenerateUUID(),r=e.GUI.GUIElement.CreateElement(["input",'type="text"'],i,"width: 100%;","",!0);this._container.append(r);var a=$("#"+i);return a.val(t.value),a.keyup(function(e){t.value=a.val()}),$("#"+i)},t.prototype._createCheckbox=function(t,n){var i=name+e.SceneFactory.GenerateUUID(),r=e.GUI.GUIElement.CreateElement(["input",'type="checkbox"'],i,"",n||t.name+" ",!0);this._container.append(r);var a=$("#"+i);return a[0].checked="true"===t.value,a.change(function(e){t.value=e.target.checked?"true":"false"}),$("#"+i)},t.prototype._createListOfElements=function(t,n,i){var r=e.GUI.GUIElement.CreateElement("p",e.SceneFactory.GenerateUUID(),"width: 100%; height: 0px;",t.name+":",!0);this._container.append(r);var a=t.name+e.SceneFactory.GenerateUUID(),o=e.GUI.GUIElement.CreateElement("input",a,"width: 100%;","",!0);this._container.append(o);var s=new e.GUI.GUIList(a,this._core);return s.renderDrop=!0,n?s.items=n:(s.items=[],this.populateStringArray(s.items,["Scene"]),this.populateStringArray(s.items,this._core.currentScene.meshes,"name"),this.populateStringArray(s.items,this._core.currentScene.lights,"name"),this.populateStringArray(s.items,this._core.currentScene.cameras,"name"),this.populateStringArray(s.items,this._core.currentScene.particleSystems,"name")),s.selected=t.value,s.buildElement(a),s.onChange=function(e){t.value=e,i&&i(t.value)},s},t.prototype._createEditor=function(t,n){var i=e.SceneFactory.GenerateUUID(),r=e.GUI.GUIElement.CreateElement("div",i,"width: 100%; height: 300px;","",!0);this._container.append(r);var a=ace.edit(i);return a.setTheme("ace/theme/clouds"),a.getSession().setMode("ace/mode/javascript"),a.getSession().setValue(t.value||n),a.getSession().on("change",function(e){return t.value=a.getSession().getValue()}),this._editors.push(a),a},t.prototype._createListOfOperators=function(t){var n=e.GUI.GUIElement.CreateElement("p",e.SceneFactory.GenerateUUID(),"width: 100%; height: 0px;",t.name+":",!0);this._container.append(n);var i=t.name+e.SceneFactory.GenerateUUID(),r=e.GUI.GUIElement.CreateElement("input",i,"width: 100%;","",!0);this._container.append(r);var a=["IsEqual","IsDifferent","IsGreater","IsLesser"];null===t.value&&(t.value=a[0]);var o=new e.GUI.GUIList(i,this._core);return o.renderDrop=!0,o.selected=t.value||a[0],o.items=a,o.buildElement(i),o.onChange=function(e){return t.value=e},o},t.prototype._createHeader=function(t,n){var i="";switch(n){case e.EACTION_TYPE.TRIGGER:i="rgb(133, 154, 185)";break;case e.EACTION_TYPE.ACTION:i="rgb(182, 185, 132)";break;case e.EACTION_TYPE.CONTROL:i="rgb(185, 132, 140)"}var r=e.SceneFactory.GenerateUUID(),a=e.GUI.GUIElement.CreateElement("div",r,"width: 100%; height: 30px; text-align: center; border: 1px solid grey; margin-left: auto; margin-right: auto; background: "+i,t,!0);this._container.append(a);var o=$(r,this._container),s=e.GUI.GUIElement.CreateElement("a",r,"width: 100%; height: 100%; vertical-align: middle; line-height: 25px;",t,!0);o.append(s)},t.prototype._destroyGUIElements=function(){for(var t=this,n=0;n<this._guiElements.length;n++)this._guiElements[n].destroy();for(var n=0;n<this._editors.length;n++)this._editors[n].destroy();this._container.empty(),this._guiElements=[],this._editors=[];var i=e.GUI.GUIElement.CreateButton(this._container,e.SceneFactory.GenerateUUID(),"Save");i.css("width","100%"),i.css("position","absolute"),i.css("bottom","10px"),i.addClass("btn-green"),i.click(function(e){t.onSave&&t.onSave()})},t.prototype._getParameterType=function(e,t){for(var n=0;n<e.parameters.length;n++)if(e.parameters[n].name===t)return e.parameters[n].type;return null},t.prototype._getEffectiveTarget=function(e,t){for(var n=t.split("."),i=0;i<n.length-1;i++)e=e[n[i]];return e},t.prototype._createPropertyPath=function(t,n){n||(n=[]);var i=["number","string","boolean"],r=["Vector3","Vector2","Color3","Material"],a=function(t,o){for(var s in t)if("_"!==s[0]){var l=t[s];i.indexOf(typeof l)!==-1?n.push(o+s):r.indexOf(e.Tools.GetConstructorName(l))!==-1&&a(l,o+s+".")}};return a(t,""),n},t.prototype._createSoundsList=function(){for(var e=[],t=0;t<this._core.currentScene.mainSoundTrack.soundCollection.length;t++)e.push(this._core.currentScene.mainSoundTrack.soundCollection[t].name);return e},t.prototype._createParticleSystemList=function(){for(var e=[],t=0;t<this._core.currentScene.particleSystems.length;t++)e.push(this._core.currentScene.particleSystems[t].id);return e},t.prototype._getCollectionOfObjects=function(e){var t=[];return"SceneProperties"===e?["Scene"]:("MeshProperties"===e&&this.populateStringArray(t,this._core.currentScene.meshes,"name"),"LightProperties"===e&&this.populateStringArray(t,this._core.currentScene.lights,"name"),"CameraProperties"===e&&this.populateStringArray(t,this._core.currentScene.cameras,"name"),0===t.length?null:t)},t}();e.ActionsBuilderParametersEditor=t}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(i){var r=this;this._engine=null,this._scene=null,this._camera=null,this._texture=null,this._scenePassPostProcess=null,this._containerElement=null,this._containerID=null,this._tab=null,this._layouts=null,this._mainPanel=null,this._postProcessesList=null,this._toolbar=null,this._glslTabId=null,this._configurationTabId=null,this._currentTabId=null,this._selectTemplateWindow=null,this._editor=null,this._console=null,this._currentSelected=0,this._core=i,i.eventReceivers.push(this),this._getConfigurationFile(function(){r._datas=t.SceneManager.GetCustomMetadata("PostProcessBuilder"),r._datas||(r._datas=[{name:"NewPostProcess",id:t.SceneFactory.GenerateUUID(),program:e.Effect.ShadersStore.editorTemplatePixelShader,configuration:n._ConfigurationFileContent}],t.SceneManager.AddCustomMetadata("PostProcessBuilder",r._datas)),r._createUI(),r._onPostProcessSelected([0]),r._extension=new t.EXTENSIONS.PostProcessBuilderExtension(r._scene),r._extension.placeHolderTexture=r._texture,r._mainExtension=new t.EXTENSIONS.PostProcessBuilderExtension(r._core.currentScene)})}return n.prototype.dispose=function(){for(var e=0;e<this._datas.length;e++)this._datas[e].postProcess&&(this._mainExtension.removePostProcess(this._datas[e].postProcess),this._datas[e].editorPostProcess&&this._extension.removePostProcess(this._datas[e].editorPostProcess),this._datas[e].postProcess=null,this._datas[e].editorPostProcess=null);this._core.removeEventReceiver(this),this._toolbar.destroy(),this._postProcessesList.destroy(),this._editor.destroy(),this._console.destroy(),this._layouts.destroy(),this._engine.dispose()},n.prototype.onEvent=function(e){return e.eventType===t.EventType.KEY_EVENT&&e.keyEvent.control&&"b"===e.keyEvent.key&&!e.keyEvent.isDown&&this._onApplyPostProcessChain(!1),!1},n.prototype._createUI=function(){var n=this;this._containerID=this._core.editor.createContainer(),this._tab=this._core.editor.createTab("Post-Process Builder",this._containerID,this,!0),this._containerElement=$("#"+this._containerID),this._layouts=new t.GUI.GUILayout(this._containerID,this._core),this._layouts.createPanel("POST-PROCESS-BUILDER-TOP-PANEL","top",45,!1).setContent(t.GUI.GUIElement.CreateElement("div","POST-PROCESS-BUILDER-TOOLBAR")),this._layouts.createPanel("POST-PROCESS-BUILDER-LEFT-PANEL","left",300,!1).setContent(t.GUI.GUIElement.CreateElement("div","POST-PROCESS-BUILDER-EDIT","width: 100%; height: 100%;")),this._layouts.createPanel("POST-PROCESS-BUILDER-MAIN-PANEL","main",0,!1).setContent(t.GUI.GUIElement.CreateElement("div","POST-PROCESS-BUILDER-PROGRAM")),this._layouts.createPanel("POST-PROCESS-BUILDER-PREVIEW-PANEL","preview",150,!0).setContent(t.GUI.GUIElement.CreateElement("div","POST-PROCESS-BUILDER-CONSOLE")),this._layouts.buildElement(this._containerID),this._layouts.on("resize",function(e){n._editor.resize(!0)}),this._glslTabId=this._currentTabId=t.SceneFactory.GenerateUUID(),this._configurationTabId=t.SceneFactory.GenerateUUID(),this._mainPanel=this._layouts.getPanelFromType("main"),this._mainPanel.createTab({caption:"GLSL",closable:!1,id:this._glslTabId}),this._mainPanel.createTab({caption:"Configuration",closable:!1,id:this._configurationTabId}),this._mainPanel.onTabChanged=function(e){return n._onTabChanged(e)};var i=$("#POST-PROCESS-BUILDER-EDIT");i.append(t.GUI.GUIElement.CreateElement("div","POST-PROCESS-BUILDER-EDIT-LIST","width: 100%; height: 200px;")),this._toolbar=new t.GUI.GUIToolbar("POST-PROCESS-BUILDER-TOOLBAR",this._core),this._toolbar.createMenu("button","BUILD-CHAIN","Apply Chain (CTRL + B)","icon-play-game",!1,"Builds post-processes and applies chain"),this._toolbar.addBreak(),this._toolbar.createMenu("button","BUILD-CHAIN-SCENE","Apply Chain on Scene","icon-scene",!1,"Builds post-processes and applies chain on scene"),this._toolbar.buildElement("POST-PROCESS-BUILDER-TOOLBAR"),this._toolbar.onClick=function(e){return n._onApplyPostProcessChain("BUILD-CHAIN-SCENE"===e.parent)},this._postProcessesList=new t.GUI.GUIGrid("POST-PROCESS-BUILDER-EDIT-LIST",this._core),this._postProcessesList.createEditableColumn("name","name",{type:"string"},"100%"),this._postProcessesList.multiSelect=!1,this._postProcessesList.showAdd=!0,this._postProcessesList.showDelete=!0,this._postProcessesList.showOptions=!1,this._postProcessesList.onClick=function(e){return n._onPostProcessSelected(e)},this._postProcessesList.onAdd=function(){return n._onPostProcessAdd()},this._postProcessesList.onDelete=function(e){return n._onPostProcessRemove(e)},this._postProcessesList.onEditField=function(e,t){return n._onPostProcessEditField(e,t)},this._postProcessesList.buildElement("POST-PROCESS-BUILDER-EDIT-LIST");for(var r=0;r<this._datas.length;r++)this._postProcessesList.addRecord({name:this._datas[r].name,recid:r});this._postProcessesList.refresh(),i.append("<br />"),i.append("<hr>"),i.append(t.GUI.GUIElement.CreateElement("p",t.SceneFactory.GenerateUUID(),"width: 100%;","Preview:",!1));var a=t.SceneFactory.GenerateUUID();i.append(t.GUI.GUIElement.CreateElement("canvas",a,"width: 100%; height: 300px",null,!0)),this._engine=new e.Engine($("#"+a)[0]),this._scene=new e.Scene(this._engine),this._camera=new e.Camera("PostProcessCamera",e.Vector3.Zero(),this._scene),this._texture=new e.Texture("website/Tests/textures/no_smoke.png",this._scene),this._engine.runRenderLoop(function(){return n._scene.render()}),this._editor=ace.edit("POST-PROCESS-BUILDER-PROGRAM"),this._editor.setTheme("ace/theme/clouds"),this._editor.getSession().setMode("ace/mode/glsl"),this._editor.getSession().setValue(e.Effect.ShadersStore.passPixelShader),this._editor.getSession().on("change",function(e){return n._onEditorChanged()}),this._console=ace.edit("POST-PROCESS-BUILDER-CONSOLE"),this._console.getSession().setValue("Ready."),e.Tools.Error=function(e){n._console.getSession().setValue(n._console.getSession().getValue()+"\n"+e)}},n.prototype._onTabChanged=function(e){this._currentTabId=e,e===this._glslTabId?(this._editor.getSession().setMode("ace/mode/glsl"),this._editor.getSession().setValue(this._datas[this._currentSelected].program)):(this._editor.getSession().setMode("ace/mode/javascript"),this._editor.getSession().setValue(this._datas[this._currentSelected].configuration))},n.prototype._onPostProcessSelected=function(e){e.length<1||(this._currentSelected=e[0],this._editor.getSession().setValue(this._currentTabId===this._glslTabId?this._datas[e[0]].program:this._datas[e[0]].configuration))},n.prototype._onPostProcessAdd=function(){var i=this,r=t.SceneFactory.GenerateUUID();this._selectTemplateWindow=new t.GUI.GUIWindow("SELECT-TEMPLATE-WINDOW",this._core,"Select template",t.GUI.GUIElement.CreateElement("input",r,"width: 100%;"),new e.Vector2(400,120),["Select","Close"]),this._selectTemplateWindow.setOnCloseCallback(function(){i._selectTemplateWindow.destroy()}),this._selectTemplateWindow.buildElement(null);var a=[];for(var o in e.Effect.ShadersStore)e.Effect.ShadersStore[o].indexOf("textureSampler")!==-1&&a.push(o);var s=new t.GUI.GUIList(r,this._core);s.renderDrop=!0,s.items=a,s.buildElement(r),this._selectTemplateWindow.onButtonClicked=function(r){if("Select"===r){var a=s.getValue(),o={name:a+i._datas.length,id:t.SceneFactory.GenerateUUID(),program:e.Effect.ShadersStore[a],configuration:n._ConfigurationFileContent};i._datas.push(o),i._postProcessesList.addRecord({name:o.name}),i._postProcessesList.refresh()}i._selectTemplateWindow.close()}},n.prototype._onPostProcessRemove=function(e){var t=this._datas[e[0]];t.postProcess&&this._mainExtension.removePostProcess(t.postProcess),t.editorPostProcess&&this._extension.removePostProcess(t.editorPostProcess),this._datas.splice(e[0],1),this._currentSelected=-1,this._storeMetadatas()},n.prototype._onPostProcessEditField=function(e,t){},n.prototype._onEditorChanged=function(){if(this._currentSelected>=0){var e=this._editor.getSession().getValue();this._currentTabId===this._glslTabId?this._datas[this._currentSelected].program=e:this._datas[this._currentSelected].configuration=e}},n.prototype._onApplyPostProcessChain=function(n){this._console.getSession().setValue("Ready.");for(var i=0;i<this._datas.length;i++)this._datas[i].editorPostProcess&&(this._extension.removePostProcess(this._datas[i].editorPostProcess),delete e.Effect.ShadersStore[this._datas[i].editorPostProcess.name+"PixelShader"],this._datas[i].editorPostProcess=null),this._datas[i].postProcess&&(this._mainExtension.removePostProcess(this._datas[i].postProcess),delete e.Effect.ShadersStore[this._datas[i].postProcess.name+"PixelShader"],this._datas[i].postProcess=null);for(var i=0;i<this._datas.length;i++){var r=this._datas[i];r.id=t.SceneFactory.GenerateUUID(),this._extension.applyPostProcess(r),r.editorPostProcess=r.postProcess,r.postProcess=null,n&&(r.id=t.SceneFactory.GenerateUUID(),this._mainExtension.applyPostProcess(r))}this._storeMetadatas()},n.prototype._storeMetadatas=function(){for(var e=[],n=0;n<this._datas.length;n++){var i=this._datas[n];e.push({name:i.name,id:i.id,program:i.program,configuration:i.configuration,postProcess:null,editorPostProcess:null})}t.SceneManager.AddCustomMetadata("PostProcessBuilder",e)},n.prototype._getConfigurationFile=function(t){var i=this;n._ConfigurationFileContent?t():(this._core.editor.layouts.lockPanel("preview","Loading...",!0),e.Tools.LoadFile("website/resources/template.postprocess.configuration.json",function(e){n._ConfigurationFileContent=e,i._core.editor.layouts.unlockPanel("preview"),t()}))},n._ConfigurationFileContent=null,n}();t.PostProcessBuilder=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(e){this._engine=null,this._scene=null,this._camera=null,this._light=null,this._selectedMesh=null,this._containerElement=null,this._containerID=null,this._tab=null,this._layouts=null,this._toolbar=null,this._metadatas=[],this._core=e,e.eventReceivers.push(this),this._metadatas=t.SceneManager.GetCustomMetadata("SoftBodyBuilder")||[],this._metadatas||t.SceneManager.AddCustomMetadata("SoftBodyBuilder",this._metadatas),this._createUI()}return n.prototype.dispose=function(){this._core.removeEventReceiver(this),this._toolbar.destroy(),this._layouts.destroy(),this._engine.dispose()},n.prototype.onEvent=function(n){if(n.eventType===t.EventType.SCENE_EVENT){var i=n.sceneEvent.object;return i instanceof e.GroundMesh&&this._configureMesh(i),!1}},n.prototype._previewMesh=function(){this._selectedMesh&&this._selectedMesh instanceof e.GroundMesh&&this._extension.apply([{meshName:this._selectedMesh.name}])},n.prototype._configureMesh=function(t){this._selectedMesh&&(this._selectedMesh.dispose(),this._selectedMesh=null,this._extension.apply([]));var n=e.Mesh.CreateGround("SoftBodyMesh",t._width,t._height,t.subdivisions,this._scene,!0);t.material&&(n.material=e.Material.Parse(t.material.serialize(),this._scene,"file:")),this._selectedMesh=n},n.prototype._createUI=function(){var n=this;this._containerID=this._core.editor.createContainer(),this._tab=this._core.editor.createTab("Soft Body Builder",this._containerID,this,!0),this._containerElement=$("#"+this._containerID),this._layouts=new t.GUI.GUILayout(this._containerID,this._core),this._layouts.createPanel("SOFT-BODY-BUILDER-TOP-PANEL","top",45,!1).setContent(t.GUI.GUIElement.CreateElement("div","SOFT-BODY-BUILDER-TOOLBAR")),this._layouts.createPanel("SOFT-BODY-BUILDER-MAIN-PANEL","main",0,!1).setContent(t.GUI.GUIElement.CreateElement("canvas","SOFT-BODY-BUILDER-PREVIEW")),this._layouts.buildElement(this._containerID),this._layouts.on("resize",function(e){n._engine.resize()}),this._toolbar=new t.GUI.GUIToolbar("SOFT-BODY-BUILDER-TOOLBAR",this._core),this._toolbar.createMenu("button","PREVIEW","Preview","icon-play-game",!1,"Preview the soft body simulation"),this._toolbar.addBreak(),this._toolbar.createMenu("button","APPLIED","Applied on scene","icon-scene",!1,"If the simulation will be applied on scene"),this._toolbar.addBreak(),this._toolbar.createMenu("button","DRAW-SPHERES","Draw spheres","icon-sphere-mesh",!1,"If the spheres should be drawn"),this._toolbar.buildElement("SOFT-BODY-BUILDER-TOOLBAR"),this._toolbar.onClick=function(e){switch(e.parent){case"PREVIEW":n._previewMesh();break;case"APPLIED":}},this._engine=new e.Engine($("#SOFT-BODY-BUILDER-PREVIEW")[0]),this._scene=new e.Scene(this._engine),this._camera=new e.ArcRotateCamera("SoftBodyCamera",3*Math.PI/2,Math.PI/2,20,e.Vector3.Zero(),this._scene),this._light=new e.PointLight("SoftBodyLight",new e.Vector3(15,15,15),this._scene),this._engine.runRenderLoop(function(){return n._scene.render()}),this._camera.setTarget(e.Vector3.Zero()),this._camera.attachControl(this._engine.getRenderingCanvas()),this._scene.enablePhysics(this._scene.gravity,new e.CannonJSPlugin),this._extension=new t.EXTENSIONS.SoftBodyBuilderExtension(this._scene)},n}();t.SoftBodyBuilder=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(e){this._engine=null,this._scene=null,this._camera=null,this._light=null,this._skybox=null,this._containerElement=null,this._containerID=null,this._tab=null,this._layouts=null,this._editor=null,this._extension=null,this._dummyIdSearch="",this._core=e,this._createUI()}return n.prototype.dispose=function(){this._layouts.destroy(),this._engine.dispose()},n.prototype._createUI=function(){var n=this;this._containerID=this._core.editor.createContainer(),this._tab=this._core.editor.createTab("Cosmos Editor",this._containerID,this,!0),this._containerElement=$("#"+this._containerID),this._layouts=new t.GUI.GUILayout(this._containerID,this._core),this._layouts.createPanel("COSMOS-EDITOR-LEFT-PANEL","left",300,!1).setContent(t.GUI.GUIElement.CreateElement("div","COSMOS-EDITOR-EDIT","width: 100%; height: 100%;")),this._layouts.createPanel("COSMOS-EDITOR-MAIN-PANEL","main",0,!1).setContent(t.GUI.GUIElement.CreateElement("canvas","COSMOS-EDITOR-CANVAS")),this._layouts.buildElement(this._containerID),this._layouts.on("resize",function(e){n._engine.resize()}),this._engine=new e.Engine($("#COSMOS-EDITOR-CANVAS")[0]),this._scene=new e.Scene(this._engine),this._scene.clearColor=e.Color3.Black(),this._camera=new e.FreeCamera("CosmosFreeCamera",new e.Vector3(150,150,150),this._scene),this._camera.setTarget(e.Vector3.Zero()),this._camera.attachControl(this._engine.getRenderingCanvas()),this._light=new e.PointLight("CosmosLight",e.Vector3.Zero(),this._scene),this._light.parent=this._camera,this._skybox=e.Mesh.CreateBox("skyBox",1e4,this._scene);var i=new e.StandardMaterial("skyBox",this._scene);i.backFaceCulling=!1;var r=["website/textures/space/space_left.jpg","website/textures/space/space_up.jpg","website/textures/space/space_front.jpg","website/textures/space/space_right.jpg","website/textures/space/space_down.jpg","website/textures/space/space_back.jpg"];i.reflectionTexture=e.CubeTexture.CreateFromImages(r,this._scene),i.reflectionTexture.coordinatesMode=e.Texture.SKYBOX_MODE,i.diffuseColor=new e.Color3(1,1,1),i.specularColor=new e.Color3(0,0,0),i.disableLighting=!0,this._skybox.material=i;var a=new e.StandardRenderingPipeline("StandardRenderingPipeline",this._scene,1/devicePixelRatio,null,[this._camera]);a.LensFlareEnabled=!0,a.lensFlareStrength=50,a.brightThreshold=1,a.lensTexture=a.lensFlareDirtTexture=new e.Texture("website/textures/lensdirt.jpg",this._scene),a.lensStarTexture=new e.Texture("website/textures/lensstar.png",this._scene),a.lensColorTexture=new e.Texture("website/textures/lenscolor.png",this._scene),this._engine.runRenderLoop(function(){n._scene.render(),n._extension.updateMeshes()}),this._extension=new t.EXTENSIONS.CosmosExtension(this._scene),this._editor=new t.GUI.GUIEditForm("COSMOS-EDITOR-EDIT",this._core),this._editor.buildElement("COSMOS-EDITOR-EDIT");var o=this._editor.addFolder("Root node");o.add(this._extension,"distanceToRoot").min(1).max(1e3).step(1).name("Distance to root").onChange(function(){return n._reset()}),o.add(this._extension,"heightFromRoot").min(1).max(500).step(1).name("Height from root").onChange(function(){return n._reset()});var s=this._editor.addFolder("Functions nodes");s.add(this._extension,"distanceToFunction").min(0).max(100).name("Distance to function").onChange(function(){return n._reset()}),s.add(this._extension,"functionsDistance").min(.01).max(10).step(.01).name("Functions distance").onChange(function(){return n._reset()}),s.add(this._extension,"sphereDiameter").min(0).max(100).step(.01).name("Spheres diameter").onChange(function(){return n._reset()});var l=this._editor.addFolder("Animations");l.add(this._extension,"animationsDistance").min(1).max(10).step(.01).name("Animations distance").onChange(function(){return n._reset()});var c=this._editor.addFolder("Search");c.add(this,"_dummyIdSearch").name("Search title").onChange(function(e){n._extension.animateCameraToId(""===e?"root":e)})},n.prototype._reset=function(){this._extension.reset();var e={distanceToRoot:this._extension.distanceToRoot,heightFromRoot:this._extension.heightFromRoot,functionsDistance:this._extension.functionsDistance,animationsDistance:this._extension.animationsDistance,sphereDiameter:this._extension.sphereDiameter};t.SceneManager.AddCustomMetadata("CosmosExtension",e),this._extension.apply(e)},n._ConfigurationFileContent=null,n}();t.CosmosEditor=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=function(){function n(){}return n.CreateFilesFromFileNames=function(n,i,r){for(var a=this,o=require("fs"),s=0,l=[],c=n.length,d=function(n,i){return function(d,h){if(h){var u=new File([new Blob([h])],e.Tools.GetFilename(t.Tools.NormalizeUri(n)),{type:t.Tools.GetFileType(t.Tools.GetFileExtension(n))});l.push(u);var p=t.Tools.GetFileExtension(n);"babylon"!==p&&"obj"!==p&&"stl"!==p&&"gltf"!==p||(a.SceneFilename=n,o.watch(n,null,function(s,c){a.ReloadSceneOnFileChanged&&o.readFile(n,function(a,o){var s=new File([new Blob([o])],e.Tools.GetFilename(n),{type:t.Tools.GetFileType(t.Tools.GetFileExtension(n))});l[i]=s,r(l)})})),s++,s===c&&r(l)}}},h=0;h<n.length;h++)o.readFile(n[h],d(n[h],h))},n.WatchFile=function(n,i){var r=require("fs");r.watch(n,null,function(a,o){r.readFile(n,function(r,a){var o=new File([new Blob([a])],e.Tools.GetFilename(n),{type:t.Tools.GetFileType(t.Tools.GetFileExtension(n))});i(o)})})},n.CreateSaveDialog=function(e,t,n,i){var r=require("electron").remote.dialog,a={title:e,defaultPath:t,filters:[{name:"Babylon.js Editor Project",extensions:[]}],buttonLabel:""};r.showSaveDialog(null,a,function(e){i(e)})},n.ReloadSceneOnFileChanged=!1,n.SceneFilename="",n}();t.ElectronHelper=n}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var n=require("net"),i=function(){function i(e){this._statusBarId="STATUS-BAR-PHOTOSHOP",this._server=null,this._client=null,this._texture=null,this._core=e,this._core.eventReceivers.push(this),this._core.editor.statusBar.addElement(this._statusBarId,"Ready","icon-photoshop-connect")}return i.prototype.onEvent=function(e){return!1},i.prototype.disconnect=function(){return!!this._server&&(this._server.close(function(e){console.log("Closed server..."),e&&console.log(e.message)}),this._client&&this._client.destroy(),this._server=null,this._client=null,this._core.editor.statusBar.removeElement(this._statusBarId),!0)},i.prototype.connect=function(){var r=this;this._core.editor.statusBar.showSpinner(this._statusBarId),this._core.editor.statusBar.setText(this._statusBarId,"Connecting...");var a=[];return this._server=n.createServer(function(n){r._client=n,r._client.on("data",function(e){r._core.editor.statusBar.showSpinner(r._statusBarId);var t=new global.Buffer(e);a.push(t)}),r._client.on("end",function(){r._client=null;var n=global.Buffer.concat(a);a=[];var o=(n.readUInt32BE(0),n.readUInt32BE(4)),s=n.readUInt32BE(8),l=n.readUInt32BE(12),c=e.Tools.GetExponentOfTwo(s,4096),d=e.Tools.GetExponentOfTwo(l,4096),h=n.readUInt32BE(16),u=n.toString("utf-8",20,20+h),p=i._Textures[u];if(!p||p.getBaseSize().width!==c||p.getBaseSize().height!==d){p&&p.dispose();var p=new e.DynamicTexture(u,{width:c,height:d},r._core.currentScene,(!1));t.Event.sendSceneEvent(p,t.SceneEventType.OBJECT_ADDED,r._core),i._Textures[u]=p}for(var m=p.getContext(),_=m.getImageData(0,0,s,l),f=0;f<o;f++)_.data[f]=n.readUInt8(20+h+f);m.putImageData(_,0,0),p.update(!0),t.Event.sendSceneEvent(p,t.SceneEventType.OBJECT_CHANGED,r._core),r._core.editor.statusBar.hideSpinner(r._statusBarId)})}).on("error",function(e){throw r._core.editor.statusBar.hideSpinner(r._statusBarId),e}),this._server.maxConnections=1,this._server.listen(1337,"127.0.0.1",null,function(){r._core.editor.statusBar.setText(r._statusBarId,"Listening..."),r._core.editor.statusBar.hideSpinner(r._statusBarId)}),!0},i.Connect=function(e){this._Instance||(this._Instance=new i(e)),this._Instance.connect()},i.Disconnect=function(){this._Instance&&this._Instance.disconnect(),this._Instance=null},i._Textures={},i._Instance=null,i}();t.ElectronPhotoshopPlugin=i}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function t(e){this.menuID="ELECTRON-MENU",this._connectPhotoshop="CONNECT-PHOTOSHOP",this._disconnectPhotoshop="DISCONNECT-PHOTOSHOP",this._watchSceneFile="WATCH-SCENE-FILE";var t=e.toolbar;this._core=e.core,this._toolbar=t;var n=t.createMenu("menu",this.menuID,"Electron","icon-electron");t.createMenuItem(n,"button",this._connectPhotoshop,"Connect to Photoshop...","icon-photoshop-connect"),t.createMenuItem(n,"button",this._disconnectPhotoshop,"Disconnect Photoshop...","icon-photoshop-disconnect"),t.addBreak(n),t.createMenuItem(n,"button",this._watchSceneFile,"Automatically reload scene","icon-helpers",!1)}return t.prototype.onMenuItemSelected=function(t){switch(t){case this._connectPhotoshop:e.ElectronPhotoshopPlugin.Connect(this._core);break;case this._disconnectPhotoshop:e.ElectronPhotoshopPlugin.Disconnect();break;case this._watchSceneFile:var n=!this._toolbar.isItemChecked(this._watchSceneFile,this.menuID);e.ElectronHelper.ReloadSceneOnFileChanged=n,this._toolbar.setItemChecked(this._watchSceneFile,n,this.menuID),this._toolbar.setItemText(this._watchSceneFile,n?"Disable automatic scene reload":"Automatically reload scene",this.menuID)}},t}();e.ElectronMenuPlugin=t,e.Tools.CheckIfElectron()&&e.PluginManager.RegisterMainToolbarPlugin(t)}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,t),this._editor=t.editor}return __extends(t,e),t.prototype.createFolders=function(e,t,n,i){for(var r=require("fs"),a=t.file.id+"/",o=0;o<e.length;o++){try{var s=r.lstatSync(a+e[o]);if(s.isDirectory())continue}catch(l){}r.mkdirSync(a+e[o])}n()},t.prototype.createFiles=function(e,t,n,i,r){for(var a=require("fs"),o=t.file.id+"/",s=0;s<e.length;s++){var l=e[s],c=(l.parentFolder?l.parentFolder.id+"/":o)+l.name,d=null;d=l.content instanceof ArrayBuffer||l.content instanceof Uint8Array?new global.Buffer(l.content):l.content,a.writeFileSync(c,d),r&&r(s)}n()},t.prototype.getFiles=function(e,t,n){var i=require("fs"),r=(e&&e.file?e.file.id:process.env.HOME||process.env.USERPROFILE)+"/";i.readdir(r,null,function(e,a){if(e)return void n(e.message);for(var o=[],s=0;s<a.length;s++){var l=r+a[s],c={id:l,name:a[s],folder:null};i.lstatSync(r).isDirectory()&&(c.folder={name:l}),o.push({file:c,name:a[s]})}t(o)})},t}(e.Storage);e.ElectronLocalStorage=t}(t=e.EDITOR||(e.EDITOR={}))}(BABYLON||(BABYLON={}));